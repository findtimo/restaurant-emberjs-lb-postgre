import{assert as t,isPresentArray as e,assertNever as s,getFirst as r,getLast as n,unwrap as a,deprecate as i,expect as o,assign as l,asPresentArray as c,assertPresentArray as h,dict as u}from"@glimmer/util";import{parseWithoutProcessing as d,parse as p}from"@handlebars/parser";import{EventedTokenizer as m,EntityParser as f,HTML5NamedCharRefs as b}from"simple-html-tokenizer";import{SexpOpcodes as g}from"@glimmer/wire-format";var k=function(t){return t[t.NBSP=160]="NBSP",t[t.QUOT=34]="QUOT",t[t.LT=60]="LT",t[t.GT=62]="GT",t[t.AMP=38]="AMP",t}(k||{});const w=/["&\xA0]/u,y=new RegExp(w.source,"gu"),S=/[&<>\xA0]/u,v=new RegExp(S.source,"gu");function P(t){switch(t.charCodeAt(0)){case k.NBSP:return"&nbsp;";case k.QUOT:return"&quot;";case k.AMP:return"&amp;";default:return t}}function x(t){switch(t.charCodeAt(0)){case k.NBSP:return"&nbsp;";case k.AMP:return"&amp;";case k.LT:return"&lt;";case k.GT:return"&gt;";default:return t}}function C(t,e){return t.loc.isInvisible||e.loc.isInvisible?0:t.loc.startPosition.line<e.loc.startPosition.line||t.loc.startPosition.line===e.loc.startPosition.line&&t.loc.startPosition.column<e.loc.startPosition.column?-1:t.loc.startPosition.line===e.loc.startPosition.line&&t.loc.startPosition.column===e.loc.startPosition.column?0:1}const N=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function E(){return[...N]}const A=/^\S/u;function T(t){return N.has(t.toLowerCase())&&t[0]?.toLowerCase()===t[0]}class B{buffer="";options;constructor(t){this.options=t}handledByOverride(t,e=!1){if(void 0!==this.options.override){let s=this.options.override(t,this.options);if("string"==typeof s)return e&&A.test(s)&&(s=` ${s}`),this.buffer+=s,!0}return!1}Node(t){switch(t.type){case"MustacheStatement":case"BlockStatement":case"PartialStatement":case"MustacheCommentStatement":case"CommentStatement":case"TextNode":case"ElementNode":case"AttrNode":case"Block":case"Template":return this.TopLevelStatement(t);case"StringLiteral":case"BooleanLiteral":case"NumberLiteral":case"UndefinedLiteral":case"NullLiteral":case"PathExpression":case"SubExpression":return this.Expression(t);case"Program":return this.Block(t);case"ConcatStatement":return this.ConcatStatement(t);case"Hash":return this.Hash(t);case"HashPair":return this.HashPair(t);case"ElementModifierStatement":return this.ElementModifierStatement(t)}}Expression(t){switch(t.type){case"StringLiteral":case"BooleanLiteral":case"NumberLiteral":case"UndefinedLiteral":case"NullLiteral":return this.Literal(t);case"PathExpression":return this.PathExpression(t);case"SubExpression":return this.SubExpression(t)}}Literal(t){switch(t.type){case"StringLiteral":return this.StringLiteral(t);case"BooleanLiteral":return this.BooleanLiteral(t);case"NumberLiteral":return this.NumberLiteral(t);case"UndefinedLiteral":return this.UndefinedLiteral(t);case"NullLiteral":return this.NullLiteral(t)}}TopLevelStatement(t){switch(t.type){case"MustacheStatement":return this.MustacheStatement(t);case"BlockStatement":return this.BlockStatement(t);case"PartialStatement":return this.PartialStatement(t);case"MustacheCommentStatement":return this.MustacheCommentStatement(t);case"CommentStatement":return this.CommentStatement(t);case"TextNode":return this.TextNode(t);case"ElementNode":return this.ElementNode(t);case"Block":case"Template":return this.Block(t);case"AttrNode":return this.AttrNode(t)}}Block(t){if(t.chained){t.body[0].chained=!0}this.handledByOverride(t)||this.TopLevelStatements(t.body)}TopLevelStatements(t){t.forEach((t=>this.TopLevelStatement(t)))}ElementNode(t){this.handledByOverride(t)||(this.OpenElementNode(t),this.TopLevelStatements(t.children),this.CloseElementNode(t))}OpenElementNode(t){this.buffer+=`<${t.tag}`;const e=[...t.attributes,...t.modifiers,...t.comments].sort(C);for(const t of e)switch(this.buffer+=" ",t.type){case"AttrNode":this.AttrNode(t);break;case"ElementModifierStatement":this.ElementModifierStatement(t);break;case"MustacheCommentStatement":this.MustacheCommentStatement(t)}t.blockParams.length&&this.BlockParams(t.blockParams),t.selfClosing&&(this.buffer+=" /"),this.buffer+=">"}CloseElementNode(t){t.selfClosing||T(t.tag)||(this.buffer+=`</${t.tag}>`)}AttrNode(t){if(this.handledByOverride(t))return;let{name:e,value:s}=t;this.buffer+=e,("TextNode"!==s.type||s.chars.length>0)&&(this.buffer+="=",this.AttrNodeValue(s))}AttrNodeValue(t){"TextNode"===t.type?(this.buffer+='"',this.TextNode(t,!0),this.buffer+='"'):this.Node(t)}TextNode(t,e){var s;this.handledByOverride(t)||("raw"===this.options.entityEncoding?this.buffer+=t.chars:this.buffer+=e?(s=t.chars,w.test(s)?s.replace(y,P):s):function(t){return S.test(t)?t.replace(v,x):t}(t.chars))}MustacheStatement(t){this.handledByOverride(t)||(this.buffer+=t.escaped?"{{":"{{{",t.strip.open&&(this.buffer+="~"),this.Expression(t.path),this.Params(t.params),this.Hash(t.hash),t.strip.close&&(this.buffer+="~"),this.buffer+=t.escaped?"}}":"}}}")}BlockStatement(t){this.handledByOverride(t)||(t.chained?(this.buffer+=t.inverseStrip.open?"{{~":"{{",this.buffer+="else "):this.buffer+=t.openStrip.open?"{{~#":"{{#",this.Expression(t.path),this.Params(t.params),this.Hash(t.hash),t.program.blockParams.length&&this.BlockParams(t.program.blockParams),t.chained?this.buffer+=t.inverseStrip.close?"~}}":"}}":this.buffer+=t.openStrip.close?"~}}":"}}",this.Block(t.program),t.inverse&&(t.inverse.chained||(this.buffer+=t.inverseStrip.open?"{{~":"{{",this.buffer+="else",this.buffer+=t.inverseStrip.close?"~}}":"}}"),this.Block(t.inverse)),t.chained||(this.buffer+=t.closeStrip.open?"{{~/":"{{/",this.Expression(t.path),this.buffer+=t.closeStrip.close?"~}}":"}}"))}BlockParams(t){this.buffer+=` as |${t.join(" ")}|`}PartialStatement(t){this.handledByOverride(t)||(this.buffer+="{{>",this.Expression(t.name),this.Params(t.params),this.Hash(t.hash),this.buffer+="}}")}ConcatStatement(t){this.handledByOverride(t)||(this.buffer+='"',t.parts.forEach((t=>{"TextNode"===t.type?this.TextNode(t,!0):this.Node(t)})),this.buffer+='"')}MustacheCommentStatement(t){this.handledByOverride(t)||(this.buffer+=`{{!--${t.value}--}}`)}ElementModifierStatement(t){this.handledByOverride(t)||(this.buffer+="{{",this.Expression(t.path),this.Params(t.params),this.Hash(t.hash),this.buffer+="}}")}CommentStatement(t){this.handledByOverride(t)||(this.buffer+=`\x3c!--${t.value}--\x3e`)}PathExpression(t){this.handledByOverride(t)||(this.buffer+=t.original)}SubExpression(t){this.handledByOverride(t)||(this.buffer+="(",this.Expression(t.path),this.Params(t.params),this.Hash(t.hash),this.buffer+=")")}Params(t){t.length&&t.forEach((t=>{this.buffer+=" ",this.Expression(t)}))}Hash(t){this.handledByOverride(t,!0)||t.pairs.forEach((t=>{this.buffer+=" ",this.HashPair(t)}))}HashPair(t){this.handledByOverride(t)||(this.buffer+=t.key,this.buffer+="=",this.Node(t.value))}StringLiteral(t){this.handledByOverride(t)||(this.buffer+=JSON.stringify(t.value))}BooleanLiteral(t){this.handledByOverride(t)||(this.buffer+=t.value)}NumberLiteral(t){this.handledByOverride(t)||(this.buffer+=t.value)}UndefinedLiteral(t){this.handledByOverride(t)||(this.buffer+="undefined")}NullLiteral(t){this.handledByOverride(t)||(this.buffer+="null")}print(t){let{options:e}=this;if(e.override){let s=e.override(t,e);if(void 0!==s)return s}return this.buffer="",this.Node(t),this.buffer}}function L(t,e={entityEncoding:"transformed"}){if(!t)return"";return new B(e).print(t)}function H(t){return t in O}const O={component:["Call","Append","Block"],debugger:["Append"],"each-in":["Block"],each:["Block"],"has-block-params":["Call","Append"],"has-block":["Call","Append"],helper:["Call","Append"],if:["Call","Append","Block"],"in-element":["Block"],let:["Block"],"link-to":["Append","Block"],log:["Call","Append"],modifier:["Call"],mount:["Append"],mut:["Call","Append"],outlet:["Append"],"query-params":["Call"],readonly:["Call","Append"],unbound:["Call","Append"],unless:["Call","Append","Block"],with:["Block"],yield:["Append"]},M=Object.freeze({line:1,column:0}),F=Object.freeze({source:"(synthetic)",start:M,end:M}),$=Object.freeze({source:"(nonexistent)",start:M,end:M}),_=Object.freeze({source:"(broken)",start:M,end:M});let z=function(t){return t.CharPosition="CharPosition",t.HbsPosition="HbsPosition",t.InternalsSynthetic="InternalsSynthetic",t.NonExistent="NonExistent",t.Broken="Broken",t}({});const I="MATCH_ANY",V="IS_INVISIBLE";class U{_whens;constructor(t){this._whens=t}first(t){for(const s of this._whens){const r=s.match(t);if(e(r))return r[0]}return null}}class D{_map=new Map;get(t,e){let s=this._map.get(t);return s||(s=e(),this._map.set(t,s),s)}add(t,e){this._map.set(t,e)}match(t){const e=function(t){switch(t){case z.Broken:case z.InternalsSynthetic:case z.NonExistent:return V;default:return t}}(t),s=[],r=this._map.get(e),n=this._map.get(I);return r&&s.push(r),n&&s.push(n),s}}function j(t){return t(new G).check()}class G{_whens=new D;check(){return(t,e)=>this.matchFor(t.kind,e.kind)(t,e)}matchFor(s,r){const n=this._whens.match(s);t(e(n),`no match defined for (${s}, ${r}) and no AnyMatch defined either`);const a=new U(n).first(r);return t(null!==a,`no match defined for (${s}, ${r}) and no AnyMatch defined either`),a}when(t,e,s){return this._whens.get(t,(()=>new D)).add(e,s),this}}const R=!("undefined"!=typeof window&&window.location&&/[&?]disable_local_debug/u.test(window.location.search));class J{static synthetic(t){let e=Y.synthetic(t);return new J({loc:e,chars:t})}static load(t,e){return new J({loc:Y.load(t,e[1]),chars:e[0]})}chars;loc;constructor(t){this.loc=t.loc,this.chars=t.chars}getString(){return this.chars}serialize(){return[this.chars,this.loc.serialize()]}}class Y{static get NON_EXISTENT(){return new q(z.NonExistent,$).wrap()}static load(t,e){return"number"==typeof e?Y.forCharPositions(t,e,e):"string"==typeof e?Y.synthetic(e):Array.isArray(e)?Y.forCharPositions(t,e[0],e[1]):e===z.NonExistent?Y.NON_EXISTENT:e===z.Broken?Y.broken(_):void s(e)}static forHbsLoc(t,e){const s=new et(t,e.start),r=new et(t,e.end);return new Q(t,{start:s,end:r},e).wrap()}static forCharPositions(t,e,s){const r=new tt(t,e),n=new tt(t,s);return new K(t,{start:r,end:n}).wrap()}static synthetic(t){return new q(z.InternalsSynthetic,$,t).wrap()}static broken(t=_){return new q(z.Broken,t).wrap()}isInvisible;constructor(t){this.data=t,this.isInvisible=t.kind!==z.CharPosition&&t.kind!==z.HbsPosition}getStart(){return this.data.getStart().wrap()}getEnd(){return this.data.getEnd().wrap()}get loc(){const t=this.data.toHbsSpan();return null===t?_:t.toHbsLoc()}get module(){return this.data.getModule()}get startPosition(){return this.loc.start}get endPosition(){return this.loc.end}toJSON(){return this.loc}withStart(t){return W(t.data,this.data.getEnd())}withEnd(t){return W(this.data.getStart(),t.data)}asString(){return this.data.asString()}toSlice(t){const e=this.data.asString();return void 0!==t&&e!==t&&console.warn(`unexpectedly found ${JSON.stringify(e)} when slicing source, but expected ${JSON.stringify(t)}`),new J({loc:this,chars:t||e})}get start(){return this.loc.start}set start(t){this.data.locDidUpdate({start:t})}get end(){return this.loc.end}set end(t){this.data.locDidUpdate({end:t})}get source(){return this.module}collapse(t){switch(t){case"start":return this.getStart().collapsed();case"end":return this.getEnd().collapsed()}}extend(t){return W(this.data.getStart(),t.data.getEnd())}serialize(){return this.data.serialize()}slice({skipStart:t=0,skipEnd:e=0}){return W(this.getStart().move(t).data,this.getEnd().move(-e).data)}sliceStartChars({skipStart:t=0,chars:e}){return W(this.getStart().move(t).data,this.getStart().move(t+e).data)}sliceEndChars({skipEnd:t=0,chars:e}){return W(this.getEnd().move(t-e).data,this.getStart().move(-t).data)}}class K{kind=z.CharPosition;_locPosSpan=null;constructor(t,e){this.source=t,this.charPositions=e}wrap(){return new Y(this)}asString(){return this.source.slice(this.charPositions.start.charPos,this.charPositions.end.charPos)}getModule(){return this.source.module}getStart(){return this.charPositions.start}getEnd(){return this.charPositions.end}locDidUpdate(){R&&console.warn("updating a location that came from a CharPosition span doesn't work reliably. Don't try to update locations after the plugin phase")}toHbsSpan(){let t=this._locPosSpan;if(null===t){const e=this.charPositions.start.toHbsPos(),s=this.charPositions.end.toHbsPos();t=this._locPosSpan=null===e||null===s?X:new Q(this.source,{start:e,end:s})}return t===X?null:t}serialize(){const{start:{charPos:t},end:{charPos:e}}=this.charPositions;return t===e?t:[t,e]}toCharPosSpan(){return this}}class Q{kind=z.HbsPosition;_charPosSpan=null;_providedHbsLoc;constructor(t,e,s=null){this.source=t,this.hbsPositions=e,this._providedHbsLoc=s}serialize(){const t=this.toCharPosSpan();return null===t?z.Broken:t.wrap().serialize()}wrap(){return new Y(this)}updateProvided(t,e){this._providedHbsLoc&&(this._providedHbsLoc[e]=t),this._charPosSpan=null,this._providedHbsLoc={start:t,end:t}}locDidUpdate({start:t,end:e}){void 0!==t&&(this.updateProvided(t,"start"),this.hbsPositions.start=new et(this.source,t,null)),void 0!==e&&(this.updateProvided(e,"end"),this.hbsPositions.end=new et(this.source,e,null))}asString(){const t=this.toCharPosSpan();return null===t?"":t.asString()}getModule(){return this.source.module}getStart(){return this.hbsPositions.start}getEnd(){return this.hbsPositions.end}toHbsLoc(){return{start:this.hbsPositions.start.hbsPos,end:this.hbsPositions.end.hbsPos}}toHbsSpan(){return this}toCharPosSpan(){let t=this._charPosSpan;if(null===t){const e=this.hbsPositions.start.toCharPos(),s=this.hbsPositions.end.toCharPos();if(!e||!s)return t=this._charPosSpan=X,null;t=this._charPosSpan=new K(this.source,{start:e,end:s})}return t===X?null:t}}class q{constructor(t,e,s=null){this.kind=t,this.loc=e,this.string=s}serialize(){switch(this.kind){case z.Broken:case z.NonExistent:return this.kind;case z.InternalsSynthetic:return this.string||""}}wrap(){return new Y(this)}asString(){return this.string||""}locDidUpdate({start:t,end:e}){void 0!==t&&(this.loc.start=t),void 0!==e&&(this.loc.end=e)}getModule(){return"an unknown module"}getStart(){return new st(this.kind,this.loc.start)}getEnd(){return new st(this.kind,this.loc.end)}toCharPosSpan(){return this}toHbsSpan(){return null}toHbsLoc(){return _}}const W=j((t=>t.when(z.HbsPosition,z.HbsPosition,((t,e)=>new Q(t.source,{start:t,end:e}).wrap())).when(z.CharPosition,z.CharPosition,((t,e)=>new K(t.source,{start:t,end:e}).wrap())).when(z.CharPosition,z.HbsPosition,((t,e)=>{const s=e.toCharPos();return null===s?new q(z.Broken,_).wrap():W(t,s)})).when(z.HbsPosition,z.CharPosition,((t,e)=>{const s=t.toCharPos();return null===s?new q(z.Broken,_).wrap():W(s,e)})).when(V,I,(t=>new q(t.kind,_).wrap())).when(I,V,((t,e)=>new q(e.kind,_).wrap())))),X="BROKEN";class Z{static forHbsPos(t,e){return new et(t,e,null).wrap()}static broken(t=M){return new st(z.Broken,t).wrap()}constructor(t){this.data=t}get offset(){const t=this.data.toCharPos();return null===t?null:t.offset}eql(t){return rt(this.data,t.data)}until(t){return W(this.data,t.data)}move(t){const e=this.data.toCharPos();if(null===e)return Z.broken();{const s=e.offset+t;return e.source.check(s)?new tt(e.source,s).wrap():Z.broken()}}collapsed(){return W(this.data,this.data)}toJSON(){return this.data.toJSON()}}class tt{kind=z.CharPosition;_locPos=null;constructor(t,e){this.source=t,this.charPos=e}toCharPos(){return this}toJSON(){const t=this.toHbsPos();return null===t?M:t.toJSON()}wrap(){return new Z(this)}get offset(){return this.charPos}toHbsPos(){let t=this._locPos;if(null===t){const e=this.source.hbsPosFor(this.charPos);this._locPos=t=null===e?X:new et(this.source,e,this.charPos)}return t===X?null:t}}class et{kind=z.HbsPosition;_charPos;constructor(t,e,s=null){this.source=t,this.hbsPos=e,this._charPos=null===s?null:new tt(t,s)}toCharPos(){let t=this._charPos;if(null===t){const e=this.source.charPosFor(this.hbsPos);this._charPos=t=null===e?X:new tt(this.source,e)}return t===X?null:t}toJSON(){return this.hbsPos}wrap(){return new Z(this)}toHbsPos(){return this}}class st{constructor(t,e){this.kind=t,this.pos=e}toCharPos(){return null}toJSON(){return this.pos}wrap(){return new Z(this)}get offset(){return null}}const rt=j((t=>t.when(z.HbsPosition,z.HbsPosition,(({hbsPos:t},{hbsPos:e})=>t.column===e.column&&t.line===e.line)).when(z.CharPosition,z.CharPosition,(({charPos:t},{charPos:e})=>t===e)).when(z.CharPosition,z.HbsPosition,(({offset:t},e)=>t===e.toCharPos()?.offset)).when(z.HbsPosition,z.CharPosition,((t,{offset:e})=>t.toCharPos()?.offset===e)).when(I,I,(()=>!1))));class nt{static from(t,e={}){return new nt(t,e.meta?.moduleName)}constructor(t,e="an unknown module"){this.source=t,this.module=e}check(t){return t>=0&&t<=this.source.length}slice(t,e){return this.source.slice(t,e)}offsetFor(t,e){return Z.forHbsPos(this,{line:t,column:e})}spanFor({start:t,end:e}){return Y.forHbsLoc(this,{start:{line:t.line,column:t.column},end:{line:e.line,column:e.column}})}hbsPosFor(t){let e=0,s=0;if(t>this.source.length)return null;for(;;){let r=this.source.indexOf("\n",s);if(t<=r||-1===r)return{line:e+1,column:t-s};e+=1,s=r+1}}charPosFor(e){let{line:s,column:r}=e,n=this.source.length,a=0,i=0;for(;i<n;){let e=this.source.indexOf("\n",i);if(-1===e&&(e=this.source.length),a===s-1){if(i+r>e)return e;{let e=this.hbsPosFor(i+r);t(null!==e,"the returned offset failed to round-trip"),t(e.line===s,"the round-tripped line didn't match the original line"),t(e.column===r,"the round-tripped column didn't match the original column")}return i+r}if(-1===e)return 0;a+=1,i=e+1}return n}}class at{static range(t,e=Y.NON_EXISTENT){return new at(t.map(it)).getRangeOffset(e)}_span;constructor(t=[]){this._span=t}add(t){this._span.push(t)}getRangeOffset(t){if(e(this._span)){let t=r(this._span),e=n(this._span);return t.extend(e)}return t}}function it(t){if(Array.isArray(t)){let e=r(t),s=n(t);return it(e).extend(it(s))}return t instanceof Y?t:t.loc}function ot(t){return!Array.isArray(t)||0!==t.length}function lt(t,e){return ot(t)?it(t):e}var ct=Object.freeze({__proto__:null,NON_EXISTENT_LOCATION:$,SYNTHETIC_LOCATION:F,Source:nt,SourceOffset:Z,SourceSlice:J,SourceSpan:Y,SpanList:at,UNKNOWN_POSITION:M,hasSpan:ot,loc:it,maybeLoc:lt});function ht(t,e){let{module:s,loc:r}=e,{line:n,column:a}=r.start,i=e.asString(),o=i?`\n\n|\n|  ${i.split("\n").join("\n|  ")}\n|\n\n`:"",l=new Error(`${t}: ${o}(error occurred in '${s}' @ line ${n} : column ${a})`);return l.name="SyntaxError",l.location=e,l.code=i,l}const ut={Program:["body"],Template:["body"],Block:["body"],MustacheStatement:["path","params","hash"],BlockStatement:["path","params","hash","program","inverse"],ElementModifierStatement:["path","params","hash"],PartialStatement:["name","params","hash"],CommentStatement:[],MustacheCommentStatement:[],ElementNode:["attributes","modifiers","children","comments"],AttrNode:["value"],TextNode:[],ConcatStatement:["parts"],SubExpression:["path","params","hash"],PathExpression:[],PathHead:[],StringLiteral:[],BooleanLiteral:[],NumberLiteral:[],NullLiteral:[],UndefinedLiteral:[],Hash:["pairs"],HashPair:["value"],NamedBlock:["attributes","modifiers","children","comments"],SimpleElement:["attributes","modifiers","children","comments"],Component:["head","attributes","modifiers","children","comments"]},dt=function(){function t(t,e,s,r){let n=Error.call(this,t);this.key=r,this.message=t,this.node=e,this.parent=s,n.stack&&(this.stack=n.stack)}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}();function pt(t,e,s){return new dt("Cannot remove a node unless it is part of an array",t,e,s)}function mt(t,e,s){return new dt("Cannot replace a node with multiple nodes unless it is part of an array",t,e,s)}function ft(t,e){return new dt("Replacing and removing in key handlers is not yet supported.",t,null,e)}class bt{node;parent;parentKey;constructor(t,e=null,s=null){this.node=t,this.parent=e,this.parentKey=s}get parentNode(){return this.parent?this.parent.node:null}parents(){return{[Symbol.iterator]:()=>new gt(this)}}}class gt{path;constructor(t){this.path=t}next(){return this.path.parent?(this.path=this.path.parent,{done:!1,value:this.path}):{done:!0,value:null}}}function kt(t){return"function"==typeof t?t:t.enter}function wt(t){return"function"==typeof t?void 0:t.exit}function yt(t,e){let s,r,n,{node:a,parent:o,parentKey:l}=e,c=function(t,e){if(("Template"===e||"Block"===e)&&t.Program)return R&&i(`The 'Program' visitor node is deprecated. Use 'Template' or 'Block' instead (node was '${e}') `),t.Program;let s=t[e];return void 0!==s?s:t.All}(t,a.type);if(void 0!==c&&(s=kt(c),r=wt(c)),void 0!==s&&(n=s(a,e)),null!=n){if(JSON.stringify(a)!==JSON.stringify(n)){if(Array.isArray(n))return Pt(t,n,o,l),n;return yt(t,new bt(n,o,l))||n}n=void 0}if(void 0===n){let s=ut[a.type];for(let r=0;r<s.length;r++){vt(t,c,e,s[r])}void 0!==r&&(n=r(a,e))}return n}function St(t,e,s){t[e]=s}function vt(t,e,s,r){let n,a,{node:i}=s,o=function(t,e){return t[e]}(i,r);if(o){if(void 0!==e){let t=function(t,e){let s="function"!=typeof t?t.keys:void 0;if(void 0===s)return;let r=s[e];return void 0!==r?r:s.All}(e,r);void 0!==t&&(n=kt(t),a=wt(t))}if(void 0!==n&&void 0!==n(i,r))throw ft(i,r);if(Array.isArray(o))Pt(t,o,s,r);else{let e=yt(t,new bt(o,s,r));void 0!==e&&function(t,e,s,r){if(null===r)throw pt(s,t,e);if(Array.isArray(r)){if(1!==r.length)throw 0===r.length?pt(s,t,e):mt(s,t,e);St(t,e,r[0])}else St(t,e,r)}(i,r,o,e)}if(void 0!==a&&void 0!==a(i,r))throw ft(i,r)}}function Pt(t,e,s,r){for(let n=0;n<e.length;n++){let i=a(e[n]),o=yt(t,new bt(i,s,r));void 0!==o&&(n+=xt(e,n,o)-1)}}function xt(t,e,s){return null===s?(t.splice(e,1),0):Array.isArray(s)?(t.splice(e,1,...s),s.length):(t.splice(e,1,s),1)}function Ct(t,e){yt(e,new bt(t))}class Nt{stack=[];constructor(t){this.order=t}visit(t,e){t&&(this.stack.push(t),"post"===this.order?(this.children(t,e),e(t,this)):(e(t,this),this.children(t,e)),this.stack.pop())}children(t,e){switch(t.type){case"Block":case"Template":return Et.Program(this,t,e);case"ElementNode":return Et.ElementNode(this,t,e);case"BlockStatement":return Et.BlockStatement(this,t,e);default:return}}}const Et={Program(t,e,s){At(t,e.body,s)},Template(t,e,s){At(t,e.body,s)},Block(t,e,s){At(t,e.body,s)},ElementNode(t,e,s){At(t,e.children,s)},BlockStatement(t,e,s){t.visit(e.program,s),t.visit(e.inverse||null,s)}};function At(t,e,s){for(const r of e)t.visit(r,s)}let Tt,Bt=/[!"#%&'()*+./;<=>@[\\\]^`{|}~]/u;function Lt(t){let e=function(t){let e=t.attributes.length,s=[];for(let r=0;r<e;r++)s.push(a(t.attributes[r]).name);let r=s.indexOf("as");if(-1===r&&s.length>0&&"|"===a(s[s.length-1]).charAt(0))throw ht("Block parameters must be preceded by the `as` keyword, detected block parameters without `as`",t.loc);if(-1!==r&&e>r&&"|"===a(s[r+1]).charAt(0)){let n=s.slice(r).join(" ");if("|"!==n.charAt(n.length-1)||2!==o(n.match(/\|/gu),"block params must exist here").length)throw ht("Invalid block parameters syntax, '"+n+"'",t.loc);let i=[];for(let n=r+1;n<e;n++){let e=a(s[n]).replace(/\|/gu,"");if(""!==e){if(Bt.test(e))throw ht("Invalid identifier for block parameters, '"+e+"'",t.loc);i.push(e)}}if(0===i.length)throw ht("Cannot use zero block parameters",t.loc);return t.attributes=t.attributes.slice(0,r),i}return null}(t);e&&(t.blockParams=e)}function Ht(t,e){(function(t){switch(t.type){case"Block":case"Template":return t.body;case"ElementNode":return t.children}})(t).push(e)}function Ot(t){return"StringLiteral"===t.type||"BooleanLiteral"===t.type||"NumberLiteral"===t.type||"NullLiteral"===t.type||"UndefinedLiteral"===t.type}function Mt(){return Tt||(Tt=new nt("","(synthetic)")),Tt}function Ft(t){switch(t.type){case"AtHead":case"VarHead":return{original:t.name,parts:[t.name]};case"ThisHead":return{original:"this",parts:[]}}}function $t(t,e){let s,[r,...n]=c(t.split("."));return s="this"===r?{type:"ThisHead",loc:jt(e||null)}:"@"===r[0]?{type:"AtHead",name:r,loc:jt(e||null)}:{type:"VarHead",name:r,loc:jt(e||null)},{head:s,tail:n}}function _t(t){return{type:"ThisHead",loc:jt(t||null)}}function zt(e,s){return t("@"===e[0],"call builders.at() with a string that starts with '@'"),{type:"AtHead",name:e,loc:jt(s||null)}}function It(e,s){return t("this"!==e,"You called builders.var() with 'this'. Call builders.this instead"),t("@"!==e[0],`You called builders.var() with '${e}'. Call builders.at('${e}') instead`),{type:"VarHead",name:e,loc:jt(s||null)}}function Vt(e,s){if("string"!=typeof e){if("type"in e)return e;{let{head:r,tail:n}=$t(e.head,Y.broken());t(0===n.length,"builder.path({ head, tail }) should not be called with a head with dots in it");let{original:a}=Ft(r);return new Jt([a,...n].join("."),r,n,jt(s||null))}}let{head:r,tail:n}=$t(e,Y.broken());return new Jt(e,r,n,jt(s||null))}function Ut(t,e,s){return{type:t,value:e,original:e,loc:jt(s||null)}}function Dt(t,e){return{type:"Hash",pairs:t||[],loc:jt(e||null)}}function jt(...t){if(1===t.length){let e=t[0];return e&&"object"==typeof e?Y.forHbsLoc(Mt(),e):Y.forHbsLoc(Mt(),F)}{let[e,s,r,n,a]=t,i=a?new nt("",a):Mt();return Y.forHbsLoc(i,{start:{line:e,column:s},end:{line:r,column:n}})}}var Gt={mustache:function(t,e,s,r,n,a){return"string"==typeof t&&(t=Vt(t)),{type:"MustacheStatement",path:t,params:e||[],hash:s||Dt([]),escaped:!r,trusting:!!r,loc:jt(n||null),strip:a||{open:!1,close:!1}}},block:function(t,e,s,r,n,a,o,c,h){let u,d;return"Template"===r.type?(R&&i("b.program is deprecated. Use b.blockItself instead."),u=l({},r,{type:"Block"})):u=r,null!=n&&"Template"===n.type?(R&&i("b.program is deprecated. Use b.blockItself instead."),d=l({},n,{type:"Block"})):d=n,{type:"BlockStatement",path:Vt(t),params:e||[],hash:s||Dt([]),program:u||null,inverse:d||null,loc:jt(a||null),openStrip:o||{open:!1,close:!1},inverseStrip:c||{open:!1,close:!1},closeStrip:h||{open:!1,close:!1}}},partial:function(t,e,s,r,n){return{type:"PartialStatement",name:t,params:e||[],hash:s||Dt([]),indent:r||"",strip:{open:!1,close:!1},loc:jt(n||null)}},comment:function(t,e){return{type:"CommentStatement",value:t,loc:jt(e||null)}},mustacheComment:function(t,e){return{type:"MustacheCommentStatement",value:t,loc:jt(e||null)}},element:function(t,e={}){let s,{attrs:r,blockParams:n,modifiers:a,comments:i,children:o,loc:l}=e,c=!1;return"object"==typeof t?(c=t.selfClosing,s=t.name):"/"===t.slice(-1)?(s=t.slice(0,-1),c=!0):s=t,{type:"ElementNode",tag:s,selfClosing:c,attributes:r||[],blockParams:n||[],modifiers:a||[],comments:i||[],children:o||[],loc:jt(l||null)}},elementModifier:function(t,e,s,r){return{type:"ElementModifierStatement",path:Vt(t),params:e||[],hash:s||Dt([]),loc:jt(r||null)}},attr:function(t,e,s){return{type:"AttrNode",name:t,value:e,loc:jt(s||null)}},text:function(t,e){return{type:"TextNode",chars:t||"",loc:jt(e||null)}},sexpr:function(t,e,s,r){return{type:"SubExpression",path:Vt(t),params:e||[],hash:s||Dt([]),loc:jt(r||null)}},concat:function(t,s){if(!e(t))throw new Error("b.concat requires at least one part");return{type:"ConcatStatement",parts:t||[],loc:jt(s||null)}},hash:Dt,pair:function(t,e,s){return{type:"HashPair",key:t,value:e,loc:jt(s||null)}},literal:Ut,program:function(t,e,s){return{type:"Template",body:t||[],blockParams:e||[],loc:jt(s||null)}},blockItself:function(t,e,s=!1,r){return{type:"Block",body:t||[],blockParams:e||[],chained:s,loc:jt(r||null)}},template:function(t,e,s){return{type:"Template",body:t||[],blockParams:e||[],loc:jt(s||null)}},loc:jt,pos:function(t,e){return{line:t,column:e}},path:Vt,fullPath:function(t,e,s){let{original:r,parts:n}=Ft(t),a=[...r,...[...n,...e]].join(".");return new Jt(a,t,e,jt(s||null))},head:function(t,e){return"@"===t[0]?zt(t,e):"this"===t?_t(e):It(t,e)},at:zt,var:It,this:_t,blockName:function(t,e){return{type:"NamedBlockName",name:t,loc:jt(e||null)}},string:Rt("StringLiteral"),boolean:Rt("BooleanLiteral"),number:Rt("NumberLiteral"),undefined:()=>Ut("UndefinedLiteral",void 0),null:()=>Ut("NullLiteral",null)};function Rt(t){return function(e,s){return Ut(t,e,s)}}class Jt{type="PathExpression";parts;this=!1;data=!1;constructor(t,e,s,r){this.original=t,this.loc=r;let n=s.slice();"ThisHead"===e.type?this.this=!0:"AtHead"===e.type?(this.data=!0,n.unshift(e.name.slice(1))):n.unshift(e.name),this.parts=n}_head=void 0;get head(){if(this._head)return this._head;let t;this.this?t="this":this.data?t=`@${r(c(this.parts))}`:(h(this.parts),t=r(this.parts));let e=this.loc.collapse("start").sliceStartChars({chars:t.length}).loc;return this._head=Gt.head(t,e)}get tail(){return this.this?this.parts:this.parts.slice(1)}}const Yt={close:!1,open:!1};var Kt=new class{pos(t,e){return{line:t,column:e}}blockItself({body:t=[],blockParams:e=[],chained:s=!1,loc:r}){return{type:"Block",body:t,blockParams:e,chained:s,loc:r}}template({body:t,blockParams:e,loc:s}){return{type:"Template",body:t||[],blockParams:e||[],loc:s}}mustache({path:t,params:e,hash:s,trusting:r,loc:n,strip:a=Yt}){return{type:"MustacheStatement",path:t,params:e,hash:s,escaped:!r,trusting:r,loc:n,strip:a||{open:!1,close:!1}}}block({path:t,params:e,hash:s,defaultBlock:r,elseBlock:n=null,loc:a,openStrip:i=Yt,inverseStrip:o=Yt,closeStrip:l=Yt}){return{type:"BlockStatement",path:t,params:e,hash:s,program:r,inverse:n,loc:a,openStrip:i,inverseStrip:o,closeStrip:l}}comment(t,e){return{type:"CommentStatement",value:t,loc:e}}mustacheComment(t,e){return{type:"MustacheCommentStatement",value:t,loc:e}}concat(t,e){return{type:"ConcatStatement",parts:t,loc:e}}element({tag:t,selfClosing:e,attrs:s,blockParams:r,modifiers:n,comments:a,children:i,loc:o}){return{type:"ElementNode",tag:t,selfClosing:e,attributes:s||[],blockParams:r||[],modifiers:n||[],comments:a||[],children:i||[],loc:o}}elementModifier({path:t,params:e,hash:s,loc:r}){return{type:"ElementModifierStatement",path:t,params:e,hash:s,loc:r}}attr({name:t,value:e,loc:s}){return{type:"AttrNode",name:t,value:e,loc:s}}text({chars:t,loc:e}){return{type:"TextNode",chars:t,loc:e}}sexpr({path:t,params:e,hash:s,loc:r}){return{type:"SubExpression",path:t,params:e,hash:s,loc:r}}path({head:t,tail:e,loc:s}){let{original:r}=function(t){switch(t.type){case"AtHead":case"VarHead":return{original:t.name,parts:[t.name]};case"ThisHead":return{original:"this",parts:[]}}}(t),n=[...r,...e].join(".");return new Jt(n,t,e,s)}head(t,e){return"@"===t[0]?this.atName(t,e):"this"===t?this.this(e):this.var(t,e)}this(t){return{type:"ThisHead",loc:t}}atName(e,s){return t("@"===e[0],"call builders.at() with a string that starts with '@'"),{type:"AtHead",name:e,loc:s}}var(e,s){return t("this"!==e,"You called builders.var() with 'this'. Call builders.this instead"),t("@"!==e[0],`You called builders.var() with '${e}'. Call builders.at('${e}') instead`),{type:"VarHead",name:e,loc:s}}hash(t,e){return{type:"Hash",pairs:t||[],loc:e}}pair({key:t,value:e,loc:s}){return{type:"HashPair",key:t,value:e,loc:s}}literal({type:t,value:e,loc:s}){return{type:t,value:e,original:e,loc:s}}undefined(){return this.literal({type:"UndefinedLiteral",value:void 0})}null(){return this.literal({type:"NullLiteral",value:null})}string(t,e){return this.literal({type:"StringLiteral",value:t,loc:e})}boolean(t,e){return this.literal({type:"BooleanLiteral",value:t,loc:e})}number(t,e){return this.literal({type:"NumberLiteral",value:t,loc:e})}};class Qt{elementStack=[];lines;source;currentAttribute=null;currentNode=null;tokenizer;constructor(t,e=new f(b),s="precompile"){this.source=t,this.lines=t.source.split(/\r\n?|\n/u),this.tokenizer=new m(this,e,s)}offset(){let{line:t,column:e}=this.tokenizer;return this.source.offsetFor(t,e)}pos({line:t,column:e}){return this.source.offsetFor(t,e)}finish(t){return l({},t,{loc:t.loc.until(this.offset())})}get currentAttr(){return o(this.currentAttribute,"expected attribute")}get currentTag(){let e=this.currentNode;return t(e&&("StartTag"===e.type||"EndTag"===e.type),"expected tag"),e}get currentStartTag(){let e=this.currentNode;return t(e&&"StartTag"===e.type,"expected start tag"),e}get currentEndTag(){let e=this.currentNode;return t(e&&"EndTag"===e.type,"expected end tag"),e}get currentComment(){let e=this.currentNode;return t(e&&"CommentStatement"===e.type,"expected a comment"),e}get currentData(){let e=this.currentNode;return t(e&&"TextNode"===e.type,"expected a text node"),e}acceptTemplate(t){return this[t.type](t)}acceptNode(t){return this[t.type](t)}currentElement(){return n(c(this.elementStack))}sourceForNode(t,e){let s,r,n,i=t.loc.start.line-1,o=i-1,l=t.loc.start.column,c=[];for(e?(r=e.loc.end.line-1,n=e.loc.end.column):(r=t.loc.end.line-1,n=t.loc.end.column);o<r;)o++,s=a(this.lines[o]),o===i?i===r?c.push(s.slice(l,n)):c.push(s.slice(l)):o===r?c.push(s.slice(0,n)):c.push(s);return c.join("\n")}}const qt="beforeAttributeName";class Wt extends Qt{get isTopLevel(){return 0===this.elementStack.length}Program(t){const e=[];let s;s=this.isTopLevel?Kt.template({body:e,blockParams:t.blockParams,loc:this.source.spanFor(t.loc)}):Kt.blockItself({body:e,blockParams:t.blockParams,chained:t.chained,loc:this.source.spanFor(t.loc)});let r,n=t.body.length;if(this.elementStack.push(s),0===n)return this.elementStack.pop();for(r=0;r<n;r++)this.acceptNode(a(t.body[r]));const i=this.elementStack.pop();if(i!==s){const t=i;throw ht(`Unclosed element \`${t.tag}\``,t.loc)}return s}BlockStatement(t){if("comment"===this.tokenizer.state)return void this.appendToCommentData(this.sourceForNode(t));if("data"!==this.tokenizer.state&&"beforeData"!==this.tokenizer.state)throw ht("A block may only be used inside an HTML element or another block.",this.source.spanFor(t.loc));const{path:e,params:s,hash:r}=Xt(this,t);t.program.loc||(t.program.loc=$),t.inverse&&!t.inverse.loc&&(t.inverse.loc=$);const n=this.Program(t.program),a=t.inverse?this.Program(t.inverse):null,i=Kt.block({path:e,params:s,hash:r,defaultBlock:n,elseBlock:a,loc:this.source.spanFor(t.loc),openStrip:t.openStrip,inverseStrip:t.inverseStrip,closeStrip:t.closeStrip});Ht(this.currentElement(),i)}MustacheStatement(t){const{tokenizer:e}=this;if("comment"===e.state)return void this.appendToCommentData(this.sourceForNode(t));let s;const{escaped:r,loc:n,strip:a}=t;if(Ot(t.path))s=Kt.mustache({path:this.acceptNode(t.path),params:[],hash:Kt.hash([],this.source.spanFor(t.path.loc).collapse("end")),trusting:!r,loc:this.source.spanFor(n),strip:a});else{const{path:e,params:i,hash:o}=Xt(this,t);s=Kt.mustache({path:e,params:i,hash:o,trusting:!r,loc:this.source.spanFor(n),strip:a})}switch(e.state){case"tagOpen":case"tagName":throw ht("Cannot use mustaches in an elements tagname",s.loc);case"beforeAttributeName":Zt(this.currentStartTag,s);break;case"attributeName":case"afterAttributeName":this.beginAttributeValue(!1),this.finishAttributeValue(),Zt(this.currentStartTag,s),e.transitionTo(qt);break;case"afterAttributeValueQuoted":Zt(this.currentStartTag,s),e.transitionTo(qt);break;case"beforeAttributeValue":this.beginAttributeValue(!1),this.appendDynamicAttributeValuePart(s),e.transitionTo("attributeValueUnquoted");break;case"attributeValueDoubleQuoted":case"attributeValueSingleQuoted":case"attributeValueUnquoted":this.appendDynamicAttributeValuePart(s);break;default:Ht(this.currentElement(),s)}return s}appendDynamicAttributeValuePart(t){this.finalizeTextPart();const e=this.currentAttr;e.isDynamic=!0,e.parts.push(t)}finalizeTextPart(){const t=this.currentAttr.currentPart;null!==t&&(this.currentAttr.parts.push(t),this.startTextPart())}startTextPart(){this.currentAttr.currentPart=null}ContentStatement(t){!function(t,e){let s=e.loc.start.line,r=e.loc.start.column;const n=function(t,e){if(""===e)return{lines:t.split("\n").length-1,columns:0};const[s]=t.split(e),r=s.split(/\n/u),n=r.length-1;return{lines:n,columns:a(r[n]).length}}(e.original,e.value);s+=n.lines,n.lines?r=n.columns:r+=n.columns;t.line=s,t.column=r}(this.tokenizer,t),this.tokenizer.tokenizePart(t.value),this.tokenizer.flushData()}CommentStatement(t){const{tokenizer:e}=this;if("comment"===e.state)return this.appendToCommentData(this.sourceForNode(t)),null;const{value:s,loc:r}=t,n=Kt.mustacheComment(s,this.source.spanFor(r));switch(e.state){case"beforeAttributeName":case"afterAttributeName":this.currentStartTag.comments.push(n);break;case"beforeData":case"data":Ht(this.currentElement(),n);break;default:throw ht(`Using a Handlebars comment when in the \`${e.state}\` state is not supported`,this.source.spanFor(t.loc))}return n}PartialStatement(t){throw ht("Handlebars partials are not supported",this.source.spanFor(t.loc))}PartialBlockStatement(t){throw ht("Handlebars partial blocks are not supported",this.source.spanFor(t.loc))}Decorator(t){throw ht("Handlebars decorators are not supported",this.source.spanFor(t.loc))}DecoratorBlock(t){throw ht("Handlebars decorator blocks are not supported",this.source.spanFor(t.loc))}SubExpression(t){const{path:e,params:s,hash:r}=Xt(this,t);return Kt.sexpr({path:e,params:s,hash:r,loc:this.source.spanFor(t.loc)})}PathExpression(t){const{original:e}=t;let s;if(-1!==e.indexOf("/")){if("./"===e.slice(0,2))throw ht('Using "./" is not supported in Glimmer and unnecessary',this.source.spanFor(t.loc));if("../"===e.slice(0,3))throw ht('Changing context using "../" is not supported in Glimmer',this.source.spanFor(t.loc));if(-1!==e.indexOf("."))throw ht("Mixing '.' and '/' in paths is not supported in Glimmer; use only '.' to separate property paths",this.source.spanFor(t.loc));s=[t.parts.join("/")]}else{if("."===e)throw ht("'.' is not a supported path in Glimmer; check for a path with a trailing '.'",this.source.spanFor(t.loc));s=t.parts}let r,n=!1;if(/^this(?:\..+)?$/u.test(e)&&(n=!0),n)r={type:"ThisHead",loc:{start:t.loc.start,end:{line:t.loc.start.line,column:t.loc.start.column+4}}};else if(t.data){const e=s.shift();if(void 0===e)throw ht("Attempted to parse a path expression, but it was not valid. Paths beginning with @ must start with a-z.",this.source.spanFor(t.loc));r={type:"AtHead",name:`@${e}`,loc:{start:t.loc.start,end:{line:t.loc.start.line,column:t.loc.start.column+e.length+1}}}}else{const e=s.shift();if(void 0===e)throw ht("Attempted to parse a path expression, but it was not valid. Paths must start with a-z or A-Z.",this.source.spanFor(t.loc));r={type:"VarHead",name:e,loc:{start:t.loc.start,end:{line:t.loc.start.line,column:t.loc.start.column+e.length}}}}return new Jt(t.original,r,s,this.source.spanFor(t.loc))}Hash(t){const e=t.pairs.map((t=>Kt.pair({key:t.key,value:this.acceptNode(t.value),loc:this.source.spanFor(t.loc)})));return Kt.hash(e,this.source.spanFor(t.loc))}StringLiteral(t){return Kt.literal({type:"StringLiteral",value:t.value,loc:t.loc})}BooleanLiteral(t){return Kt.literal({type:"BooleanLiteral",value:t.value,loc:t.loc})}NumberLiteral(t){return Kt.literal({type:"NumberLiteral",value:t.value,loc:t.loc})}UndefinedLiteral(t){return Kt.literal({type:"UndefinedLiteral",value:void 0,loc:t.loc})}NullLiteral(t){return Kt.literal({type:"NullLiteral",value:null,loc:t.loc})}}function Xt(t,s){if(s.path.type.endsWith("Literal")){const e=s.path;let r="";throw r="BooleanLiteral"===e.type?e.original.toString():"StringLiteral"===e.type?`"${e.original}"`:"NullLiteral"===e.type?"null":"NumberLiteral"===e.type?e.value.toString():"undefined",ht(`${e.type} "${"StringLiteral"===e.type?e.original:r}" cannot be called as a sub-expression, replace (${r}) with ${r}`,t.source.spanFor(e.loc))}const r="PathExpression"===s.path.type?t.PathExpression(s.path):t.SubExpression(s.path),a=s.params?s.params.map((e=>t.acceptNode(e))):[],i=e(a)?n(a).loc:r.loc;return{path:r,params:a,hash:s.hash?t.Hash(s.hash):{type:"Hash",pairs:[],loc:t.source.spanFor(i).collapse("end")}}}function Zt(t,e){const{path:s,params:r,hash:n,loc:a}=e;if(Ot(s)){const r=`{{${function(t){return"UndefinedLiteral"===t.type?"undefined":JSON.stringify(t.value)}(s)}}}`;throw ht(`In ${`<${t.name} ... ${r} ...`}, ${r} is not a valid modifier`,e.loc)}const i=Kt.elementModifier({path:s,params:r,hash:n,loc:a});t.modifiers.push(i)}class te extends Wt{tagOpenLine=0;tagOpenColumn=0;reset(){this.currentNode=null}beginComment(){this.currentNode=Kt.comment("",this.source.offsetFor(this.tagOpenLine,this.tagOpenColumn))}appendToCommentData(t){this.currentComment.value+=t}finishComment(){Ht(this.currentElement(),this.finish(this.currentComment))}beginData(){this.currentNode=Kt.text({chars:"",loc:this.offset().collapsed()})}appendToData(t){this.currentData.chars+=t}finishData(){this.currentData.loc=this.currentData.loc.withEnd(this.offset()),Ht(this.currentElement(),this.currentData)}tagOpen(){this.tagOpenLine=this.tokenizer.line,this.tagOpenColumn=this.tokenizer.column}beginStartTag(){this.currentNode={type:"StartTag",name:"",attributes:[],modifiers:[],comments:[],selfClosing:!1,loc:this.source.offsetFor(this.tagOpenLine,this.tagOpenColumn)}}beginEndTag(){this.currentNode={type:"EndTag",name:"",attributes:[],modifiers:[],comments:[],selfClosing:!1,loc:this.source.offsetFor(this.tagOpenLine,this.tagOpenColumn)}}finishTag(){let t=this.finish(this.currentTag);if("StartTag"===t.type){if(this.finishStartTag(),":"===t.name)throw ht("Invalid named block named detected, you may have created a named block without a name, or you may have began your name with a number. Named blocks must have names that are at least one character long, and begin with a lower case letter",this.source.spanFor({start:this.currentTag.loc.toJSON(),end:this.offset().toJSON()}));(N.has(t.name)||t.selfClosing)&&this.finishEndTag(!0)}else"EndTag"===t.type&&this.finishEndTag(!1)}finishStartTag(){let{name:t,attributes:e,modifiers:s,comments:r,selfClosing:n,loc:a}=this.finish(this.currentStartTag),i=Kt.element({tag:t,selfClosing:n,attrs:e,modifiers:s,comments:r,children:[],blockParams:[],loc:a});this.elementStack.push(i)}finishEndTag(t){let e=this.finish(this.currentTag),s=this.elementStack.pop();this.validateEndTag(e,s,t);let r=this.currentElement();s.loc=s.loc.withEnd(this.offset()),Lt(s),Ht(r,s)}markTagAsSelfClosing(){this.currentTag.selfClosing=!0}appendToTagName(t){this.currentTag.name+=t}beginAttribute(){let t=this.offset();this.currentAttribute={name:"",parts:[],currentPart:null,isQuoted:!1,isDynamic:!1,start:t,valueSpan:t.collapsed()}}appendToAttributeName(t){this.currentAttr.name+=t}beginAttributeValue(t){this.currentAttr.isQuoted=t,this.startTextPart(),this.currentAttr.valueSpan=this.offset().collapsed()}appendToAttributeValue(t){let e=this.currentAttr.parts,s=e[e.length-1],r=this.currentAttr.currentPart;if(r)r.chars+=t,r.loc=r.loc.withEnd(this.offset());else{let e=this.offset();e="\n"===t?s?s.loc.getEnd():this.currentAttr.valueSpan.getStart():e.move(-1),this.currentAttr.currentPart=Kt.text({chars:t,loc:e.collapsed()})}}finishAttributeValue(){this.finalizeTextPart();let t=this.currentTag,e=this.offset();if("EndTag"===t.type)throw ht("Invalid end tag: closing tag must not have attributes",this.source.spanFor({start:t.loc.toJSON(),end:e.toJSON()}));let{name:s,parts:r,start:n,isQuoted:a,isDynamic:i,valueSpan:o}=this.currentAttr,l=this.assembleAttributeValue(r,a,i,n.until(e));l.loc=o.withEnd(e);let c=Kt.attr({name:s,value:l,loc:n.until(e)});this.currentStartTag.attributes.push(c)}reportSyntaxError(t){throw ht(t,this.offset().collapsed())}assembleConcatenatedValue(t){for(const e of t)if("MustacheStatement"!==e.type&&"TextNode"!==e.type)throw ht(`Unsupported node in quoted attribute value: ${e.type}`,e.loc);h(t,"the concatenation parts of an element should not be empty");let e=r(t),s=n(t);return Kt.concat(t,this.source.spanFor(e.loc).extend(this.source.spanFor(s.loc)))}validateEndTag(t,e,s){if(N.has(t.name)&&!s)throw ht(`<${t.name}> elements do not need end tags. You should remove it`,t.loc);if(void 0===e.tag)throw ht(`Closing tag </${t.name}> without an open tag`,t.loc);if(e.tag!==t.name)throw ht(`Closing tag </${t.name}> did not match last open tag <${e.tag}> (on line ${e.loc.startPosition.line})`,t.loc)}assembleAttributeValue(t,s,r,n){if(r){if(s)return this.assembleConcatenatedValue(t);{h(t);const[e,s]=t;if(void 0===s||"TextNode"===s.type&&"/"===s.chars)return e;throw ht("An unquoted attribute value must be a string or a mustache, preceded by whitespace or a '=' character, and followed by whitespace, a '>' character, or '/>'",n)}}return e(t)?t[0]:Kt.text({chars:"",loc:n})}}const ee={parse:re,builders:Gt,print:L,traverse:Ct,Walker:Nt};class se extends f{constructor(){super({})}parse(){}}function re(t,e={}){let s,r,n,a=e.mode||"precompile";"string"==typeof t?(s=new nt(t,e.meta?.moduleName),r="codemod"===a?d(t,e.parseOptions):p(t,e.parseOptions)):t instanceof nt?(s=t,r="codemod"===a?d(t.source,e.parseOptions):p(t.source,e.parseOptions)):(s=new nt("",e.meta?.moduleName),r=t),"codemod"===a&&(n=new se);let i=Y.forCharPositions(s,0,s.source.length);r.loc={source:"(program)",start:i.startPosition,end:i.endPosition};let o=new te(s,n,a).acceptTemplate(r);if(e.strictMode&&(o.blockParams=e.locals??[]),e&&e.plugins&&e.plugins.ast)for(const t of e.plugins.ast){Ct(o,t(l({},e,{syntax:ee},{plugins:void 0})).visitor)}return o}function ne(t,e,s,r){const n=function(t,e,s){if("PathExpression"===t.type){if("AtHead"===t.head.type||"ThisHead"===t.head.type)return;const s=t.head.name;if(-1===e.indexOf(s))return s}else if("ElementNode"===t.type){const{tag:r}=t,n=r.charAt(0);if(":"===n||"@"===n)return;if(!s.includeHtmlElements&&-1===r.indexOf(".")&&r.toLowerCase()===r)return;if("this."===r.substr(0,5))return;if(r.includes(".")){let[t]=r.split(".");if(e.includes(t))return}if(e.includes(r))return;return r}}(e,s,r);(Array.isArray(n)?n:[n]).forEach((e=>{if(void 0!==e&&"@"!==e[0]){const r=e.split(".")[0];s.includes(r)||t.add(e.split(".")[0])}}))}function ae(t,e={includeHtmlElements:!1,includeKeywords:!1}){const s=re(t),r=new Set,n=[];Ct(s,{Block:{enter({blockParams:t}){t.forEach((t=>{n.push(t)}))},exit({blockParams:t}){t.forEach((()=>{n.pop()}))}},ElementNode:{enter(t){t.blockParams.forEach((t=>{n.push(t)})),ne(r,t,n,e)},exit({blockParams:t}){t.forEach((()=>{n.pop()}))}},PathExpression(t){ne(r,t,n,e)}});let a=[];return r.forEach((t=>a.push(t))),e?.includeKeywords||(a=a.filter((t=>!H(t)))),a}function ie(t){if(void 0!==t){const e=t;return{fields:()=>class{type;constructor(t){this.type=e,l(this,t)}}}}return{fields:()=>class{constructor(t){l(this,t)}}}}class oe extends(ie().fields()){static empty(t){return new oe({loc:t,positional:le.empty(t),named:ce.empty(t)})}static named(t){return new oe({loc:t.loc,positional:le.empty(t.loc.collapse("end")),named:t})}nth(t){return this.positional.nth(t)}get(t){return this.named.get(t)}isEmpty(){return this.positional.isEmpty()&&this.named.isEmpty()}}class le extends(ie().fields()){static empty(t){return new le({loc:t,exprs:[]})}get size(){return this.exprs.length}nth(t){return this.exprs[t]||null}isEmpty(){return 0===this.exprs.length}}class ce extends(ie().fields()){static empty(t){return new ce({loc:t,entries:[]})}get size(){return this.entries.length}get(t){let e=this.entries.filter((e=>e.name.chars===t))[0];return e?e.value:null}isEmpty(){return 0===this.entries.length}}class he{loc;name;value;constructor(t){this.loc=t.name.loc.extend(t.value.loc),this.name=t.name,this.value=t.value}}class ue extends(ie("HtmlAttr").fields()){}class de extends(ie("SplatAttr").fields()){}class pe extends(ie().fields()){toNamedArgument(){return new he({name:this.name,value:this.value})}}class me extends(ie("ElementModifier").fields()){}class fe extends(ie("GlimmerComment").fields()){}class be extends(ie("HtmlText").fields()){}class ge extends(ie("HtmlComment").fields()){}class ke extends(ie("AppendContent").fields()){get callee(){return"Call"===this.value.type?this.value.callee:this.value}get args(){return"Call"===this.value.type?this.value.args:oe.empty(this.value.loc.collapse("end"))}}class we extends(ie("InvokeBlock").fields()){}class ye extends(ie("InvokeComponent").fields()){get args(){let t=this.componentArgs.map((t=>t.toNamedArgument()));return oe.named(new ce({loc:at.range(t,this.callee.loc.collapse("end")),entries:t}))}}class Se extends(ie("SimpleElement").fields()){get args(){let t=this.componentArgs.map((t=>t.toNamedArgument()));return oe.named(new ce({loc:at.range(t,this.tag.loc.collapse("end")),entries:t}))}}class ve extends(ie("Literal").fields()){toSlice(){return new J({loc:this.loc,chars:this.value})}}class Pe extends(ie("Path").fields()){}class xe extends(ie("Call").fields()){}class Ce extends(ie("DeprecatedCall").fields()){}class Ne extends(ie("Interpolate").fields()){}class Ee extends(ie().fields()){}class Ae extends(ie().fields()){}class Te extends(ie().fields()){get(t){return this.blocks.filter((e=>e.name.chars===t))[0]||null}}class Be extends(ie().fields()){get args(){let t=this.componentArgs.map((t=>t.toNamedArgument()));return oe.named(new ce({loc:at.range(t,this.name.loc.collapse("end")),entries:t}))}}class Le extends(ie("This").fields()){}class He extends(ie("Arg").fields()){}class Oe extends(ie("Local").fields()){}class Me extends(ie("Free").fields()){}const Fe={resolution:()=>g.GetStrictKeyword,serialize:()=>"Strict",isAngleBracket:!1},$e={...Fe,isAngleBracket:!0};class _e{static namespaced(t,e=!1){return new _e({namespaces:[t],fallback:!1},e)}static fallback(){return new _e({namespaces:[],fallback:!0})}static append({invoke:t}){return new _e({namespaces:[Ie.Component,Ie.Helper],fallback:!t})}static trustingAppend({invoke:t}){return new _e({namespaces:[Ie.Helper],fallback:!t})}static attr(){return new _e({namespaces:[Ie.Helper],fallback:!0})}constructor(t,e=!1){this.ambiguity=t,this.isAngleBracket=e}resolution(){if(0===this.ambiguity.namespaces.length)return g.GetStrictKeyword;if(1!==this.ambiguity.namespaces.length)return this.ambiguity.fallback?g.GetFreeAsComponentOrHelperHeadOrThisFallback:g.GetFreeAsComponentOrHelperHead;if(this.ambiguity.fallback)return g.GetFreeAsHelperHeadOrThisFallback;switch(this.ambiguity.namespaces[0]){case Ie.Helper:return g.GetFreeAsHelperHead;case Ie.Modifier:return g.GetFreeAsModifierHead;case Ie.Component:return g.GetFreeAsComponentHead}}serialize(){return 0===this.ambiguity.namespaces.length?"Loose":1===this.ambiguity.namespaces.length?this.ambiguity.fallback?["ambiguous",je.Attr]:["ns",this.ambiguity.namespaces[0]]:this.ambiguity.fallback?["ambiguous",je.Append]:["ambiguous",je.Invoke]}}const ze=_e.fallback();let Ie=function(t){return t.Helper="Helper",t.Modifier="Modifier",t.Component="Component",t}({});const Ve=Ie.Helper,Ue=Ie.Modifier,De=Ie.Component;var je=function(t){return t.Append="Append",t.Attr="Attr",t.Invoke="Invoke",t}(je||{});var Ge=Object.freeze({__proto__:null,ARGUMENT_RESOLUTION:ze,AppendContent:ke,ArgReference:He,Args:oe,Block:Ae,COMPONENT_NAMESPACE:De,CallExpression:xe,ComponentArg:pe,DeprecatedCallExpression:Ce,ElementModifier:me,FreeVarNamespace:Ie,FreeVarReference:Me,GlimmerComment:fe,HELPER_NAMESPACE:Ve,HTML_RESOLUTION:$e,HtmlAttr:ue,HtmlComment:ge,HtmlText:be,InterpolateExpression:Ne,InvokeBlock:we,InvokeComponent:ye,LiteralExpression:ve,LocalVarReference:Oe,LooseModeResolution:_e,MODIFIER_NAMESPACE:Ue,NamedArgument:he,NamedArguments:ce,NamedBlock:Be,NamedBlocks:Te,PathExpression:Pe,PositionalArguments:le,STRICT_RESOLUTION:Fe,SimpleElement:Se,SplatAttr:de,Template:Ee,ThisReference:Le,isLiteral:function(t,e){return"Literal"===t.type&&(void 0===e||("null"===e?null===t.value:typeof t.value===e))},isStrictResolution:function(t){return t===Fe},loadResolution:function(t){if("string"==typeof t)switch(t){case"Loose":return _e.fallback();case"Strict":return Fe}switch(t[0]){case"ambiguous":switch(t[1]){case je.Append:return _e.append({invoke:!1});case je.Attr:return _e.attr();case je.Invoke:return _e.append({invoke:!0})}case"ns":return _e.namespaced(t[1])}},node:ie});class Re{static top(t,e){return new Je(t,e)}child(t){let e=t.map((t=>this.allocate(t)));return new Ye(this,t,e)}}class Je extends Re{constructor(t,e){super(),this.templateLocals=t,this.options=e}symbols=[];upvars=[];size=1;named=u();blocks=u();usedTemplateLocals=[];#t=!1;hasLexical(t){return this.options.lexicalScope(t)}getLexical(t){return this.allocateFree(t,$e)}getUsedTemplateLocals(){return this.usedTemplateLocals}setHasDebugger(){this.#t=!0}get hasEval(){return this.#t}has(t){return this.templateLocals.includes(t)}get(t){let e=this.usedTemplateLocals.indexOf(t);return-1!==e||(e=this.usedTemplateLocals.length,this.usedTemplateLocals.push(t)),[e,!0]}getLocalsMap(){return u()}getDebugInfo(){return Object.values(this.getLocalsMap())}allocateFree(t,e){e.resolution()===g.GetFreeAsComponentHead&&e.isAngleBracket&&(t=this.options.customizeComponentName(t));let s=this.upvars.indexOf(t);return-1!==s||(s=this.upvars.length,this.upvars.push(t)),s}allocateNamed(t){let e=this.named[t];return e||(e=this.named[t]=this.allocate(t)),e}allocateBlock(t){"inverse"===t&&(t="else");let e=this.blocks[t];return e||(e=this.blocks[t]=this.allocate(`&${t}`)),e}allocate(t){return this.symbols.push(t),this.size++}}class Ye extends Re{constructor(t,e,s){super(),this.parent=t,this.symbols=e,this.slots=s}get locals(){return this.symbols}getLexical(t){return this.parent.getLexical(t)}hasLexical(t){return this.parent.hasLexical(t)}has(t){return-1!==this.symbols.indexOf(t)||this.parent.has(t)}get(t){let e=this.#e(t);return e?[e,!1]:this.parent.get(t)}#e(t){let e=this.symbols.indexOf(t);return-1===e?null:a(this.slots[e])}getLocalsMap(){let t=this.parent.getLocalsMap();return this.symbols.forEach((e=>t[e]=this.get(e)[0])),t}getDebugInfo(){return Object.values(this.getLocalsMap())}setHasDebugger(){this.parent.setHasDebugger()}allocateFree(t,e){return this.parent.allocateFree(t,e)}allocateNamed(t){return this.parent.allocateNamed(t)}allocateBlock(t){return this.parent.allocateBlock(t)}allocate(t){return this.parent.allocate(t)}}var Ke=Object.freeze({__proto__:null});class Qe{template(t,e,s){return new Ee({table:t,body:e,loc:s})}block(t,e,s){return new Ae({scope:t,body:e,loc:s})}namedBlock(t,e,s){return new Be({name:t,block:e,attrs:[],componentArgs:[],modifiers:[],loc:s})}simpleNamedBlock(t,e,s){return new qe({selfClosing:!1,attrs:[],componentArgs:[],modifiers:[],comments:[]}).named(t,e,s)}slice(t,e){return new J({loc:e,chars:t})}args(t,e,s){return new oe({loc:s,positional:t,named:e})}positional(t,e){return new le({loc:e,exprs:t})}namedArgument(t,e){return new he({name:t,value:e})}named(t,e){return new ce({loc:e,entries:t})}attr({name:t,value:e,trusting:s},r){return new ue({loc:r,name:t,value:e,trusting:s})}splatAttr(t,e){return new de({symbol:t,loc:e})}arg({name:t,value:e,trusting:s},r){return new pe({name:t,value:e,trusting:s,loc:r})}path(t,e,s){return new Pe({loc:s,ref:t,tail:e})}self(t){return new Le({loc:t})}at(e,s,r){return t("@"===e[0],"call builders.at() with a string that starts with '@'"),new He({loc:r,name:new J({loc:r,chars:e}),symbol:s})}freeVar({name:e,context:s,symbol:r,loc:n}){return t("this"!==e,"You called builders.freeVar() with 'this'. Call builders.this instead"),t("@"!==e[0],`You called builders.freeVar() with '${e}'. Call builders.at('${e}') instead`),new Me({name:e,resolution:s,symbol:r,loc:n})}localVar(e,s,r,n){return t("this"!==e,"You called builders.var() with 'this'. Call builders.this instead"),t("@"!==e[0],`You called builders.var() with '${e}'. Call builders.at('${e}') instead`),new Oe({loc:n,name:e,isTemplateLocal:r,symbol:s})}sexp(t,e){return new xe({loc:e,callee:t.callee,args:t.args})}deprecatedCall(t,e,s){return new Ce({loc:s,arg:t,callee:e})}interpolate(t,e){return h(t),new Ne({loc:e,parts:t})}literal(t,e){return new ve({loc:e,value:t})}append({table:t,trusting:e,value:s},r){return new ke({table:t,trusting:e,value:s,loc:r})}modifier({callee:t,args:e},s){return new me({loc:s,callee:t,args:e})}namedBlocks(t,e){return new Te({loc:e,blocks:t})}blockStatement({program:t,inverse:e=null,...s},r){let n=t.loc,a=[this.namedBlock(J.synthetic("default"),t,t.loc)];return e&&(n=n.extend(e.loc),a.push(this.namedBlock(J.synthetic("else"),e,e.loc))),new we({loc:r,blocks:this.namedBlocks(a,n),callee:s.callee,args:s.args})}element(t){return new qe(t)}}class qe{builder;constructor(t){this.base=t,this.builder=new Qe}simple(t,e,s){return new Se(l({tag:t,body:e,componentArgs:[],loc:s},this.base))}named(t,e,s){return new Be(l({name:t,block:e,componentArgs:[],loc:s},this.base))}selfClosingComponent(t,e){return new ye(l({loc:e,callee:t,blocks:new Te({blocks:[],loc:e.sliceEndChars({skipEnd:1,chars:1})})},this.base))}componentWithDefaultBlock(t,e,s,r){let n=this.builder.block(s,e,r),a=this.builder.namedBlock(J.synthetic("default"),n,r);return new ye(l({loc:r,callee:t,blocks:this.builder.namedBlocks([a],a.loc)},this.base))}componentWithNamedBlocks(t,e,s){return new ye(l({loc:s,callee:t,blocks:this.builder.namedBlocks(e,at.range(e))},this.base))}}function We(t){return es(t)?_e.namespaced(Ve):null}function Xe(t){return es(t)?_e.namespaced(Ue):null}function Ze(t){return es(t)?_e.namespaced(De):_e.fallback()}function ts(t){return ss(t)?_e.namespaced(Ie.Component,!0):null}function es(t){return ss(t.path)}function ss(t){return"PathExpression"===t.type&&"VarHead"===t.head.type&&0===t.tail.length}function rs(t){return t.params.length>0||t.hash.pairs.length>0}function ns(t,e={lexicalScope:()=>!1}){let s=re(t,e),r={strictMode:!1,locals:[],...e},n=Re.top(r.locals,{customizeComponentName:e.customizeComponentName??(t=>t),lexicalScope:e.lexicalScope}),a=new as(t,r,n),i=new os(a),o=new hs(a.loc(s.loc),s.body.map((t=>i.normalize(t))),a).assertTemplate(n);return[o,n.getUsedTemplateLocals()]}class as{builder;constructor(t,e,s){this.source=t,this.options=e,this.table=s,this.builder=new Qe}get strict(){return this.options.strictMode||!1}loc(t){return this.source.spanFor(t)}resolutionFor(t,e){if(this.strict)return{result:Fe};if(this.isFreeVar(t)){let s=e(t);return null===s?{result:"error",path:ps(t),head:ms(t)}:{result:s}}return{result:Fe}}isLexicalVar(t){return this.table.hasLexical(t)}isFreeVar(t){return"PathExpression"===t.type?"VarHead"===t.head.type&&!this.table.has(t.head.name):"PathExpression"===t.path.type&&this.isFreeVar(t.path)}hasBinding(t){return this.table.has(t)||this.table.hasLexical(t)}child(t){return new as(this.source,this.options,this.table.child(t))}customizeComponentName(t){return this.options.customizeComponentName?this.options.customizeComponentName(t):t}}class is{constructor(t){this.block=t}normalize(t,e){switch(t.type){case"NullLiteral":case"BooleanLiteral":case"NumberLiteral":case"StringLiteral":case"UndefinedLiteral":return this.block.builder.literal(t.value,this.block.loc(t.loc));case"PathExpression":return this.path(t,e);case"SubExpression":{let e=this.block.resolutionFor(t,We);if("error"===e.result)throw ht(`You attempted to invoke a path (\`${e.path}\`) but ${e.head} was not in scope`,t.loc);return this.block.builder.sexp(this.callParts(t,e.result),this.block.loc(t.loc))}}}path(t,e){let s=[],r=this.block.loc(t.head.loc);for(let e of t.tail)r=r.sliceStartChars({chars:e.length,skipStart:1}),s.push(new J({loc:r,chars:e}));return this.block.builder.path(this.ref(t.head,e),s,this.block.loc(t.loc))}callParts(t,e){let{path:s,params:r,hash:n}=t,a=this.normalize(s,e),i=r.map((t=>this.normalize(t,ze))),o=at.range(i,a.loc.collapse("end")),l=this.block.loc(n.loc),c=at.range([o,l]),h=this.block.builder.positional(r.map((t=>this.normalize(t,ze))),o),u=this.block.builder.named(n.pairs.map((t=>this.namedArgument(t))),this.block.loc(n.loc));return{callee:a,args:this.block.builder.args(h,u,c)}}namedArgument(t){let e=this.block.loc(t.loc).sliceStartChars({chars:t.key.length});return this.block.builder.namedArgument(new J({chars:t.key,loc:e}),this.normalize(t.value,ze))}ref(t,e){let{block:s}=this,{builder:r,table:n}=s,a=s.loc(t.loc);switch(t.type){case"ThisHead":return r.self(a);case"AtHead":{let e=n.allocateNamed(t.name);return r.at(t.name,e,a)}case"VarHead":if(s.hasBinding(t.name)){let[e,r]=n.get(t.name);return s.builder.localVar(t.name,e,r,a)}{let r=s.strict?Fe:e,n=s.table.allocateFree(t.name,r);return s.builder.freeVar({name:t.name,context:r,symbol:n,loc:a})}}}}class os{constructor(t){this.block=t}normalize(t){switch(t.type){case"PartialStatement":throw new Error("Handlebars partial syntax ({{> ...}}) is not allowed in Glimmer");case"BlockStatement":return this.BlockStatement(t);case"ElementNode":return new ls(this.block).ElementNode(t);case"MustacheStatement":return this.MustacheStatement(t);case"MustacheCommentStatement":return this.MustacheCommentStatement(t);case"CommentStatement":{let e=this.block.loc(t.loc);return new ge({loc:e,text:e.slice({skipStart:4,skipEnd:3}).toSlice(t.value)})}case"TextNode":return new be({loc:this.block.loc(t.loc),chars:t.chars})}}MustacheCommentStatement(t){let e,s=this.block.loc(t.loc);return e="{{!--"===s.asString().slice(0,5)?s.slice({skipStart:5,skipEnd:4}):s.slice({skipStart:3,skipEnd:2}),new fe({loc:s,text:e.toSlice(t.value)})}MustacheStatement(t){let{escaped:e}=t,s=this.block.loc(t.loc),r=this.expr.callParts({path:t.path,params:t.params,hash:t.hash},function(t){let e=es(t),s=rs(t),r=t.trusting;return e?r?_e.trustingAppend({invoke:s}):_e.append({invoke:s}):_e.fallback()}(t)),n=r.args.isEmpty()?r.callee:this.block.builder.sexp(r,s);return this.block.builder.append({table:this.block.table,trusting:!e,value:n},s)}BlockStatement(t){let{program:e,inverse:s}=t,r=this.block.loc(t.loc),n=this.block.resolutionFor(t,Ze);if("error"===n.result)throw ht(`You attempted to invoke a path (\`{{#${n.path}}}\`) but ${n.head} was not in scope`,r);let a=this.expr.callParts(t,n.result);return this.block.builder.blockStatement(l({symbols:this.block.table,program:this.Block(e),inverse:s?this.Block(s):null},a),r)}Block({body:t,loc:e,blockParams:s}){let r=this.block.child(s),n=new os(r);return new us(this.block.loc(e),t.map((t=>n.normalize(t))),this.block).assertBlock(r.table)}get expr(){return new is(this.block)}}class ls{constructor(t){this.ctx=t}ElementNode(t){let{tag:e,selfClosing:s,comments:r}=t,n=this.ctx.loc(t.loc),[a,...i]=c(e.split(".")),o=this.classifyTag(a,i,t.loc),l=t.attributes.filter((t=>"@"!==t.name[0])).map((t=>this.attr(t))),h=t.attributes.filter((t=>"@"===t.name[0])).map((t=>this.arg(t))),u=t.modifiers.map((t=>this.modifier(t))),d=this.ctx.child(t.blockParams),p=new os(d),m=t.children.map((t=>p.normalize(t))),f=this.ctx.builder.element({selfClosing:s,attrs:l,componentArgs:h,modifiers:u,comments:r.map((t=>new os(this.ctx).MustacheCommentStatement(t)))}),b=new ds(f,n,m,this.ctx),g=this.ctx.loc(t.loc).sliceStartChars({chars:e.length,skipStart:1});if("ElementHead"===o)return":"===e[0]?b.assertNamedBlock(g.slice({skipStart:1}).toSlice(e.slice(1)),d.table):b.assertElement(g.toSlice(e),t.blockParams.length>0);if(t.selfClosing)return f.selfClosingComponent(o,n);{let s=b.assertComponent(e,d.table,t.blockParams.length>0);return f.componentWithNamedBlocks(o,s,n)}}modifier(t){let e=this.ctx.resolutionFor(t,Xe);if("error"===e.result)throw ht(`You attempted to invoke a path (\`{{#${e.path}}}\`) as a modifier, but ${e.head} was not in scope. Try adding \`this\` to the beginning of the path`,t.loc);let s=this.expr.callParts(t,e.result);return this.ctx.builder.modifier(s,this.ctx.loc(t.loc))}mustacheAttr(t){let e=this.ctx.builder.sexp(this.expr.callParts(t,function(t){let e=es(t),s=rs(t);return e?s?_e.namespaced(Ie.Helper):_e.attr():s?Fe:_e.fallback()}(t)),this.ctx.loc(t.loc));return e.args.isEmpty()?e.callee:e}attrPart(t){switch(t.type){case"MustacheStatement":return{expr:this.mustacheAttr(t),trusting:!t.escaped};case"TextNode":return{expr:this.ctx.builder.literal(t.chars,this.ctx.loc(t.loc)),trusting:!0}}}attrValue(t){if("ConcatStatement"===t.type){let e=t.parts.map((t=>this.attrPart(t).expr));return{expr:this.ctx.builder.interpolate(e,this.ctx.loc(t.loc)),trusting:!1}}return this.attrPart(t)}attr(e){if(t("@"!==e.name[0],"An attr name must not start with `@`"),"...attributes"===e.name)return this.ctx.builder.splatAttr(this.ctx.table.allocateBlock("attrs"),this.ctx.loc(e.loc));let s=this.ctx.loc(e.loc),r=s.sliceStartChars({chars:e.name.length}).toSlice(e.name),n=this.attrValue(e.value);return this.ctx.builder.attr({name:r,value:n.expr,trusting:n.trusting},s)}maybeDeprecatedCall(t,e){if(this.ctx.strict)return null;if("MustacheStatement"!==e.type)return null;let{path:s}=e;if("PathExpression"!==s.type)return null;if("VarHead"!==s.head.type)return null;let{name:r}=s.head;if("has-block"===r||"has-block-params"===r)return null;if(this.ctx.hasBinding(r))return null;if(0!==s.tail.length)return null;if(0!==e.params.length||0!==e.hash.pairs.length)return null;let n=_e.attr(),a=this.ctx.builder.freeVar({name:r,context:n,symbol:this.ctx.table.allocateFree(r,n),loc:s.loc});return{expr:this.ctx.builder.deprecatedCall(t,a,e.loc),trusting:!1}}arg(e){t("@"===e.name[0],"An arg name must start with `@`");let s=this.ctx.loc(e.loc),r=s.sliceStartChars({chars:e.name.length}).toSlice(e.name),n=this.maybeDeprecatedCall(r,e.value)||this.attrValue(e.value);return this.ctx.builder.arg({name:r,value:n.expr,trusting:n.trusting},s)}classifyTag(t,e,s){let r=(n=t)[0]===n[0]?.toUpperCase()&&n[0]!==n[0]?.toLowerCase();var n;let a="@"===t[0]||"this"===t||this.ctx.hasBinding(t);if(this.ctx.strict&&!a){if(r)throw ht(`Attempted to invoke a component that was not in scope in a strict mode template, \`<${t}>\`. If you wanted to create an element with that name, convert it to lowercase - \`<${t.toLowerCase()}>\``,s);return"ElementHead"}let i=a||r,o=s.sliceStartChars({skipStart:1,chars:t.length}),l=e.reduce(((t,e)=>t+1+e.length),0),c=o.getEnd().move(l),h=o.withEnd(c);if(i){let r=Kt.path({head:Kt.head(t,o),tail:e,loc:h}),n=this.ctx.isLexicalVar(t)?{result:Fe}:this.ctx.resolutionFor(r,ts);if("error"===n.result)throw ht(`You attempted to invoke a path (\`<${n.path}>\`) but ${n.head} was not in scope`,s);return new is(this.ctx).normalize(r,n.result)}if(this.ctx.table.allocateFree(t,Fe),e.length>0)throw ht(`You used ${t}.${e.join(".")} as a tag name, but ${t} is not in scope`,s);return"ElementHead"}get expr(){return new is(this.ctx)}}class cs{namedBlocks;hasSemanticContent;nonBlockChildren;constructor(t,e,s){this.loc=t,this.children=e,this.block=s,this.namedBlocks=e.filter((t=>t instanceof Be)),this.hasSemanticContent=Boolean(e.filter((t=>{if(t instanceof Be)return!1;switch(t.type){case"GlimmerComment":case"HtmlComment":return!1;case"HtmlText":return!/^\s*$/u.test(t.chars);default:return!0}})).length),this.nonBlockChildren=e.filter((t=>!(t instanceof Be)))}}class hs extends cs{assertTemplate(t){if(e(this.namedBlocks))throw ht("Unexpected named block at the top-level of a template",this.loc);return this.block.builder.template(t,this.nonBlockChildren,this.block.loc(this.loc))}}class us extends cs{assertBlock(t){if(e(this.namedBlocks))throw ht("Unexpected named block nested in a normal block",this.loc);return this.block.builder.block(t,this.nonBlockChildren,this.loc)}}class ds extends cs{constructor(t,e,s,r){super(e,s,r),this.el=t}assertNamedBlock(t,s){if(this.el.base.selfClosing)throw ht(`<:${t.chars}/> is not a valid named block: named blocks cannot be self-closing`,this.loc);if(e(this.namedBlocks))throw ht(`Unexpected named block inside <:${t.chars}> named block: named blocks cannot contain nested named blocks`,this.loc);if((r=t.chars)[0]!==r[0]?.toLowerCase()||r[0]===r[0]?.toUpperCase())throw ht(`<:${t.chars}> is not a valid named block, and named blocks must begin with a lowercase letter`,this.loc);var r;if(this.el.base.attrs.length>0||this.el.base.componentArgs.length>0||this.el.base.modifiers.length>0)throw ht(`named block <:${t.chars}> cannot have attributes, arguments, or modifiers`,this.loc);let n=at.range(this.nonBlockChildren,this.loc);return this.block.builder.namedBlock(t,this.block.builder.block(s,this.nonBlockChildren,n),this.loc)}assertElement(t,s){if(s)throw ht(`Unexpected block params in <${t}>: simple elements cannot have block params`,this.loc);if(e(this.namedBlocks)){let e=this.namedBlocks.map((t=>t.name));if(1===e.length)throw ht(`Unexpected named block <:foo> inside <${t.chars}> HTML element`,this.loc);{let s=e.map((t=>`<:${t.chars}>`)).join(", ");throw ht(`Unexpected named blocks inside <${t.chars}> HTML element (${s})`,this.loc)}}return this.el.simple(t,this.nonBlockChildren,this.loc)}assertComponent(t,s,r){if(e(this.namedBlocks)&&this.hasSemanticContent)throw ht(`Unexpected content inside <${t}> component invocation: when using named blocks, the tag cannot contain other content`,this.loc);if(e(this.namedBlocks)){if(r)throw ht(`Unexpected block params list on <${t}> component invocation: when passing named blocks, the invocation tag cannot take block params`,this.loc);let e=new Set;for(let t of this.namedBlocks){let s=t.name.chars;if(e.has(s))throw ht(`Component had two named blocks with the same name, \`<:${s}>\`. Only one block with a given name may be passed`,this.loc);if("inverse"===s&&e.has("else")||"else"===s&&e.has("inverse"))throw ht("Component has both <:else> and <:inverse> block. <:inverse> is an alias for <:else>",this.loc);e.add(s)}return this.namedBlocks}return[this.block.builder.namedBlock(J.synthetic("default"),this.block.builder.block(s,this.nonBlockChildren,this.loc),this.loc)]}}function ps(t){return"PathExpression"!==t.type&&"PathExpression"===t.path.type?ps(t.path):new B({entityEncoding:"raw"}).print(t)}function ms(t){if("PathExpression"!==t.type)return"PathExpression"===t.path.type?ms(t.path):new B({entityEncoding:"raw"}).print(t);switch(t.head.type){case"AtHead":case"VarHead":return t.head.name;case"ThisHead":return"this"}}export{Ke as AST,Ke as ASTv1,Ge as ASTv2,Ye as BlockSymbolTable,O as KEYWORDS_TYPES,Nt as Path,Je as ProgramSymbolTable,J as SourceSlice,at as SpanList,Re as SymbolTable,Nt as Walker,bt as WalkerPath,Gt as builders,pt as cannotRemoveNode,mt as cannotReplaceNode,ht as generateSyntaxError,ae as getTemplateLocals,E as getVoidTags,ot as hasSpan,H as isKeyword,T as isVoidTag,it as loc,lt as maybeLoc,ie as node,ns as normalize,re as preprocess,L as print,C as sortByLoc,ct as src,Ct as traverse,ut as visitorKeys};
//# sourceMappingURL=index.js.map
