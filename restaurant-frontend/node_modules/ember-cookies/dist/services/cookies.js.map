{"version":3,"file":"cookies.js","sources":["../../src/services/cookies.js"],"sourcesContent":["import { isNone, isPresent, isEmpty } from '@ember/utils';\nimport { get } from '@ember/object';\nimport { assert } from '@ember/debug';\nimport { getOwner } from '@ember/application';\nimport Service from '@ember/service';\nimport { serializeCookie } from '../utils/serialize-cookie';\nconst { keys } = Object;\nconst DEFAULTS = { raw: false };\nconst MAX_COOKIE_BYTE_LENGTH = 4096;\n\nexport default class CookiesService extends Service {\n  constructor() {\n    super(...arguments);\n\n    this._document = this._document || window.document;\n    if (typeof this._fastBoot === 'undefined') {\n      let owner = getOwner(this);\n\n      this._fastBoot = owner.lookup('service:fastboot');\n    }\n  }\n\n  _getDocumentCookies() {\n    let all = this._document.cookie.split(';');\n    let filtered = this._filterDocumentCookies(all);\n\n    return filtered.reduce((acc, cookie) => {\n      if (!isEmpty(cookie)) {\n        let [key, value] = cookie;\n        acc[key.trim()] = (value || '').trim();\n      }\n      return acc;\n    }, {});\n  }\n\n  _getFastBootCookies() {\n    let fastBootCookies = this._fastBoot.request.cookies;\n    fastBootCookies = keys(fastBootCookies).reduce((acc, name) => {\n      let value = fastBootCookies[name];\n      acc[name] = { value };\n      return acc;\n    }, {});\n\n    let fastBootCookiesCache = this._fastBootCookiesCache || {};\n    fastBootCookies = Object.assign({}, fastBootCookies, fastBootCookiesCache);\n    this._fastBootCookiesCache = fastBootCookies;\n\n    return this._filterCachedFastBootCookies(fastBootCookies);\n  }\n\n  read(name, options = {}) {\n    options = Object.assign({}, DEFAULTS, options || {});\n    assert(\n      'Domain, Expires, Max-Age, and Path options cannot be set when reading cookies',\n      isEmpty(options.domain) &&\n        isEmpty(options.expires) &&\n        isEmpty(options.maxAge) &&\n        isEmpty(options.path)\n    );\n\n    let all;\n    if (this._isFastBoot()) {\n      all = this._getFastBootCookies();\n    } else {\n      all = this._getDocumentCookies();\n    }\n\n    if (name) {\n      return this._decodeValue(all[name], options.raw);\n    } else {\n      keys(all).forEach(name => (all[name] = this._decodeValue(all[name], options.raw)));\n      return all;\n    }\n  }\n\n  write(name, value, options = {}) {\n    options = Object.assign({}, DEFAULTS, options || {});\n    assert(\n      \"Cookies cannot be set as signed as signed cookies would not be modifyable in the browser as it has no knowledge of the express server's signing key!\",\n      !options.signed\n    );\n    assert(\n      'Cookies cannot be set with both maxAge and an explicit expiration time!',\n      isEmpty(options.expires) || isEmpty(options.maxAge)\n    );\n\n    value = this._encodeValue(value, options.raw);\n\n    assert(\n      `Cookies larger than ${MAX_COOKIE_BYTE_LENGTH} bytes are not supported by most browsers!`,\n      this._isCookieSizeAcceptable(value)\n    );\n\n    if (this._isFastBoot()) {\n      this._writeFastBootCookie(name, value, options);\n    } else {\n      assert('Cookies cannot be set to be HTTP-only from a browser!', !options.httpOnly);\n\n      options.path = options.path || this._normalizedDefaultPath();\n      this._writeDocumentCookie(name, value, options);\n    }\n  }\n\n  clear(name, options = {}) {\n    options = Object.assign({}, options || {});\n    assert(\n      'Expires, Max-Age, and raw options cannot be set when clearing cookies',\n      isEmpty(options.expires) && isEmpty(options.maxAge) && isEmpty(options.raw)\n    );\n\n    options.expires = new Date('1970-01-01');\n    options.path = options.path || this._normalizedDefaultPath();\n    this.write(name, null, options);\n  }\n\n  exists(name) {\n    let all;\n    if (this._isFastBoot()) {\n      all = this._getFastBootCookies();\n    } else {\n      all = this._getDocumentCookies();\n    }\n\n    return Object.prototype.hasOwnProperty.call(all, name);\n  }\n\n  _writeDocumentCookie(name, value, options = {}) {\n    let serializedCookie = this._serializeCookie(name, value, options);\n    this._document.cookie = serializedCookie;\n  }\n\n  _writeFastBootCookie(name, value, options = {}) {\n    let responseHeaders = this._fastBoot.response.headers;\n    let serializedCookie = this._serializeCookie(...arguments);\n\n    if (!isEmpty(options.maxAge)) {\n      options.maxAge *= 1000;\n    }\n\n    this._cacheFastBootCookie(...arguments);\n\n    let replaced = false;\n    let existing = responseHeaders.getAll('set-cookie');\n\n    for (let i = 0; i < existing.length; i++) {\n      if (existing[i].startsWith(`${name}=`)) {\n        existing[i] = serializedCookie;\n        replaced = true;\n        break;\n      }\n    }\n\n    if (!replaced) {\n      responseHeaders.append('set-cookie', serializedCookie);\n    }\n  }\n\n  _cacheFastBootCookie(name, value, options = {}) {\n    let fastBootCache = this._fastBootCookiesCache || {};\n    let cachedOptions = Object.assign({}, options);\n\n    if (cachedOptions.maxAge) {\n      let expires = new Date();\n      expires.setSeconds(expires.getSeconds() + options.maxAge);\n      cachedOptions.expires = expires;\n      delete cachedOptions.maxAge;\n    }\n\n    fastBootCache[name] = { value, options: cachedOptions };\n    this._fastBootCookiesCache = fastBootCache;\n  }\n\n  _filterCachedFastBootCookies(fastBootCookies) {\n    let { path: requestPath } = this._fastBoot.request;\n\n    // cannot use deconstruct here\n    // eslint-disable-next-line ember/no-get\n    let host = get(this._fastBoot, 'request.host');\n\n    return keys(fastBootCookies).reduce((acc, name) => {\n      let { value, options } = fastBootCookies[name];\n      options = options || {};\n\n      let { path: optionsPath, domain, expires } = options;\n\n      if (optionsPath && requestPath.indexOf(optionsPath) !== 0) {\n        return acc;\n      }\n\n      if (domain && host.indexOf(domain) + domain.length !== host.length) {\n        return acc;\n      }\n\n      if (expires && expires < new Date()) {\n        return acc;\n      }\n\n      acc[name] = value;\n      return acc;\n    }, {});\n  }\n\n  _encodeValue(value, raw) {\n    if (isNone(value)) {\n      return '';\n    } else if (raw) {\n      return value;\n    } else {\n      return encodeURIComponent(value);\n    }\n  }\n\n  _decodeValue(value, raw) {\n    if (isNone(value) || raw) {\n      return value;\n    } else {\n      return decodeURIComponent(value);\n    }\n  }\n\n  _filterDocumentCookies(unfilteredCookies) {\n    return unfilteredCookies\n      .map(c => {\n        let separatorIndex = c.indexOf('=');\n        return [c.substring(0, separatorIndex), c.substring(separatorIndex + 1)];\n      })\n      .filter(c => c.length === 2 && isPresent(c[0]));\n  }\n\n  _serializeCookie(name, value, options = {}) {\n    return serializeCookie(name, value, options);\n  }\n\n  _isCookieSizeAcceptable(value) {\n    // Counting bytes varies Pre-ES6 and in ES6\n    // This snippet counts the bytes in the value\n    // about to be stored as the cookie:\n    // See https://stackoverflow.com/a/25994411/6657064\n    let _byteCount = 0;\n    let i = 0;\n    let c;\n    while ((c = value.charCodeAt(i++))) {\n      /* eslint-disable no-bitwise */\n      _byteCount += c >> 11 ? 3 : c >> 7 ? 2 : 1;\n      /* eslint-enable no-bitwise */\n    }\n\n    return _byteCount < MAX_COOKIE_BYTE_LENGTH;\n  }\n\n  _normalizedDefaultPath() {\n    if (!this._isFastBoot()) {\n      let pathname = window.location.pathname;\n      return pathname.substring(0, pathname.lastIndexOf('/'));\n    }\n  }\n\n  _isFastBoot() {\n    return this._fastBoot && this._fastBoot.isFastBoot;\n  }\n}\n"],"names":["keys","Object","DEFAULTS","raw","MAX_COOKIE_BYTE_LENGTH","CookiesService","Service","constructor","arguments","_document","window","document","_fastBoot","owner","getOwner","lookup","_getDocumentCookies","all","cookie","split","filtered","_filterDocumentCookies","reduce","acc","isEmpty","key","value","trim","_getFastBootCookies","fastBootCookies","request","cookies","name","fastBootCookiesCache","_fastBootCookiesCache","assign","_filterCachedFastBootCookies","read","options","assert","domain","expires","maxAge","path","_isFastBoot","_decodeValue","forEach","write","signed","_encodeValue","_isCookieSizeAcceptable","_writeFastBootCookie","httpOnly","_normalizedDefaultPath","_writeDocumentCookie","clear","Date","exists","prototype","hasOwnProperty","call","serializedCookie","_serializeCookie","responseHeaders","response","headers","_cacheFastBootCookie","replaced","existing","getAll","i","length","startsWith","append","fastBootCache","cachedOptions","setSeconds","getSeconds","requestPath","host","get","optionsPath","indexOf","isNone","encodeURIComponent","decodeURIComponent","unfilteredCookies","map","c","separatorIndex","substring","filter","isPresent","serializeCookie","_byteCount","charCodeAt","pathname","location","lastIndexOf","isFastBoot"],"mappings":"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"}