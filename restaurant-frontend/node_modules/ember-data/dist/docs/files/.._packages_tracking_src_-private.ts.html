<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../packages/tracking/src/-private.ts - EmberData Documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EmberData Documentation" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 5.3.3+58cd284b</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/&lt;Interface&gt; Adapter.html">&lt;Interface&gt; Adapter</a></li>
                                <li><a href="../classes/&lt;Interface&gt; Cache.html">&lt;Interface&gt; Cache</a></li>
                                <li><a href="../classes/&lt;Interface&gt; Handler.html">&lt;Interface&gt; Handler</a></li>
                                <li><a href="../classes/&lt;Interface&gt; LifetimesService.html">&lt;Interface&gt; LifetimesService</a></li>
                                <li><a href="../classes/&lt;Interface&gt; Serializer.html">&lt;Interface&gt; Serializer</a></li>
                                <li><a href="../classes/@ember-data/active-record/request.html">@ember-data/active-record/request</a></li>
                                <li><a href="../classes/@ember-data/adapter/rest.html">@ember-data/adapter/rest</a></li>
                                <li><a href="../classes/@ember-data/json-api/request.html">@ember-data/json-api/request</a></li>
                                <li><a href="../classes/@ember-data/model.html">@ember-data/model</a></li>
                                <li><a href="../classes/@ember-data/request-utils.html">@ember-data/request-utils</a></li>
                                <li><a href="../classes/@ember-data/rest/request.html">@ember-data/rest/request</a></li>
                                <li><a href="../classes/@ember-data/store.html">@ember-data/store</a></li>
                                <li><a href="../classes/@ember-data/tracking.html">@ember-data/tracking</a></li>
                                <li><a href="../classes/AbortError.html">AbortError</a></li>
                                <li><a href="../classes/Adapter.html">Adapter</a></li>
                                <li><a href="../classes/AdapterError.html">AdapterError</a></li>
                                <li><a href="../classes/BelongsToReference.html">BelongsToReference</a></li>
                                <li><a href="../classes/BooleanTransform.html">BooleanTransform</a></li>
                                <li><a href="../classes/BuildURLMixin.html">BuildURLMixin</a></li>
                                <li><a href="../classes/Cache.html">Cache</a></li>
                                <li><a href="../classes/CacheCapabilitiesManager.html">CacheCapabilitiesManager</a></li>
                                <li><a href="../classes/CacheManager.html">CacheManager</a></li>
                                <li><a href="../classes/CanaryFeatureFlags.html">CanaryFeatureFlags</a></li>
                                <li><a href="../classes/ConflictError.html">ConflictError</a></li>
                                <li><a href="../classes/CurrentDeprecations.html">CurrentDeprecations</a></li>
                                <li><a href="../classes/DateTransform.html">DateTransform</a></li>
                                <li><a href="../classes/DebugLogging.html">DebugLogging</a></li>
                                <li><a href="../classes/Document.html">Document</a></li>
                                <li><a href="../classes/EmbeddedRecordsMixin.html">EmbeddedRecordsMixin</a></li>
                                <li><a href="../classes/Errors.html">Errors</a></li>
                                <li><a href="../classes/Fetch.html">Fetch</a></li>
                                <li><a href="../classes/ForbiddenError.html">ForbiddenError</a></li>
                                <li><a href="../classes/Future.html">Future</a></li>
                                <li><a href="../classes/HasManyReference.html">HasManyReference</a></li>
                                <li><a href="../classes/IdentifierCache.html">IdentifierCache</a></li>
                                <li><a href="../classes/InspectorDataAdapter.html">InspectorDataAdapter</a></li>
                                <li><a href="../classes/InvalidError.html">InvalidError</a></li>
                                <li><a href="../classes/JSONAPIAdapter.html">JSONAPIAdapter</a></li>
                                <li><a href="../classes/JSONAPISerializer.html">JSONAPISerializer</a></li>
                                <li><a href="../classes/JSONSerializer.html">JSONSerializer</a></li>
                                <li><a href="../classes/LifetimesService.html">LifetimesService</a></li>
                                <li><a href="../classes/ManyArray.html">ManyArray</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/NotFoundError.html">NotFoundError</a></li>
                                <li><a href="../classes/NotificationManager.html">NotificationManager</a></li>
                                <li><a href="../classes/NumberTransform.html">NumberTransform</a></li>
                                <li><a href="../classes/PromiseBelongsTo.html">PromiseBelongsTo</a></li>
                                <li><a href="../classes/PromiseManyArray.html">PromiseManyArray</a></li>
                                <li><a href="../classes/RecordArray.html">RecordArray</a></li>
                                <li><a href="../classes/RecordReference.html">RecordReference</a></li>
                                <li><a href="../classes/RequestManager.html">RequestManager</a></li>
                                <li><a href="../classes/RequestStateService.html">RequestStateService</a></li>
                                <li><a href="../classes/RESTAdapter.html">RESTAdapter</a></li>
                                <li><a href="../classes/RESTSerializer.html">RESTSerializer</a></li>
                                <li><a href="../classes/SchemaService.html">SchemaService</a></li>
                                <li><a href="../classes/Serializer.html">Serializer</a></li>
                                <li><a href="../classes/ServerError.html">ServerError</a></li>
                                <li><a href="../classes/Snapshot.html">Snapshot</a></li>
                                <li><a href="../classes/SnapshotRecordArray.html">SnapshotRecordArray</a></li>
                                <li><a href="../classes/StableRecordIdentifier.html">StableRecordIdentifier</a></li>
                                <li><a href="../classes/Store.html">Store</a></li>
                                <li><a href="../classes/StringTransform.html">StringTransform</a></li>
                                <li><a href="../classes/TimeoutError.html">TimeoutError</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/UnauthorizedError.html">UnauthorizedError</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/@ember-data_active-record_request.html">@ember-data/active-record/request</a></li>
                                <li><a href="../modules/@ember-data_adapter.html">@ember-data/adapter</a></li>
                                <li><a href="../modules/@ember-data_adapter_error.html">@ember-data/adapter/error</a></li>
                                <li><a href="../modules/@ember-data_adapter_json-api.html">@ember-data/adapter/json-api</a></li>
                                <li><a href="../modules/@ember-data_adapter_rest.html">@ember-data/adapter/rest</a></li>
                                <li><a href="../modules/@ember-data_canary-features.html">@ember-data/canary-features</a></li>
                                <li><a href="../modules/@ember-data_debug.html">@ember-data/debug</a></li>
                                <li><a href="../modules/@ember-data_deprecations.html">@ember-data/deprecations</a></li>
                                <li><a href="../modules/@ember-data_experimental-preview-types.html">@ember-data/experimental-preview-types</a></li>
                                <li><a href="../modules/@ember-data_graph.html">@ember-data/graph</a></li>
                                <li><a href="../modules/@ember-data_json-api.html">@ember-data/json-api</a></li>
                                <li><a href="../modules/@ember-data_json-api_request.html">@ember-data/json-api/request</a></li>
                                <li><a href="../modules/@ember-data_legacy-compat.html">@ember-data/legacy-compat</a></li>
                                <li><a href="../modules/@ember-data_model.html">@ember-data/model</a></li>
                                <li><a href="../modules/@ember-data_request.html">@ember-data/request</a></li>
                                <li><a href="../modules/@ember-data_request-utils.html">@ember-data/request-utils</a></li>
                                <li><a href="../modules/@ember-data_request_fetch.html">@ember-data/request/fetch</a></li>
                                <li><a href="../modules/@ember-data_rest_request.html">@ember-data/rest/request</a></li>
                                <li><a href="../modules/@ember-data_serializer.html">@ember-data/serializer</a></li>
                                <li><a href="../modules/@ember-data_serializer_json.html">@ember-data/serializer/json</a></li>
                                <li><a href="../modules/@ember-data_serializer_json-api.html">@ember-data/serializer/json-api</a></li>
                                <li><a href="../modules/@ember-data_serializer_rest.html">@ember-data/serializer/rest</a></li>
                                <li><a href="../modules/@ember-data_store.html">@ember-data/store</a></li>
                                <li><a href="../modules/@ember-data_tracking.html">@ember-data/tracking</a></li>
                                <li><a href="../modules/ember-data-overview.html">ember-data-overview</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../packages/tracking/src/-private.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import { tagForProperty } from &#x27;@ember/-internals/metal&#x27;;
import { consumeTag, dirtyTag } from &#x27;@glimmer/validator&#x27;;

import { DEPRECATE_COMPUTED_CHAINS } from &#x27;@ember-data/deprecations&#x27;;
import { DEBUG } from &#x27;@ember-data/env&#x27;;

/**
 * This package provides primitives that allow powerful low-level
 * adjustments to change tracking notification behaviors.
 *
 * Typically you want to use these primitives when you want to divorce
 * property accesses on EmberData provided objects from the current
 * tracking context. Typically this sort of thing occurs when serializing
 * tracked data to send in a request: the data itself is often ancillary
 * to the thing which triggered the request in the first place and you
 * would not want to re-trigger the request for any update to the data.
 *
 * @module @ember-data/tracking
 * @main @ember-data/tracking
 */
type OpaqueFn = (...args: unknown[]) =&gt; unknown;
type Tag = { ref: null; t: boolean };
type Transaction = {
  cbs: Set&lt;OpaqueFn&gt;;
  props: Set&lt;Tag | Signal&gt;;
  sub: Set&lt;Tag | Signal&gt;;
  parent: Transaction | null;
};
let TRANSACTION: Transaction | null = null;

function createTransaction() {
  const transaction: Transaction = {
    cbs: new Set(),
    props: new Set(),
    sub: new Set(),
    parent: null,
  };
  if (TRANSACTION) {
    transaction.parent = TRANSACTION;
  }
  TRANSACTION = transaction;
}

function maybeConsume(tag: ReturnType&lt;typeof tagForProperty&gt; | null): void {
  if (tag) {
    consumeTag(tag);
  }
}

function maybeDirty(tag: ReturnType&lt;typeof tagForProperty&gt; | null): void {
  if (tag) {
    // @ts-expect-error - we are using Ember&#x27;s Tag not Glimmer&#x27;s
    dirtyTag(tag);
  }
}

/**
 * If there is a current transaction, ensures that the relevant tag (and any
 * array computed chains symbols, if applicable) will be consumed during the
 * transaction.
 *
 * If there is no current transaction, will consume the tag(s) immediately.
 *
 * @internal
 * @param obj
 */
export function subscribe(obj: Tag | Signal): void {
  if (TRANSACTION) {
    TRANSACTION.sub.add(obj);
  } else if (&#x27;tag&#x27; in obj) {
    if (DEPRECATE_COMPUTED_CHAINS) {
      maybeConsume(obj[&#x27;[]&#x27;]);
      maybeConsume(obj[&#x27;@length&#x27;]);
    }
    consumeTag(obj.tag);
  } else {
    obj.ref;
  }
}

function updateRef(obj: Tag | Signal): void {
  if (DEBUG) {
    try {
      if (&#x27;tag&#x27; in obj) {
        if (DEPRECATE_COMPUTED_CHAINS) {
          maybeDirty(obj[&#x27;[]&#x27;]);
          maybeDirty(obj[&#x27;@length&#x27;]);
        }
        // @ts-expect-error - we are using Ember&#x27;s Tag not Glimmer&#x27;s
        dirtyTag(obj.tag);
      } else {
        obj.ref = null;
      }
    } catch (e: unknown) {
      if (e instanceof Error) {
        if (e.message.includes(&#x27;You attempted to update &#x60;undefined&#x60;&#x27;)) {
          // @ts-expect-error
          const key = &#x60;&lt;${obj._debug_base}&gt;.${obj.key}&#x60;;
          e.message = e.message.replace(&#x27;You attempted to update &#x60;undefined&#x60;&#x27;, &#x60;You attempted to update ${key}&#x60;);
          e.stack = e.stack?.replace(&#x27;You attempted to update &#x60;undefined&#x60;&#x27;, &#x60;You attempted to update ${key}&#x60;);

          const lines = e.stack?.split(&#x60;\n&#x60;);
          const finalLines: string[] = [];
          let lastFile: string | null = null;

          lines?.forEach((line) =&gt; {
            if (line.trim().startsWith(&#x27;at &#x27;)) {
              // get the last string in the line which contains the code source location
              const location = line.split(&#x27; &#x27;).at(-1)!;
              // remove the line and char offset info

              if (location.includes(&#x27;:&#x27;)) {
                const parts = location.split(&#x27;:&#x27;);
                parts.pop();
                parts.pop();
                const file = parts.join(&#x27;:&#x27;);
                if (file !== lastFile) {
                  lastFile = file;
                  finalLines.push(&#x27;&#x27;);
                }
              }
              finalLines.push(line);
            }
          });

          const splitstr = &#x27;&#x60;undefined&#x60; was first used:&#x27;;
          const parts = e.message.split(splitstr);
          parts.splice(1, 0, &#x60;Original Stack\n=============\n${finalLines.join(&#x60;\n&#x60;)}\n\n\&#x60;${key}\&#x60; was first used:&#x60;);

          e.message = parts.join(&#x27;&#x27;);
        }
      }
      throw e;
    }
  } else {
    if (&#x27;tag&#x27; in obj) {
      if (DEPRECATE_COMPUTED_CHAINS) {
        maybeDirty(obj[&#x27;[]&#x27;]);
        maybeDirty(obj[&#x27;@length&#x27;]);
      }
      // @ts-expect-error - we are using Ember&#x27;s Tag not Glimmer&#x27;s
      dirtyTag(obj.tag);
    } else {
      obj.ref = null;
    }
  }
}

function flushTransaction() {
  const transaction = TRANSACTION!;
  TRANSACTION = transaction.parent;
  transaction.cbs.forEach((cb) =&gt; {
    cb();
  });
  transaction.props.forEach((obj) =&gt; {
    // mark this mutation as part of a transaction
    obj.t = true;
    updateRef(obj);
  });
  transaction.sub.forEach((obj) =&gt; {
    if (&#x27;tag&#x27; in obj) {
      if (DEPRECATE_COMPUTED_CHAINS) {
        maybeConsume(obj[&#x27;[]&#x27;]);
        maybeConsume(obj[&#x27;@length&#x27;]);
      }
      consumeTag(obj.tag);
    } else {
      obj.ref;
    }
  });
}
async function untrack() {
  const transaction = TRANSACTION!;
  TRANSACTION = transaction.parent;

  // defer writes
  await Promise.resolve();
  transaction.cbs.forEach((cb) =&gt; {
    cb();
  });
  transaction.props.forEach((obj) =&gt; {
    // mark this mutation as part of a transaction
    obj.t = true;
    updateRef(obj);
  });
}

export function addToTransaction(obj: Tag | Signal): void {
  if (TRANSACTION) {
    TRANSACTION.props.add(obj);
  } else {
    updateRef(obj);
  }
}
export function addTransactionCB(method: OpaqueFn): void {
  if (TRANSACTION) {
    TRANSACTION.cbs.add(method);
  } else {
    method();
  }
}

/**
 * Run &#x60;method&#x60; without subscribing to any tracked properties
 * controlled by EmberData.
 *
 * This should rarely be used except by libraries that really
 * know what they are doing. It is most useful for wrapping
 * certain kinds of fetch/query logic from within a &#x60;Resource&#x60;
 * &#x60;hook&#x60; or other similar pattern.
 *
 * @function untracked
 * @public
 * @static
 * @for @ember-data/tracking
 * @param method
 * @return result of invoking method
 */
export function untracked&lt;T extends OpaqueFn&gt;(method: T): ReturnType&lt;T&gt; {
  createTransaction();
  const ret = method();
  void untrack();
  return ret as ReturnType&lt;T&gt;;
}

/**
 * Run the method, subscribing to any tracked properties
 * managed by EmberData that were accessed or written during
 * the method&#x27;s execution as per-normal but while allowing
 * interleaving of reads and writes.
 *
 * This is useful when for instance you want to perform
 * a mutation based on existing state that must be read first.
 *
 * @function transact
 * @public
 * @static
 * @for @ember-data/tracking
 * @param method
 * @return result of invoking method
 */
export function transact&lt;T extends OpaqueFn&gt;(method: T): ReturnType&lt;T&gt; {
  createTransaction();
  const ret = method();
  flushTransaction();
  return ret as ReturnType&lt;T&gt;;
}

/**
 * A helpful utility for creating a new function that
 * always runs in a transaction. E.G. this &quot;memoizes&quot;
 * calling &#x60;transact(fn)&#x60;, currying args as necessary.
 *
 * @method memoTransact
 * @public
 * @static
 * @for @ember-data/tracking
 * @param method
 * @return a function that will invoke method in a transaction with any provided args and return its result
 */
export function memoTransact&lt;T extends OpaqueFn&gt;(method: T): (...args: unknown[]) =&gt; ReturnType&lt;T&gt; {
  return function (...args: unknown[]) {
    createTransaction();
    const ret = method(...args);
    flushTransaction();
    return ret as ReturnType&lt;T&gt;;
  };
}

export const Signals = Symbol(&#x27;Signals&#x27;);

/**
 *  use to add a signal property to the prototype of something.
 *
 *  First arg is the thing to define on
 *  Second arg is the property name
 *  Third agg is the initial value of the property if any.
 *
 *  for instance
 *
 *  &#x60;&#x60;&#x60;ts
 *  class Model {}
 *  defineSignal(Model.prototype, &#x27;isLoading&#x27;, false);
 *  &#x60;&#x60;&#x60;
 *
 *  This is sort of like using a stage-3 decorator but works today
 *  while we are still on legacy decorators.
 *
 *  e.g. it is equivalent to
 *
 *  &#x60;&#x60;&#x60;ts
 *  class Model {
 *    @signal accessor isLoading = false;
 *  }
 *  &#x60;&#x60;&#x60;
 *
 *  @internal
 */
export function defineSignal&lt;T extends object&gt;(obj: T, key: string, v?: unknown) {
  Object.defineProperty(obj, key, {
    enumerable: true,
    configurable: false,
    get(this: T &amp; { [Signals]: Map&lt;string, Signal&gt; }) {
      const signals = (this[Signals] = this[Signals] || new Map());
      const existing = signals.has(key);
      const _signal = entangleSignal(signals, this, key);
      if (!existing &amp;&amp; v !== undefined) {
        _signal.lastValue = v;
      }
      return _signal.lastValue;
    },
    set(this: T &amp; { [Signals]: Map&lt;string, Signal&gt; }, value: unknown) {
      const signals = (this[Signals] = this[Signals] || new Map());
      let _signal = signals.get(key);
      if (!_signal) {
        _signal = createSignal(this, key);
        signals.set(key, _signal);
      }
      if (_signal.lastValue !== value) {
        _signal.lastValue = value;
        addToTransaction(_signal);
      }
    },
  });
}

export interface Signal {
  /**
   * Key on the associated object
   * @internal
   */
  key: string;
  _debug_base?: string;

  /**
   * Whether this signal is part of an active transaction.
   * @internal
   */
  t: boolean;

  /**
   * Whether to &quot;bust&quot; the lastValue cache
   * @internal
   */
  shouldReset: boolean;

  /**
   * The framework specific &quot;signal&quot; e.g. glimmer &quot;tracked&quot;
   * or starbeam &quot;cell&quot; to consume/invalidate when appropriate.
   *
   * @internal
   */
  tag: ReturnType&lt;typeof tagForProperty&gt;;

  /**
   * In classic ember, arrays must entangle a &#x60;[]&#x60; symbol
   * in addition to any other tag in order for array chains to work.
   *
   * Note, this symbol MUST be the one that ember itself generates
   *
   * @internal
   */
  &#x27;[]&#x27;: ReturnType&lt;typeof tagForProperty&gt; | null;
  /**
   * In classic ember, arrays must entangle a &#x60;@length&#x60; symbol
   * in addition to any other tag in order for array chains to work.
   *
   * Note, this symbol MUST be the one that ember itself generates
   *
   * @internal
   */
  &#x27;@length&#x27;: ReturnType&lt;typeof tagForProperty&gt; | null;

  /**
   * The lastValue computed for this signal when
   * a signal is also used for storage.
   * @internal
   */
  lastValue: unknown;
}

export function createArrayTags&lt;T extends object&gt;(obj: T, signal: Signal) {
  if (DEPRECATE_COMPUTED_CHAINS) {
    signal[&#x27;[]&#x27;] = tagForProperty(obj, &#x27;[]&#x27;);
    signal[&#x27;@length&#x27;] = tagForProperty(obj, &#x27;length&#x27;);
  }
}

/**
 * Create a signal for the key/object pairing.
 *
 * @internal
 * @param obj Object we&#x27;re creating the signal on
 * @param key Key to create the signal for
 * @return the signal
 */
export function createSignal&lt;T extends object&gt;(obj: T, key: string): Signal {
  const _signal: Signal = {
    key,
    tag: tagForProperty(obj, key),

    t: false,
    shouldReset: false,
    &#x27;[]&#x27;: null,
    &#x27;@length&#x27;: null,
    lastValue: undefined,
  };

  if (DEBUG) {
    // eslint-disable-next-line no-inner-declarations
    function tryGet&lt;T1 = string&gt;(prop: string): T1 | undefined {
      try {
        return obj[prop as keyof typeof obj] as unknown as T1;
      } catch {
        return;
      }
    }
    const modelName =
      tryGet(&#x27;$type&#x27;) ?? tryGet(&#x27;modelName&#x27;) ?? tryGet&lt;{ modelName?: string }&gt;(&#x27;constructor&#x27;)?.modelName ?? &#x27;&#x27;;
    // eslint-disable-next-line @typescript-eslint/no-base-to-string
    const className = obj.constructor?.name ?? obj.toString?.() ?? &#x27;unknown&#x27;;
    _signal._debug_base = &#x60;${className}${modelName &amp;&amp; !className.startsWith(&#x27;SchemaRecord&#x27;) ? &#x60;:${modelName}&#x60; : &#x27;&#x27;}&#x60;;
  }

  return _signal;
}

/**
 * Create a signal for the key/object pairing and subscribes to the signal.
 *
 * Use when you need to ensure a signal exists and is subscribed to.
 *
 * @internal
 * @param signals Map of signals
 * @param obj Object we&#x27;re creating the signal on
 * @param key Key to create the signal for
 * @return the signal
 */
export function entangleSignal&lt;T extends object&gt;(signals: Map&lt;string, Signal&gt;, obj: T, key: string): Signal {
  let _signal = signals.get(key);
  if (!_signal) {
    _signal = createSignal(obj, key);
    signals.set(key, _signal);
  }
  subscribe(_signal);
  return _signal;
}

interface Signaler {
  [Signals]: Map&lt;string, Signal&gt;;
}

export function getSignal&lt;T extends object&gt;(obj: T, key: string, initialState: boolean): Signal {
  let signals = (obj as Signaler)[Signals];

  if (!signals) {
    signals = new Map();
    (obj as Signaler)[Signals] = signals;
  }

  let _signal = signals.get(key);
  if (!_signal) {
    _signal = createSignal(obj, key);
    _signal.shouldReset = initialState;
    signals.set(key, _signal);
  }
  return _signal;
}

export function peekSignal&lt;T extends object&gt;(obj: T, key: string): Signal | undefined {
  const signals = (obj as Signaler)[Signals];
  if (signals) {
    return signals.get(key);
  }
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
