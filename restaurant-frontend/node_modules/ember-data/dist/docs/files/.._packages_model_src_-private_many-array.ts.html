<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../packages/model/src/-private/many-array.ts - EmberData Documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="EmberData Documentation" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 5.3.3+58cd284b</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/&lt;Interface&gt; Adapter.html">&lt;Interface&gt; Adapter</a></li>
                                <li><a href="../classes/&lt;Interface&gt; Cache.html">&lt;Interface&gt; Cache</a></li>
                                <li><a href="../classes/&lt;Interface&gt; Handler.html">&lt;Interface&gt; Handler</a></li>
                                <li><a href="../classes/&lt;Interface&gt; LifetimesService.html">&lt;Interface&gt; LifetimesService</a></li>
                                <li><a href="../classes/&lt;Interface&gt; Serializer.html">&lt;Interface&gt; Serializer</a></li>
                                <li><a href="../classes/@ember-data/active-record/request.html">@ember-data/active-record/request</a></li>
                                <li><a href="../classes/@ember-data/adapter/rest.html">@ember-data/adapter/rest</a></li>
                                <li><a href="../classes/@ember-data/json-api/request.html">@ember-data/json-api/request</a></li>
                                <li><a href="../classes/@ember-data/model.html">@ember-data/model</a></li>
                                <li><a href="../classes/@ember-data/request-utils.html">@ember-data/request-utils</a></li>
                                <li><a href="../classes/@ember-data/rest/request.html">@ember-data/rest/request</a></li>
                                <li><a href="../classes/@ember-data/store.html">@ember-data/store</a></li>
                                <li><a href="../classes/@ember-data/tracking.html">@ember-data/tracking</a></li>
                                <li><a href="../classes/AbortError.html">AbortError</a></li>
                                <li><a href="../classes/Adapter.html">Adapter</a></li>
                                <li><a href="../classes/AdapterError.html">AdapterError</a></li>
                                <li><a href="../classes/BelongsToReference.html">BelongsToReference</a></li>
                                <li><a href="../classes/BooleanTransform.html">BooleanTransform</a></li>
                                <li><a href="../classes/BuildURLMixin.html">BuildURLMixin</a></li>
                                <li><a href="../classes/Cache.html">Cache</a></li>
                                <li><a href="../classes/CacheCapabilitiesManager.html">CacheCapabilitiesManager</a></li>
                                <li><a href="../classes/CacheManager.html">CacheManager</a></li>
                                <li><a href="../classes/CanaryFeatureFlags.html">CanaryFeatureFlags</a></li>
                                <li><a href="../classes/ConflictError.html">ConflictError</a></li>
                                <li><a href="../classes/CurrentDeprecations.html">CurrentDeprecations</a></li>
                                <li><a href="../classes/DateTransform.html">DateTransform</a></li>
                                <li><a href="../classes/DebugLogging.html">DebugLogging</a></li>
                                <li><a href="../classes/Document.html">Document</a></li>
                                <li><a href="../classes/EmbeddedRecordsMixin.html">EmbeddedRecordsMixin</a></li>
                                <li><a href="../classes/Errors.html">Errors</a></li>
                                <li><a href="../classes/Fetch.html">Fetch</a></li>
                                <li><a href="../classes/ForbiddenError.html">ForbiddenError</a></li>
                                <li><a href="../classes/Future.html">Future</a></li>
                                <li><a href="../classes/HasManyReference.html">HasManyReference</a></li>
                                <li><a href="../classes/IdentifierCache.html">IdentifierCache</a></li>
                                <li><a href="../classes/InspectorDataAdapter.html">InspectorDataAdapter</a></li>
                                <li><a href="../classes/InvalidError.html">InvalidError</a></li>
                                <li><a href="../classes/JSONAPIAdapter.html">JSONAPIAdapter</a></li>
                                <li><a href="../classes/JSONAPISerializer.html">JSONAPISerializer</a></li>
                                <li><a href="../classes/JSONSerializer.html">JSONSerializer</a></li>
                                <li><a href="../classes/LifetimesService.html">LifetimesService</a></li>
                                <li><a href="../classes/ManyArray.html">ManyArray</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/NotFoundError.html">NotFoundError</a></li>
                                <li><a href="../classes/NotificationManager.html">NotificationManager</a></li>
                                <li><a href="../classes/NumberTransform.html">NumberTransform</a></li>
                                <li><a href="../classes/PromiseBelongsTo.html">PromiseBelongsTo</a></li>
                                <li><a href="../classes/PromiseManyArray.html">PromiseManyArray</a></li>
                                <li><a href="../classes/RecordArray.html">RecordArray</a></li>
                                <li><a href="../classes/RecordReference.html">RecordReference</a></li>
                                <li><a href="../classes/RequestManager.html">RequestManager</a></li>
                                <li><a href="../classes/RequestStateService.html">RequestStateService</a></li>
                                <li><a href="../classes/RESTAdapter.html">RESTAdapter</a></li>
                                <li><a href="../classes/RESTSerializer.html">RESTSerializer</a></li>
                                <li><a href="../classes/SchemaService.html">SchemaService</a></li>
                                <li><a href="../classes/Serializer.html">Serializer</a></li>
                                <li><a href="../classes/ServerError.html">ServerError</a></li>
                                <li><a href="../classes/Snapshot.html">Snapshot</a></li>
                                <li><a href="../classes/SnapshotRecordArray.html">SnapshotRecordArray</a></li>
                                <li><a href="../classes/StableRecordIdentifier.html">StableRecordIdentifier</a></li>
                                <li><a href="../classes/Store.html">Store</a></li>
                                <li><a href="../classes/StringTransform.html">StringTransform</a></li>
                                <li><a href="../classes/TimeoutError.html">TimeoutError</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/UnauthorizedError.html">UnauthorizedError</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/@ember-data_active-record_request.html">@ember-data/active-record/request</a></li>
                                <li><a href="../modules/@ember-data_adapter.html">@ember-data/adapter</a></li>
                                <li><a href="../modules/@ember-data_adapter_error.html">@ember-data/adapter/error</a></li>
                                <li><a href="../modules/@ember-data_adapter_json-api.html">@ember-data/adapter/json-api</a></li>
                                <li><a href="../modules/@ember-data_adapter_rest.html">@ember-data/adapter/rest</a></li>
                                <li><a href="../modules/@ember-data_canary-features.html">@ember-data/canary-features</a></li>
                                <li><a href="../modules/@ember-data_debug.html">@ember-data/debug</a></li>
                                <li><a href="../modules/@ember-data_deprecations.html">@ember-data/deprecations</a></li>
                                <li><a href="../modules/@ember-data_experimental-preview-types.html">@ember-data/experimental-preview-types</a></li>
                                <li><a href="../modules/@ember-data_graph.html">@ember-data/graph</a></li>
                                <li><a href="../modules/@ember-data_json-api.html">@ember-data/json-api</a></li>
                                <li><a href="../modules/@ember-data_json-api_request.html">@ember-data/json-api/request</a></li>
                                <li><a href="../modules/@ember-data_legacy-compat.html">@ember-data/legacy-compat</a></li>
                                <li><a href="../modules/@ember-data_model.html">@ember-data/model</a></li>
                                <li><a href="../modules/@ember-data_request.html">@ember-data/request</a></li>
                                <li><a href="../modules/@ember-data_request-utils.html">@ember-data/request-utils</a></li>
                                <li><a href="../modules/@ember-data_request_fetch.html">@ember-data/request/fetch</a></li>
                                <li><a href="../modules/@ember-data_rest_request.html">@ember-data/rest/request</a></li>
                                <li><a href="../modules/@ember-data_serializer.html">@ember-data/serializer</a></li>
                                <li><a href="../modules/@ember-data_serializer_json.html">@ember-data/serializer/json</a></li>
                                <li><a href="../modules/@ember-data_serializer_json-api.html">@ember-data/serializer/json-api</a></li>
                                <li><a href="../modules/@ember-data_serializer_rest.html">@ember-data/serializer/rest</a></li>
                                <li><a href="../modules/@ember-data_store.html">@ember-data/store</a></li>
                                <li><a href="../modules/@ember-data_tracking.html">@ember-data/tracking</a></li>
                                <li><a href="../modules/ember-data-overview.html">ember-data-overview</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../packages/model/src/-private/many-array.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  @module @ember-data/store
*/
import { assert, deprecate } from &#x27;@ember/debug&#x27;;

import { DEPRECATE_MANY_ARRAY_DUPLICATES } from &#x27;@ember-data/deprecations&#x27;;
import type Store from &#x27;@ember-data/store&#x27;;
import {
  ARRAY_SIGNAL,
  isStableIdentifier,
  MUTATE,
  notifyArray,
  RecordArray,
  recordIdentifierFor,
  SOURCE,
} from &#x27;@ember-data/store/-private&#x27;;
import type { IdentifierArrayCreateOptions } from &#x27;@ember-data/store/-private/record-arrays/identifier-array&#x27;;
import type { CreateRecordProperties } from &#x27;@ember-data/store/-private/store-service&#x27;;
import type { Cache } from &#x27;@ember-data/store/-types/q/cache&#x27;;
import type { ModelSchema } from &#x27;@ember-data/store/-types/q/ds-model&#x27;;
import type { RecordInstance } from &#x27;@ember-data/store/-types/q/record-instance&#x27;;
import type { FindOptions } from &#x27;@ember-data/store/-types/q/store&#x27;;
import type { Signal } from &#x27;@ember-data/tracking/-private&#x27;;
import { addToTransaction } from &#x27;@ember-data/tracking/-private&#x27;;
import type { StableRecordIdentifier } from &#x27;@warp-drive/core-types&#x27;;
import type { Links, PaginationLinks } from &#x27;@warp-drive/core-types/spec/raw&#x27;;

import type { LegacySupport } from &#x27;./legacy-relationships-support&#x27;;

export interface ManyArrayCreateArgs {
  identifiers: StableRecordIdentifier[];
  type: string;
  store: Store;
  allowMutation: boolean;
  manager: LegacySupport;

  identifier: StableRecordIdentifier;
  cache: Cache;
  meta: Record&lt;string, unknown&gt; | null;
  links: Links | PaginationLinks | null;
  key: string;
  isPolymorphic: boolean;
  isAsync: boolean;
  _inverseIsAsync: boolean;
  isLoaded: boolean;
}
/**
  A &#x60;ManyArray&#x60; is a &#x60;MutableArray&#x60; that represents the contents of a has-many
  relationship.

  The &#x60;ManyArray&#x60; is instantiated lazily the first time the relationship is
  requested.

  This class is not intended to be directly instantiated by consuming applications.

  ### Inverses

  Often, the relationships in Ember Data applications will have
  an inverse. For example, imagine the following models are
  defined:

  &#x60;&#x60;&#x60;app/models/post.js
  import Model, { hasMany } from &#x27;@ember-data/model&#x27;;

  export default class PostModel extends Model {
    @hasMany(&#x27;comment&#x27;) comments;
  }
  &#x60;&#x60;&#x60;

  &#x60;&#x60;&#x60;app/models/comment.js
  import Model, { belongsTo } from &#x27;@ember-data/model&#x27;;

  export default class CommentModel extends Model {
    @belongsTo(&#x27;post&#x27;) post;
  }
  &#x60;&#x60;&#x60;

  If you created a new instance of &#x60;Post&#x60; and added
  a &#x60;Comment&#x60; record to its &#x60;comments&#x60; has-many
  relationship, you would expect the comment&#x27;s &#x60;post&#x60;
  property to be set to the post that contained
  the has-many.

  We call the record to which a relationship belongs-to the
  relationship&#x27;s _owner_.

  @class ManyArray
  @public
*/
export default class RelatedCollection extends RecordArray {
  declare isAsync: boolean;
  /**
    The loading state of this array

    @property {Boolean} isLoaded
    @public
    */

  declare isLoaded: boolean;
  /**
    &#x60;true&#x60; if the relationship is polymorphic, &#x60;false&#x60; otherwise.

    @property {Boolean} isPolymorphic
    @private
    */
  declare isPolymorphic: boolean;
  declare _inverseIsAsync: boolean;
  /**
    Metadata associated with the request for async hasMany relationships.

    Example

    Given that the server returns the following JSON payload when fetching a
    hasMany relationship:

    &#x60;&#x60;&#x60;js
    {
      &quot;comments&quot;: [{
        &quot;id&quot;: 1,
        &quot;comment&quot;: &quot;This is the first comment&quot;,
      }, {
    // ...
      }],

      &quot;meta&quot;: {
        &quot;page&quot;: 1,
        &quot;total&quot;: 5
      }
    }
    &#x60;&#x60;&#x60;

    You can then access the meta data via the &#x60;meta&#x60; property:

    &#x60;&#x60;&#x60;js
    let comments = await post.comments;
    let meta = comments.meta;

    // meta.page =&gt; 1
    // meta.total =&gt; 5
    &#x60;&#x60;&#x60;

    @property {Object | null} meta
    @public
    */
  declare meta: Record&lt;string, unknown&gt; | null;
  /**
     * Retrieve the links for this relationship
     *
     @property {Object | null} links
     @public
     */
  declare links: Links | PaginationLinks | null;
  declare identifier: StableRecordIdentifier;
  declare cache: Cache;
  // @ts-expect-error
  declare _manager: LegacySupport;
  declare store: Store;
  declare key: string;
  declare type: ModelSchema;

  constructor(options: ManyArrayCreateArgs) {
    super(options as unknown as IdentifierArrayCreateOptions);
    this.isLoaded = options.isLoaded || false;
    this.isAsync = options.isAsync || false;
    this.isPolymorphic = options.isPolymorphic || false;
    this.identifier = options.identifier;
    this.key = options.key;
  }

  [MUTATE](
    target: StableRecordIdentifier[],
    receiver: typeof Proxy&lt;StableRecordIdentifier[]&gt;,
    prop: string,
    args: unknown[],
    _SIGNAL: Signal
  ): unknown {
    switch (prop) {
      case &#x27;length 0&#x27;: {
        Reflect.set(target, &#x27;length&#x27;, 0);
        mutateReplaceRelatedRecords(this, [], _SIGNAL);
        return true;
      }
      case &#x27;replace cell&#x27;: {
        const [index, prior, value] = args as [number, StableRecordIdentifier, StableRecordIdentifier];
        target[index] = value;
        mutateReplaceRelatedRecord(this, { value, prior, index }, _SIGNAL);
        return true;
      }
      case &#x27;push&#x27;: {
        const newValues = extractIdentifiersFromRecords(args);

        assertNoDuplicates(
          this,
          target,
          (currentState) =&gt; currentState.push(...newValues),
          &#x60;Cannot push duplicates to a hasMany&#x27;s state.&#x60;
        );

        if (DEPRECATE_MANY_ARRAY_DUPLICATES) {
          // dedupe
          const seen = new Set(target);
          const unique = new Set&lt;RecordInstance&gt;();

          args.forEach((item) =&gt; {
            const identifier = recordIdentifierFor(item);
            if (!seen.has(identifier)) {
              seen.add(identifier);
              unique.add(item);
            }
          });

          const newArgs = Array.from(unique);
          const result = Reflect.apply(target[prop], receiver, newArgs) as RecordInstance[];

          if (newArgs.length) {
            mutateAddToRelatedRecords(this, { value: extractIdentifiersFromRecords(newArgs) }, _SIGNAL);
          }
          return result;
        }

        // else, no dedupe, error on duplicates
        const result = Reflect.apply(target[prop], receiver, args) as RecordInstance[];
        if (newValues.length) {
          mutateAddToRelatedRecords(this, { value: newValues }, _SIGNAL);
        }
        return result;
      }

      case &#x27;pop&#x27;: {
        const result: unknown = Reflect.apply(target[prop], receiver, args);
        if (result) {
          mutateRemoveFromRelatedRecords(this, { value: recordIdentifierFor(result as RecordInstance) }, _SIGNAL);
        }
        return result;
      }

      case &#x27;unshift&#x27;: {
        const newValues = extractIdentifiersFromRecords(args);

        assertNoDuplicates(
          this,
          target,
          (currentState) =&gt; currentState.unshift(...newValues),
          &#x60;Cannot unshift duplicates to a hasMany&#x27;s state.&#x60;
        );

        if (DEPRECATE_MANY_ARRAY_DUPLICATES) {
          // dedupe
          const seen = new Set(target);
          const unique = new Set&lt;RecordInstance&gt;();

          args.forEach((item) =&gt; {
            const identifier = recordIdentifierFor(item);
            if (!seen.has(identifier)) {
              seen.add(identifier);
              unique.add(item);
            }
          });

          const newArgs = Array.from(unique);
          const result: unknown = Reflect.apply(target[prop], receiver, newArgs);

          if (newArgs.length) {
            mutateAddToRelatedRecords(this, { value: extractIdentifiersFromRecords(newArgs), index: 0 }, _SIGNAL);
          }
          return result;
        }

        // else, no dedupe, error on duplicates
        const result = Reflect.apply(target[prop], receiver, args) as RecordInstance[];
        if (newValues.length) {
          mutateAddToRelatedRecords(this, { value: newValues, index: 0 }, _SIGNAL);
        }
        return result;
      }

      case &#x27;shift&#x27;: {
        const result: unknown = Reflect.apply(target[prop], receiver, args);

        if (result) {
          mutateRemoveFromRelatedRecords(
            this,
            { value: recordIdentifierFor(result as RecordInstance), index: 0 },
            _SIGNAL
          );
        }
        return result;
      }

      case &#x27;sort&#x27;: {
        const result: unknown = Reflect.apply(target[prop], receiver, args);
        mutateSortRelatedRecords(this, (result as RecordInstance[]).map(recordIdentifierFor), _SIGNAL);
        return result;
      }

      case &#x27;splice&#x27;: {
        const [start, deleteCount, ...adds] = args as [number, number, ...RecordInstance[]];

        // detect a full replace
        if (start === 0 &amp;&amp; deleteCount === this[SOURCE].length) {
          const newValues = extractIdentifiersFromRecords(adds);

          assertNoDuplicates(
            this,
            target,
            (currentState) =&gt; currentState.splice(start, deleteCount, ...newValues),
            &#x60;Cannot replace a hasMany&#x27;s state with a new state that contains duplicates.&#x60;
          );

          if (DEPRECATE_MANY_ARRAY_DUPLICATES) {
            // dedupe
            const current = new Set(adds);
            const unique = Array.from(current);
            const newArgs = ([start, deleteCount] as unknown[]).concat(unique);

            const result = Reflect.apply(target[prop], receiver, newArgs) as RecordInstance[];

            mutateReplaceRelatedRecords(this, extractIdentifiersFromRecords(unique), _SIGNAL);
            return result;
          }

          // else, no dedupe, error on duplicates
          const result = Reflect.apply(target[prop], receiver, args) as RecordInstance[];
          mutateReplaceRelatedRecords(this, newValues, _SIGNAL);
          return result;
        }

        const newValues = extractIdentifiersFromRecords(adds);
        assertNoDuplicates(
          this,
          target,
          (currentState) =&gt; currentState.splice(start, deleteCount, ...newValues),
          &#x60;Cannot splice a hasMany&#x27;s state with a new state that contains duplicates.&#x60;
        );

        if (DEPRECATE_MANY_ARRAY_DUPLICATES) {
          // dedupe
          const currentState = target.slice();
          currentState.splice(start, deleteCount);

          const seen = new Set(currentState);
          const unique: RecordInstance[] = [];
          adds.forEach((item) =&gt; {
            const identifier = recordIdentifierFor(item);
            if (!seen.has(identifier)) {
              seen.add(identifier);
              unique.push(item);
            }
          });

          const newArgs = [start, deleteCount, ...unique];
          const result = Reflect.apply(target[prop], receiver, newArgs) as RecordInstance[];

          if (deleteCount &gt; 0) {
            mutateRemoveFromRelatedRecords(this, { value: result.map(recordIdentifierFor), index: start }, _SIGNAL);
          }

          if (unique.length &gt; 0) {
            mutateAddToRelatedRecords(this, { value: extractIdentifiersFromRecords(unique), index: start }, _SIGNAL);
          }

          return result;
        }

        // else, no dedupe, error on duplicates
        const result = Reflect.apply(target[prop], receiver, args) as RecordInstance[];
        if (deleteCount &gt; 0) {
          mutateRemoveFromRelatedRecords(this, { value: result.map(recordIdentifierFor), index: start }, _SIGNAL);
        }
        if (newValues.length &gt; 0) {
          mutateAddToRelatedRecords(this, { value: newValues, index: start }, _SIGNAL);
        }
        return result;
      }
      default:
        assert(&#x60;unable to convert ${prop} into a transaction that updates the cache state for this record array&#x60;);
    }
  }

  notify() {
    const signal = this[ARRAY_SIGNAL];
    signal.shouldReset = true;
    // @ts-expect-error
    notifyArray(this);
  }

  /**
    Reloads all of the records in the manyArray. If the manyArray
    holds a relationship that was originally fetched using a links url
    Ember Data will revisit the original links url to repopulate the
    relationship.

    If the manyArray holds the result of a &#x60;store.query()&#x60; reload will
    re-run the original query.

    Example

    &#x60;&#x60;&#x60;javascript
    let user = store.peekRecord(&#x27;user&#x27;, &#x27;1&#x27;)
    await login(user);

    let permissions = await user.permissions;
    await permissions.reload();
    &#x60;&#x60;&#x60;

    @method reload
    @public
  */
  reload(options?: FindOptions) {
    // TODO this is odd, we don&#x27;t ask the store for anything else like this?
    return this._manager.reloadHasMany(this.key, options);
  }

  /**
    Saves all of the records in the &#x60;ManyArray&#x60;.

    Example

    &#x60;&#x60;&#x60;javascript
    let inbox = await store.findRecord(&#x27;inbox&#x27;, &#x27;1&#x27;);
    let messages = await inbox.messages;
    messages.forEach((message) =&gt; {
      message.isRead = true;
    });
    messages.save();
    &#x60;&#x60;&#x60;

    @method save
    @public
    @return {PromiseArray} promise
  */

  /**
    Create a child record within the owner

    @method createRecord
    @public
    @param {Object} hash
    @return {Model} record
  */
  createRecord(hash: CreateRecordProperties): RecordInstance {
    const { store } = this;
    assert(&#x60;Expected modelName to be set&#x60;, this.modelName);
    const record = store.createRecord(this.modelName, hash);
    this.push(record);

    return record;
  }

  override destroy() {
    super.destroy(false);
  }
}
RelatedCollection.prototype.isAsync = false;
RelatedCollection.prototype.isPolymorphic = false;
RelatedCollection.prototype.identifier = null as unknown as StableRecordIdentifier;
RelatedCollection.prototype.cache = null as unknown as Cache;
RelatedCollection.prototype._inverseIsAsync = false;
RelatedCollection.prototype.key = &#x27;&#x27;;
RelatedCollection.prototype.DEPRECATED_CLASS_NAME = &#x27;ManyArray&#x27;;

type PromiseProxyRecord = { then(): void; content: RecordInstance | null | undefined };

function assertRecordPassedToHasMany(record: RecordInstance | PromiseProxyRecord) {
  assert(
    &#x60;All elements of a hasMany relationship must be instances of Model, you passed $${typeof record}&#x60;,
    (function () {
      try {
        recordIdentifierFor(record);
        return true;
      } catch {
        return false;
      }
    })()
  );
}

function extractIdentifiersFromRecords(records: RecordInstance[]): StableRecordIdentifier[] {
  return records.map(extractIdentifierFromRecord);
}

function extractIdentifierFromRecord(recordOrPromiseRecord: PromiseProxyRecord | RecordInstance) {
  assertRecordPassedToHasMany(recordOrPromiseRecord);
  return recordIdentifierFor(recordOrPromiseRecord);
}

function assertNoDuplicates(
  collection: RelatedCollection,
  target: StableRecordIdentifier[],
  callback: (currentState: StableRecordIdentifier[]) =&gt; void,
  reason: string
) {
  const state = target.slice();
  callback(state);

  if (state.length !== new Set(state).size) {
    const duplicates = state.filter((currentValue, currentIndex) =&gt; state.indexOf(currentValue) !== currentIndex);

    if (DEPRECATE_MANY_ARRAY_DUPLICATES) {
      deprecate(
        &#x60;${reason} This behavior is deprecated. Found duplicates for the following records within the new state provided to \&#x60;&lt;${
          collection.identifier.type
        }:${collection.identifier.id || collection.identifier.lid}&gt;.${collection.key}\&#x60;\n\t- ${Array.from(
          new Set(duplicates)
        )
          .map((r) =&gt; (isStableIdentifier(r) ? r.lid : recordIdentifierFor(r).lid))
          .sort((a, b) =&gt; a.localeCompare(b))
          .join(&#x27;\n\t- &#x27;)}&#x60;,
        false,
        {
          id: &#x27;ember-data:deprecate-many-array-duplicates&#x27;,
          for: &#x27;ember-data&#x27;,
          until: &#x27;6.0&#x27;,
          since: {
            enabled: &#x27;5.3&#x27;,
            available: &#x27;5.3&#x27;,
          },
        }
      );
    } else {
      throw new Error(
        &#x60;${reason} Found duplicates for the following records within the new state provided to \&#x60;&lt;${
          collection.identifier.type
        }:${collection.identifier.id || collection.identifier.lid}&gt;.${collection.key}\&#x60;\n\t- ${Array.from(
          new Set(duplicates)
        )
          .map((r) =&gt; (isStableIdentifier(r) ? r.lid : recordIdentifierFor(r).lid))
          .sort((a, b) =&gt; a.localeCompare(b))
          .join(&#x27;\n\t- &#x27;)}&#x60;
      );
    }
  }
}

function mutateAddToRelatedRecords(
  collection: RelatedCollection,
  operationInfo: { value: StableRecordIdentifier | StableRecordIdentifier[]; index?: number },
  _SIGNAL: Signal
) {
  mutate(
    collection,
    {
      op: &#x27;addToRelatedRecords&#x27;,
      record: collection.identifier,
      field: collection.key,
      ...operationInfo,
    },
    _SIGNAL
  );
}

function mutateRemoveFromRelatedRecords(
  collection: RelatedCollection,
  operationInfo: { value: StableRecordIdentifier | StableRecordIdentifier[]; index?: number },
  _SIGNAL: Signal
) {
  mutate(
    collection,
    {
      op: &#x27;removeFromRelatedRecords&#x27;,
      record: collection.identifier,
      field: collection.key,
      ...operationInfo,
    },
    _SIGNAL
  );
}

function mutateReplaceRelatedRecord(
  collection: RelatedCollection,
  operationInfo: {
    value: StableRecordIdentifier;
    prior: StableRecordIdentifier;
    index: number;
  },
  _SIGNAL: Signal
) {
  mutate(
    collection,
    {
      op: &#x27;replaceRelatedRecord&#x27;,
      record: collection.identifier,
      field: collection.key,
      ...operationInfo,
    },
    _SIGNAL
  );
}

function mutateReplaceRelatedRecords(collection: RelatedCollection, value: StableRecordIdentifier[], _SIGNAL: Signal) {
  mutate(
    collection,
    {
      op: &#x27;replaceRelatedRecords&#x27;,
      record: collection.identifier,
      field: collection.key,
      value,
    },
    _SIGNAL
  );
}

function mutateSortRelatedRecords(collection: RelatedCollection, value: StableRecordIdentifier[], _SIGNAL: Signal) {
  mutate(
    collection,
    {
      op: &#x27;sortRelatedRecords&#x27;,
      record: collection.identifier,
      field: collection.key,
      value,
    },
    _SIGNAL
  );
}

function mutate(collection: RelatedCollection, mutation: Parameters&lt;LegacySupport[&#x27;mutate&#x27;]&gt;[0], _SIGNAL: Signal) {
  collection._manager.mutate(mutation);
  addToTransaction(_SIGNAL);
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
