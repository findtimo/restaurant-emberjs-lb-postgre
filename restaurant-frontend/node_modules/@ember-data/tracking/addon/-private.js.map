{"version":3,"file":"-private.js","sources":["../src/-private.ts"],"sourcesContent":["import { tagForProperty } from '@ember/-internals/metal';\nimport { consumeTag, dirtyTag } from '@glimmer/validator';\n\nimport { DEPRECATE_COMPUTED_CHAINS } from '@ember-data/deprecations';\nimport { DEBUG } from '@ember-data/env';\n\n/**\n * This package provides primitives that allow powerful low-level\n * adjustments to change tracking notification behaviors.\n *\n * Typically you want to use these primitives when you want to divorce\n * property accesses on EmberData provided objects from the current\n * tracking context. Typically this sort of thing occurs when serializing\n * tracked data to send in a request: the data itself is often ancillary\n * to the thing which triggered the request in the first place and you\n * would not want to re-trigger the request for any update to the data.\n *\n * @module @ember-data/tracking\n * @main @ember-data/tracking\n */\ntype OpaqueFn = (...args: unknown[]) => unknown;\ntype Tag = { ref: null; t: boolean };\ntype Transaction = {\n  cbs: Set<OpaqueFn>;\n  props: Set<Tag | Signal>;\n  sub: Set<Tag | Signal>;\n  parent: Transaction | null;\n};\nlet TRANSACTION: Transaction | null = null;\n\nfunction createTransaction() {\n  const transaction: Transaction = {\n    cbs: new Set(),\n    props: new Set(),\n    sub: new Set(),\n    parent: null,\n  };\n  if (TRANSACTION) {\n    transaction.parent = TRANSACTION;\n  }\n  TRANSACTION = transaction;\n}\n\nfunction maybeConsume(tag: ReturnType<typeof tagForProperty> | null): void {\n  if (tag) {\n    consumeTag(tag);\n  }\n}\n\nfunction maybeDirty(tag: ReturnType<typeof tagForProperty> | null): void {\n  if (tag) {\n    // @ts-expect-error - we are using Ember's Tag not Glimmer's\n    dirtyTag(tag);\n  }\n}\n\n/**\n * If there is a current transaction, ensures that the relevant tag (and any\n * array computed chains symbols, if applicable) will be consumed during the\n * transaction.\n *\n * If there is no current transaction, will consume the tag(s) immediately.\n *\n * @internal\n * @param obj\n */\nexport function subscribe(obj: Tag | Signal): void {\n  if (TRANSACTION) {\n    TRANSACTION.sub.add(obj);\n  } else if ('tag' in obj) {\n    if (DEPRECATE_COMPUTED_CHAINS) {\n      maybeConsume(obj['[]']);\n      maybeConsume(obj['@length']);\n    }\n    consumeTag(obj.tag);\n  } else {\n    obj.ref;\n  }\n}\n\nfunction updateRef(obj: Tag | Signal): void {\n  if (DEBUG) {\n    try {\n      if ('tag' in obj) {\n        if (DEPRECATE_COMPUTED_CHAINS) {\n          maybeDirty(obj['[]']);\n          maybeDirty(obj['@length']);\n        }\n        // @ts-expect-error - we are using Ember's Tag not Glimmer's\n        dirtyTag(obj.tag);\n      } else {\n        obj.ref = null;\n      }\n    } catch (e: unknown) {\n      if (e instanceof Error) {\n        if (e.message.includes('You attempted to update `undefined`')) {\n          // @ts-expect-error\n          const key = `<${obj._debug_base}>.${obj.key}`;\n          e.message = e.message.replace('You attempted to update `undefined`', `You attempted to update ${key}`);\n          e.stack = e.stack?.replace('You attempted to update `undefined`', `You attempted to update ${key}`);\n\n          const lines = e.stack?.split(`\\n`);\n          const finalLines: string[] = [];\n          let lastFile: string | null = null;\n\n          lines?.forEach((line) => {\n            if (line.trim().startsWith('at ')) {\n              // get the last string in the line which contains the code source location\n              const location = line.split(' ').at(-1)!;\n              // remove the line and char offset info\n\n              if (location.includes(':')) {\n                const parts = location.split(':');\n                parts.pop();\n                parts.pop();\n                const file = parts.join(':');\n                if (file !== lastFile) {\n                  lastFile = file;\n                  finalLines.push('');\n                }\n              }\n              finalLines.push(line);\n            }\n          });\n\n          const splitstr = '`undefined` was first used:';\n          const parts = e.message.split(splitstr);\n          parts.splice(1, 0, `Original Stack\\n=============\\n${finalLines.join(`\\n`)}\\n\\n\\`${key}\\` was first used:`);\n\n          e.message = parts.join('');\n        }\n      }\n      throw e;\n    }\n  } else {\n    if ('tag' in obj) {\n      if (DEPRECATE_COMPUTED_CHAINS) {\n        maybeDirty(obj['[]']);\n        maybeDirty(obj['@length']);\n      }\n      // @ts-expect-error - we are using Ember's Tag not Glimmer's\n      dirtyTag(obj.tag);\n    } else {\n      obj.ref = null;\n    }\n  }\n}\n\nfunction flushTransaction() {\n  const transaction = TRANSACTION!;\n  TRANSACTION = transaction.parent;\n  transaction.cbs.forEach((cb) => {\n    cb();\n  });\n  transaction.props.forEach((obj) => {\n    // mark this mutation as part of a transaction\n    obj.t = true;\n    updateRef(obj);\n  });\n  transaction.sub.forEach((obj) => {\n    if ('tag' in obj) {\n      if (DEPRECATE_COMPUTED_CHAINS) {\n        maybeConsume(obj['[]']);\n        maybeConsume(obj['@length']);\n      }\n      consumeTag(obj.tag);\n    } else {\n      obj.ref;\n    }\n  });\n}\nasync function untrack() {\n  const transaction = TRANSACTION!;\n  TRANSACTION = transaction.parent;\n\n  // defer writes\n  await Promise.resolve();\n  transaction.cbs.forEach((cb) => {\n    cb();\n  });\n  transaction.props.forEach((obj) => {\n    // mark this mutation as part of a transaction\n    obj.t = true;\n    updateRef(obj);\n  });\n}\n\nexport function addToTransaction(obj: Tag | Signal): void {\n  if (TRANSACTION) {\n    TRANSACTION.props.add(obj);\n  } else {\n    updateRef(obj);\n  }\n}\nexport function addTransactionCB(method: OpaqueFn): void {\n  if (TRANSACTION) {\n    TRANSACTION.cbs.add(method);\n  } else {\n    method();\n  }\n}\n\n/**\n * Run `method` without subscribing to any tracked properties\n * controlled by EmberData.\n *\n * This should rarely be used except by libraries that really\n * know what they are doing. It is most useful for wrapping\n * certain kinds of fetch/query logic from within a `Resource`\n * `hook` or other similar pattern.\n *\n * @function untracked\n * @public\n * @static\n * @for @ember-data/tracking\n * @param method\n * @return result of invoking method\n */\nexport function untracked<T extends OpaqueFn>(method: T): ReturnType<T> {\n  createTransaction();\n  const ret = method();\n  void untrack();\n  return ret as ReturnType<T>;\n}\n\n/**\n * Run the method, subscribing to any tracked properties\n * managed by EmberData that were accessed or written during\n * the method's execution as per-normal but while allowing\n * interleaving of reads and writes.\n *\n * This is useful when for instance you want to perform\n * a mutation based on existing state that must be read first.\n *\n * @function transact\n * @public\n * @static\n * @for @ember-data/tracking\n * @param method\n * @return result of invoking method\n */\nexport function transact<T extends OpaqueFn>(method: T): ReturnType<T> {\n  createTransaction();\n  const ret = method();\n  flushTransaction();\n  return ret as ReturnType<T>;\n}\n\n/**\n * A helpful utility for creating a new function that\n * always runs in a transaction. E.G. this \"memoizes\"\n * calling `transact(fn)`, currying args as necessary.\n *\n * @method memoTransact\n * @public\n * @static\n * @for @ember-data/tracking\n * @param method\n * @return a function that will invoke method in a transaction with any provided args and return its result\n */\nexport function memoTransact<T extends OpaqueFn>(method: T): (...args: unknown[]) => ReturnType<T> {\n  return function (...args: unknown[]) {\n    createTransaction();\n    const ret = method(...args);\n    flushTransaction();\n    return ret as ReturnType<T>;\n  };\n}\n\nexport const Signals = Symbol('Signals');\n\n/**\n *  use to add a signal property to the prototype of something.\n *\n *  First arg is the thing to define on\n *  Second arg is the property name\n *  Third agg is the initial value of the property if any.\n *\n *  for instance\n *\n *  ```ts\n *  class Model {}\n *  defineSignal(Model.prototype, 'isLoading', false);\n *  ```\n *\n *  This is sort of like using a stage-3 decorator but works today\n *  while we are still on legacy decorators.\n *\n *  e.g. it is equivalent to\n *\n *  ```ts\n *  class Model {\n *    @signal accessor isLoading = false;\n *  }\n *  ```\n *\n *  @internal\n */\nexport function defineSignal<T extends object>(obj: T, key: string, v?: unknown) {\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: false,\n    get(this: T & { [Signals]: Map<string, Signal> }) {\n      const signals = (this[Signals] = this[Signals] || new Map());\n      const existing = signals.has(key);\n      const _signal = entangleSignal(signals, this, key);\n      if (!existing && v !== undefined) {\n        _signal.lastValue = v;\n      }\n      return _signal.lastValue;\n    },\n    set(this: T & { [Signals]: Map<string, Signal> }, value: unknown) {\n      const signals = (this[Signals] = this[Signals] || new Map());\n      let _signal = signals.get(key);\n      if (!_signal) {\n        _signal = createSignal(this, key);\n        signals.set(key, _signal);\n      }\n      if (_signal.lastValue !== value) {\n        _signal.lastValue = value;\n        addToTransaction(_signal);\n      }\n    },\n  });\n}\n\nexport interface Signal {\n  /**\n   * Key on the associated object\n   * @internal\n   */\n  key: string;\n  _debug_base?: string;\n\n  /**\n   * Whether this signal is part of an active transaction.\n   * @internal\n   */\n  t: boolean;\n\n  /**\n   * Whether to \"bust\" the lastValue cache\n   * @internal\n   */\n  shouldReset: boolean;\n\n  /**\n   * The framework specific \"signal\" e.g. glimmer \"tracked\"\n   * or starbeam \"cell\" to consume/invalidate when appropriate.\n   *\n   * @internal\n   */\n  tag: ReturnType<typeof tagForProperty>;\n\n  /**\n   * In classic ember, arrays must entangle a `[]` symbol\n   * in addition to any other tag in order for array chains to work.\n   *\n   * Note, this symbol MUST be the one that ember itself generates\n   *\n   * @internal\n   */\n  '[]': ReturnType<typeof tagForProperty> | null;\n  /**\n   * In classic ember, arrays must entangle a `@length` symbol\n   * in addition to any other tag in order for array chains to work.\n   *\n   * Note, this symbol MUST be the one that ember itself generates\n   *\n   * @internal\n   */\n  '@length': ReturnType<typeof tagForProperty> | null;\n\n  /**\n   * The lastValue computed for this signal when\n   * a signal is also used for storage.\n   * @internal\n   */\n  lastValue: unknown;\n}\n\nexport function createArrayTags<T extends object>(obj: T, signal: Signal) {\n  if (DEPRECATE_COMPUTED_CHAINS) {\n    signal['[]'] = tagForProperty(obj, '[]');\n    signal['@length'] = tagForProperty(obj, 'length');\n  }\n}\n\n/**\n * Create a signal for the key/object pairing.\n *\n * @internal\n * @param obj Object we're creating the signal on\n * @param key Key to create the signal for\n * @return the signal\n */\nexport function createSignal<T extends object>(obj: T, key: string): Signal {\n  const _signal: Signal = {\n    key,\n    tag: tagForProperty(obj, key),\n\n    t: false,\n    shouldReset: false,\n    '[]': null,\n    '@length': null,\n    lastValue: undefined,\n  };\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-inner-declarations\n    function tryGet<T1 = string>(prop: string): T1 | undefined {\n      try {\n        return obj[prop as keyof typeof obj] as unknown as T1;\n      } catch {\n        return;\n      }\n    }\n    const modelName =\n      tryGet('$type') ?? tryGet('modelName') ?? tryGet<{ modelName?: string }>('constructor')?.modelName ?? '';\n    // eslint-disable-next-line @typescript-eslint/no-base-to-string\n    const className = obj.constructor?.name ?? obj.toString?.() ?? 'unknown';\n    _signal._debug_base = `${className}${modelName && !className.startsWith('SchemaRecord') ? `:${modelName}` : ''}`;\n  }\n\n  return _signal;\n}\n\n/**\n * Create a signal for the key/object pairing and subscribes to the signal.\n *\n * Use when you need to ensure a signal exists and is subscribed to.\n *\n * @internal\n * @param signals Map of signals\n * @param obj Object we're creating the signal on\n * @param key Key to create the signal for\n * @return the signal\n */\nexport function entangleSignal<T extends object>(signals: Map<string, Signal>, obj: T, key: string): Signal {\n  let _signal = signals.get(key);\n  if (!_signal) {\n    _signal = createSignal(obj, key);\n    signals.set(key, _signal);\n  }\n  subscribe(_signal);\n  return _signal;\n}\n\ninterface Signaler {\n  [Signals]: Map<string, Signal>;\n}\n\nexport function getSignal<T extends object>(obj: T, key: string, initialState: boolean): Signal {\n  let signals = (obj as Signaler)[Signals];\n\n  if (!signals) {\n    signals = new Map();\n    (obj as Signaler)[Signals] = signals;\n  }\n\n  let _signal = signals.get(key);\n  if (!_signal) {\n    _signal = createSignal(obj, key);\n    _signal.shouldReset = initialState;\n    signals.set(key, _signal);\n  }\n  return _signal;\n}\n\nexport function peekSignal<T extends object>(obj: T, key: string): Signal | undefined {\n  const signals = (obj as Signaler)[Signals];\n  if (signals) {\n    return signals.get(key);\n  }\n}\n"],"names":["TRANSACTION","createTransaction","transaction","cbs","Set","props","sub","parent","maybeConsume","tag","consumeTag","maybeDirty","dirtyTag","subscribe","obj","add","macroCondition","getOwnConfig","deprecations","DEPRECATE_COMPUTED_CHAINS","ref","updateRef","env","DEBUG","e","Error","message","includes","key","_debug_base","replace","stack","lines","split","finalLines","lastFile","forEach","line","trim","startsWith","location","at","parts","pop","file","join","push","splitstr","splice","flushTransaction","cb","t","untrack","Promise","resolve","addToTransaction","addTransactionCB","method","untracked","ret","transact","memoTransact","args","Signals","Symbol","defineSignal","v","Object","defineProperty","enumerable","configurable","get","signals","Map","existing","has","_signal","entangleSignal","undefined","lastValue","set","value","createSignal","createArrayTags","signal","tagForProperty","shouldReset","tryGet","prop","modelName","className","constructor","name","toString","getSignal","initialState","peekSignal"],"mappings":"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"}