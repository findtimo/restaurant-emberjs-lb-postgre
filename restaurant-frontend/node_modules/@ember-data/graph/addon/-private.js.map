{"version":3,"file":"-private.js","sources":["../src/-private/coerce-id.ts","../src/-private/-utils.ts","../src/-private/debug/assert-polymorphic-type.ts","../src/-private/operations/replace-related-records.ts","../src/-private/operations/replace-related-record.ts","../src/-private/-diff.ts","../src/-private/-edge-definition.ts","../src/-private/-state.ts","../src/-private/edges/collection.ts","../src/-private/edges/implicit.ts","../src/-private/edges/resource.ts","../src/-private/operations/add-to-related-records.ts","../src/-private/operations/merge-identifier.ts","../src/-private/operations/remove-from-related-records.ts","../src/-private/normalize-link.ts","../src/-private/operations/update-relationship.ts","../src/-private/graph.ts","../src/-private/index.ts"],"sourcesContent":["import { assert, deprecate } from '@ember/debug';\n\nimport { DEPRECATE_NON_STRICT_ID } from '@ember-data/deprecations';\n\n// Used by the store to normalize IDs entering the store.  Despite the fact\n// that developers may provide IDs as numbers (e.g., `store.findRecord('person', 1)`),\n// it is important that internally we use strings, since IDs may be serialized\n// and lose type information.  For example, Ember's router may put a record's\n// ID into the URL, and if we later try to deserialize that URL and find the\n// corresponding record, we will not know if it is a string or a number.\ntype Coercable = string | number | boolean | null | undefined | symbol;\n\nexport function coerceId(id: Coercable): string | null {\n  if (DEPRECATE_NON_STRICT_ID) {\n    let normalized: string | null;\n    if (id === null || id === undefined || id === '') {\n      normalized = null;\n    } else {\n      normalized = String(id);\n    }\n\n    deprecate(\n      `The resource id '<${typeof id}> ${String(\n        id\n      )} ' is not normalized. Update your application code to use '${JSON.stringify(normalized)}' instead.`,\n      normalized === id,\n      {\n        id: 'ember-data:deprecate-non-strict-id',\n        until: '6.0',\n        for: 'ember-data',\n        since: {\n          available: '5.3',\n          enabled: '5.3',\n        },\n      }\n    );\n\n    return normalized;\n  }\n\n  assert(\n    `Resource IDs must be a non-empty string or null. Received '${String(id)}'.`,\n    id === null || (typeof id === 'string' && id.length > 0)\n  );\n\n  return id;\n}\n\nexport function ensureStringId(id: Coercable): string {\n  let normalized: string | null = null;\n  if (typeof id === 'string') {\n    normalized = id.length > 0 ? id : null;\n  } else if (typeof id === 'number' && !isNaN(id)) {\n    normalized = String(id);\n  }\n\n  assert(`Expected id to be a string or number, received ${String(id)}`, normalized !== null);\n\n  return normalized;\n}\n","import { assert, inspect, warn } from '@ember/debug';\n\nimport { LOG_GRAPH } from '@ember-data/debugging';\nimport type { Store } from '@ember-data/store/-private';\nimport { peekCache } from '@ember-data/store/-private';\nimport type { CacheCapabilitiesManager } from '@ember-data/store/-types/q/cache-store-wrapper';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { UpdateRelationshipOperation } from '@warp-drive/core-types/graph';\nimport type { ResourceIdentifierObject } from '@warp-drive/core-types/spec/raw';\n\nimport type { UpgradedMeta } from './-edge-definition';\nimport { coerceId } from './coerce-id';\nimport type { CollectionEdge } from './edges/collection';\nimport type { ImplicitEdge } from './edges/implicit';\nimport type { ResourceEdge } from './edges/resource';\nimport type { Graph, GraphEdge } from './graph';\n\nexport function getStore(wrapper: CacheCapabilitiesManager | { _store: Store }): Store {\n  assert(`expected a private _store property`, '_store' in wrapper);\n  return wrapper._store;\n}\n\nexport function expandingGet<T>(cache: Record<string, Record<string, T>>, key1: string, key2: string): T | undefined {\n  const mainCache = (cache[key1] = cache[key1] || Object.create(null));\n  return mainCache[key2];\n}\n\nexport function expandingSet<T>(cache: Record<string, Record<string, T>>, key1: string, key2: string, value: T): void {\n  const mainCache = (cache[key1] = cache[key1] || Object.create(null));\n  mainCache[key2] = value;\n}\n\nexport function assertValidRelationshipPayload(graph: Graph, op: UpdateRelationshipOperation) {\n  const relationship = graph.get(op.record, op.field);\n  assert(`Cannot update an implicit relationship`, isHasMany(relationship) || isBelongsTo(relationship));\n  const payload = op.value;\n  const { definition, identifier, state } = relationship;\n  const { type } = identifier;\n  const { field } = op;\n  const { isAsync, kind } = definition;\n\n  if (payload.links) {\n    warn(\n      `You pushed a record of type '${type}' with a relationship '${field}' configured as 'async: false'. You've included a link but no primary data, this may be an error in your payload. EmberData will treat this relationship as known-to-be-empty.`,\n      isAsync || !!payload.data || state.hasReceivedData,\n      {\n        id: 'ds.store.push-link-for-sync-relationship',\n      }\n    );\n  } else if (payload.data) {\n    if (kind === 'belongsTo') {\n      assert(\n        `A ${type} record was pushed into the store with the value of ${field} being ${inspect(\n          payload.data\n        )}, but ${field} is a belongsTo relationship so the value must not be an array. You should probably check your data payload or serializer.`,\n        !Array.isArray(payload.data)\n      );\n      assertRelationshipData(getStore(graph.store), identifier, payload.data, definition);\n    } else if (kind === 'hasMany') {\n      assert(\n        `A ${type} record was pushed into the store with the value of ${field} being '${inspect(\n          payload.data\n        )}', but ${field} is a hasMany relationship so the value must be an array. You should probably check your data payload or serializer.`,\n        Array.isArray(payload.data)\n      );\n      if (Array.isArray(payload.data)) {\n        for (let i = 0; i < payload.data.length; i++) {\n          assertRelationshipData(getStore(graph.store), identifier, payload.data[i], definition);\n        }\n      }\n    }\n  }\n}\n\nexport function isNew(identifier: StableRecordIdentifier): boolean {\n  if (!identifier.id) {\n    return true;\n  }\n  const cache = peekCache(identifier);\n  return Boolean(cache?.isNew(identifier));\n}\n\nexport function isBelongsTo(relationship: GraphEdge): relationship is ResourceEdge {\n  return relationship.definition.kind === 'belongsTo';\n}\n\nexport function isImplicit(relationship: GraphEdge): relationship is ImplicitEdge {\n  return relationship.definition.isImplicit;\n}\n\nexport function isHasMany(relationship: GraphEdge): relationship is CollectionEdge {\n  return relationship.definition.kind === 'hasMany';\n}\n\nexport function forAllRelatedIdentifiers(rel: GraphEdge, cb: (identifier: StableRecordIdentifier) => void): void {\n  if (isBelongsTo(rel)) {\n    if (rel.remoteState) {\n      cb(rel.remoteState);\n    }\n    if (rel.localState && rel.localState !== rel.remoteState) {\n      cb(rel.localState);\n    }\n  } else if (isHasMany(rel)) {\n    // TODO\n    // rel.remoteMembers.forEach(cb);\n    // might be simpler if performance is not a concern\n    for (let i = 0; i < rel.remoteState.length; i++) {\n      const inverseIdentifier = rel.remoteState[i];\n      cb(inverseIdentifier);\n    }\n    rel.additions?.forEach(cb);\n  } else {\n    rel.localMembers.forEach(cb);\n    rel.remoteMembers.forEach((inverseIdentifier) => {\n      if (!rel.localMembers.has(inverseIdentifier)) {\n        cb(inverseIdentifier);\n      }\n    });\n  }\n}\n\n/*\n  Removes the given identifier from BOTH remote AND local state.\n\n  This method is useful when either a deletion or a rollback on a new record\n  needs to entirely purge itself from an inverse relationship.\n  */\nexport function removeIdentifierCompletelyFromRelationship(\n  graph: Graph,\n  relationship: GraphEdge,\n  value: StableRecordIdentifier,\n  silenceNotifications?: boolean\n): void {\n  if (isBelongsTo(relationship)) {\n    if (relationship.remoteState === value) {\n      relationship.remoteState = null;\n    }\n\n    if (relationship.localState === value) {\n      relationship.localState = null;\n      // This allows dematerialized inverses to be rematerialized\n      // we shouldn't be notifying here though, figure out where\n      // a notification was missed elsewhere.\n      if (!silenceNotifications) {\n        notifyChange(graph, relationship.identifier, relationship.definition.key);\n      }\n    }\n  } else if (isHasMany(relationship)) {\n    relationship.remoteMembers.delete(value);\n    relationship.additions?.delete(value);\n    const wasInRemovals = relationship.removals?.delete(value);\n\n    const canonicalIndex = relationship.remoteState.indexOf(value);\n    if (canonicalIndex !== -1) {\n      relationship.remoteState.splice(canonicalIndex, 1);\n    }\n\n    if (!wasInRemovals) {\n      const currentIndex = relationship.localState?.indexOf(value);\n      if (currentIndex !== -1 && currentIndex !== undefined) {\n        relationship.localState!.splice(currentIndex, 1);\n        // This allows dematerialized inverses to be rematerialized\n        // we shouldn't be notifying here though, figure out where\n        // a notification was missed elsewhere.\n        if (!silenceNotifications) {\n          notifyChange(graph, relationship.identifier, relationship.definition.key);\n        }\n      }\n    }\n  } else {\n    relationship.remoteMembers.delete(value);\n    relationship.localMembers.delete(value);\n  }\n}\n\n// TODO add silencing at the graph level\nexport function notifyChange(graph: Graph, identifier: StableRecordIdentifier, key: string) {\n  if (identifier === graph._removing) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`Graph: ignoring relationship change for removed identifier ${String(identifier)} ${key}`);\n    }\n    return;\n  }\n  if (LOG_GRAPH) {\n    // eslint-disable-next-line no-console\n    console.log(`Graph: notifying relationship change for ${String(identifier)} ${key}`);\n  }\n\n  graph.store.notifyChange(identifier, 'relationships', key);\n}\n\nexport function assertRelationshipData(\n  store: Store,\n  identifier: StableRecordIdentifier,\n  data: ResourceIdentifierObject,\n  meta: UpgradedMeta\n) {\n  assert(\n    `A ${identifier.type} record was pushed into the store with the value of ${meta.key} being '${JSON.stringify(\n      data\n    )}', but ${\n      meta.key\n    } is a belongsTo relationship so the value must not be an array. You should probably check your data payload or serializer.`,\n    !Array.isArray(data)\n  );\n  assert(\n    `Encountered a relationship identifier without a type for the ${meta.kind} relationship '${meta.key}' on <${\n      identifier.type\n    }:${String(identifier.id)}>, expected an identifier with type '${meta.type}' but found\\n\\n'${JSON.stringify(\n      data,\n      null,\n      2\n    )}'\\n\\nPlease check your serializer and make sure it is serializing the relationship payload into a JSON API format.`,\n    data === null || ('type' in data && typeof data.type === 'string' && data.type.length)\n  );\n  assert(\n    `Encountered a relationship identifier without an id for the ${meta.kind} relationship '${meta.key}' on <${\n      identifier.type\n    }:${String(identifier.id)}>, expected an identifier but found\\n\\n'${JSON.stringify(\n      data,\n      null,\n      2\n    )}'\\n\\nPlease check your serializer and make sure it is serializing the relationship payload into a JSON API format.`,\n    data === null || !!coerceId(data.id)\n  );\n  if (data?.type === meta.type) {\n    assert(\n      `Missing Schema: Encountered a relationship identifier { type: '${data.type}', id: '${String(\n        data.id\n      )}' } for the '${identifier.type}.${meta.key}' ${meta.kind} relationship on <${identifier.type}:${String(\n        identifier.id\n      )}>, but no schema exists for that type.`,\n      store.getSchemaDefinitionService().doesTypeExist(data.type)\n    );\n  } else {\n    assert(\n      `Missing Schema: Encountered a relationship identifier with type '${data.type}' for the ${\n        meta.kind\n      } relationship '${meta.key}' on <${identifier.type}:${String(\n        identifier.id\n      )}>, Expected an identifier with type '${meta.type}'. No schema was found for '${data.type}'.`,\n      data === null || !data.type || store.getSchemaDefinitionService().doesTypeExist(data.type)\n    );\n  }\n}\n","import { assert } from '@ember/debug';\nimport { DEBUG } from '@ember-data/env';\nimport type { UpgradedMeta } from '../-edge-definition';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { CacheCapabilitiesManager } from '@ember-data/store/-types/q/cache-store-wrapper';\n\n/*\n  Assert that `addedRecord` has a valid type so it can be added to the\n  relationship of the `record`.\n\n  The assert basically checks if the `addedRecord` can be added to the\n  relationship (specified via `relationshipMeta`) of the `record`.\n\n  This utility should only be used internally, as both record parameters must\n  be stable record identifiers and the `relationshipMeta` needs to be the meta\n  information about the relationship, retrieved via\n  `record.relationshipFor(key)`.\n*/\nlet assertPolymorphicType: (\n  parentIdentifier: StableRecordIdentifier,\n  parentDefinition: UpgradedMeta,\n  addedIdentifier: StableRecordIdentifier,\n  store: CacheCapabilitiesManager\n) => void;\nlet assertInheritedSchema: (definition: UpgradedMeta, type: string) => void;\n\nif (DEBUG) {\n  function validateSchema(definition: UpgradedMeta, meta: PrintConfig) {\n    const errors = new Map();\n\n    if (definition.inverseKey !== meta.name) {\n      errors.set('name', ` <---- should be '${definition.inverseKey}'`);\n    }\n    if (definition.inverseType !== meta.type) {\n      errors.set('type', ` <---- should be '${definition.inverseType}'`);\n    }\n    if (definition.inverseKind !== meta.kind) {\n      errors.set('type', ` <---- should be '${definition.inverseKind}'`);\n    }\n    if (definition.inverseIsAsync !== meta.options.async) {\n      errors.set('async', ` <---- should be ${definition.inverseIsAsync}`);\n    }\n    if (definition.inverseIsPolymorphic && definition.inverseIsPolymorphic !== meta.options.polymorphic) {\n      errors.set('polymorphic', ` <---- should be ${definition.inverseIsPolymorphic}`);\n    }\n    if (definition.key !== meta.options.inverse) {\n      errors.set('inverse', ` <---- should be '${definition.key}'`);\n    }\n    if (definition.type !== meta.options.as) {\n      errors.set('as', ` <---- should be '${definition.type}'`);\n    }\n\n    return errors;\n  }\n\n  type PrintConfig = {\n    name: string;\n    type: string;\n    kind: string;\n    options: {\n      as?: string;\n      async: boolean;\n      polymorphic?: boolean;\n      inverse: string | null;\n    };\n  };\n  type RelationshipSchemaError = 'name' | 'type' | 'kind' | 'as' | 'async' | 'polymorphic' | 'inverse';\n\n  function expectedSchema(definition: UpgradedMeta) {\n    return printSchema({\n      name: definition.inverseKey,\n      type: definition.inverseType,\n      kind: definition.inverseKind,\n      options: {\n        as: definition.type,\n        async: definition.inverseIsAsync,\n        polymorphic: definition.inverseIsPolymorphic || false,\n        inverse: definition.key,\n      },\n    });\n  }\n\n  function printSchema(config: PrintConfig, errors?: Map<RelationshipSchemaError, string>) {\n    return `\n\n\\`\\`\\`\n{\n  ${config.name}: {\n    name: '${config.name}',${errors?.get('name') || ''}\n    type: '${config.type}',${errors?.get('type') || ''}\n    kind: '${config.kind}',${errors?.get('kind') || ''}\n    options: {\n      as: '${config.options.as}',${errors?.get('as') || ''}\n      async: ${config.options.async},${errors?.get('async') || ''}\n      polymorphic: ${config.options.polymorphic},${errors?.get('polymorphic') || ''}\n      inverse: '${config.options.inverse}'${errors?.get('inverse') || ''}\n    }\n  }\n}\n\\`\\`\\`\n\n`;\n  }\n\n  function metaFrom(definition: UpgradedMeta) {\n    return {\n      name: definition.key,\n      type: definition.type,\n      kind: definition.kind,\n      options: {\n        async: definition.isAsync,\n        polymorphic: definition.isPolymorphic,\n        inverse: definition.inverseKey,\n      },\n    };\n  }\n  function inverseMetaFrom(definition: UpgradedMeta) {\n    return {\n      name: definition.inverseKey,\n      type: definition.inverseType,\n      kind: definition.inverseKind,\n      options: {\n        as: definition.isPolymorphic ? definition.type : undefined,\n        async: definition.inverseIsAsync,\n        polymorphic: definition.inverseIsPolymorphic,\n        inverse: definition.key,\n      },\n    };\n  }\n  function inverseDefinition(definition: UpgradedMeta): UpgradedMeta {\n    return {\n      key: definition.inverseKey,\n      type: definition.inverseType,\n      kind: definition.inverseKind,\n      isAsync: definition.inverseIsAsync,\n      isPolymorphic: true,\n      isCollection: definition.inverseIsCollection,\n      isImplicit: definition.inverseIsImplicit,\n      inverseKey: definition.key,\n      inverseType: definition.type,\n      inverseKind: definition.kind,\n      inverseIsAsync: definition.isAsync,\n      inverseIsPolymorphic: definition.isPolymorphic,\n      inverseIsImplicit: definition.isImplicit,\n      inverseIsCollection: definition.isCollection,\n      resetOnRemoteUpdate: definition.resetOnRemoteUpdate,\n    };\n  }\n  function definitionWithPolymorphic(definition: UpgradedMeta) {\n    return Object.assign({}, definition, { inverseIsPolymorphic: true });\n  }\n\n  assertInheritedSchema = function assertInheritedSchema(definition: UpgradedMeta, type: string) {\n    let meta1 = metaFrom(definition);\n    let meta2 = inverseMetaFrom(definition);\n    let errors1 = validateSchema(inverseDefinition(definition), meta1);\n    let errors2 = validateSchema(definitionWithPolymorphic(definition), meta2);\n\n    if (errors2.size === 0 && errors1.size > 0) {\n      throw new Error(\n        `The schema for the relationship '${type}.${definition.key}' is not configured to satisfy '${\n          definition.inverseType\n        }' and thus cannot utilize the '${definition.inverseType}.${definition.key}' relationship to connect with '${\n          definition.type\n        }.${\n          definition.inverseKey\n        }'\\n\\nIf using this relationship in a polymorphic manner is desired, the relationships schema definition for '${type}' should include:${printSchema(\n          meta1,\n          errors1\n        )}`\n      );\n    } else if (errors1.size > 0) {\n      throw new Error(\n        `The schema for the relationship '${type}.${definition.key}' is not configured to satisfy '${\n          definition.inverseType\n        }' and thus cannot utilize the '${definition.inverseType}.${definition.key}' relationship to connect with '${\n          definition.type\n        }.${\n          definition.inverseKey\n        }'\\n\\nIf using this relationship in a polymorphic manner is desired, the relationships schema definition for '${type}' should include:${printSchema(\n          meta1,\n          errors1\n        )} and the relationships schema definition for '${definition.type}' should include:${printSchema(\n          meta2,\n          errors2\n        )}`\n      );\n    } else if (errors2.size > 0) {\n      throw new Error(\n        `The schema for the relationship '${type}.${definition.key}' satisfies '${\n          definition.inverseType\n        }' but cannot utilize the '${definition.inverseType}.${definition.key}' relationship to connect with '${\n          definition.type\n        }.${\n          definition.inverseKey\n        }' because that relationship is not polymorphic.\\n\\nIf using this relationship in a polymorphic manner is desired, the relationships schema definition for '${\n          definition.type\n        }' should include:${printSchema(meta2, errors2)}`\n      );\n    }\n  };\n\n  assertPolymorphicType = function assertPolymorphicType(\n    parentIdentifier: StableRecordIdentifier,\n    parentDefinition: UpgradedMeta,\n    addedIdentifier: StableRecordIdentifier,\n    store: CacheCapabilitiesManager\n  ) {\n    if (parentDefinition.inverseIsImplicit) {\n      return;\n    }\n    if (parentDefinition.isPolymorphic) {\n      let meta = store.getSchemaDefinitionService().relationshipsDefinitionFor(addedIdentifier)[\n        parentDefinition.inverseKey\n      ];\n      assert(\n        `No '${parentDefinition.inverseKey}' field exists on '${\n          addedIdentifier.type\n        }'. To use this type in the polymorphic relationship '${parentDefinition.inverseType}.${\n          parentDefinition.key\n        }' the relationships schema definition for ${addedIdentifier.type} should include:${expectedSchema(\n          parentDefinition\n        )}`,\n        meta\n      );\n      assert(\n        `You should not specify both options.as and options.inverse as null on ${addedIdentifier.type}.${parentDefinition.inverseKey}, as if there is no inverse field there is no abstract type to conform to. You may have intended for this relationship to be polymorphic, or you may have mistakenly set inverse to null.`,\n        !(meta.options.inverse === null && meta?.options.as?.length)\n      );\n      let errors = validateSchema(parentDefinition, meta);\n      assert(\n        `The schema for the relationship '${parentDefinition.inverseKey}' on '${\n          addedIdentifier.type\n        }' type does not correctly implement '${parentDefinition.type}' and thus cannot be assigned to the '${\n          parentDefinition.key\n        }' relationship in '${\n          parentIdentifier.type\n        }'. If using this record in this polymorphic relationship is desired, correct the errors in the schema shown below:${printSchema(\n          meta,\n          errors\n        )}`,\n        errors.size === 0\n      );\n    } else if (addedIdentifier.type !== parentDefinition.type) {\n      // if we are not polymorphic\n      // then the addedIdentifier.type must be the same as the parentDefinition.type\n      let meta = store.getSchemaDefinitionService().relationshipsDefinitionFor(addedIdentifier)[\n        parentDefinition.inverseKey\n      ];\n      if (meta?.options.as === parentDefinition.type) {\n        // inverse is likely polymorphic but missing the polymorphic flag\n        let meta = store\n          .getSchemaDefinitionService()\n          .relationshipsDefinitionFor({ type: parentDefinition.inverseType })[parentDefinition.key];\n        let errors = validateSchema(definitionWithPolymorphic(inverseDefinition(parentDefinition)), meta);\n        assert(\n          `The '<${addedIdentifier.type}>.${\n            parentDefinition.inverseKey\n          }' relationship cannot be used polymorphically because '<${parentDefinition.inverseType}>.${\n            parentDefinition.key\n          } is not a polymorphic relationship. To use this relationship in a polymorphic manner, fix the following schema issues on the relationships schema for '${\n            parentDefinition.inverseType\n          }':${printSchema(meta, errors)}`\n        );\n      } else {\n        assert(\n          `The '${addedIdentifier.type}' type does not implement '${parentDefinition.type}' and thus cannot be assigned to the '${parentDefinition.key}' relationship in '${parentIdentifier.type}'. If this relationship should be polymorphic, mark ${parentDefinition.inverseType}.${parentDefinition.key} as \\`polymorphic: true\\` and ${addedIdentifier.type}.${parentDefinition.inverseKey} as implementing it via \\`as: '${parentDefinition.type}'\\`.`\n        );\n      }\n    }\n  };\n}\n\nexport { assertPolymorphicType, assertInheritedSchema };\n","import { assert, deprecate } from '@ember/debug';\n\nimport { DEPRECATE_RELATIONSHIP_REMOTE_UPDATE_CLEARING_LOCAL_STATE } from '@ember-data/deprecations';\nimport { DEBUG } from '@ember-data/env';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { ReplaceRelatedRecordsOperation } from '@warp-drive/core-types/graph';\n\nimport { _addLocal, _removeLocal, _removeRemote, diffCollection } from '../-diff';\nimport { isBelongsTo, isHasMany, isNew, notifyChange } from '../-utils';\nimport { assertPolymorphicType } from '../debug/assert-polymorphic-type';\nimport type { CollectionEdge } from '../edges/collection';\nimport type { Graph } from '../graph';\n\n/*\n    case many:1\n    ========\n    In a bi-directional graph with Many:1 edges, adding a value\n    results in up-to 3 discrete value transitions, while removing\n    a value is only 2 transitions.\n\n    For adding C to A\n    If: A <<-> B, C <->> D is the initial state,\n    and: B <->> A <<-> C, D is the final state\n\n    then we would undergo the following transitions.\n\n    add C to A\n    remove C from D\n    add A to C\n\n    For removing B from A\n    If: A <<-> B, C <->> D is the initial state,\n    and: A, B, C <->> D is the final state\n\n    then we would undergo the following transitions.\n\n    remove B from A\n    remove A from B\n\n    case many:many\n    ===========\n    In a bi-directional graph with Many:Many edges, adding or\n    removing a value requires only 2 value transitions.\n\n    For Adding\n    If: A<<->>B, C<<->>D is the initial state (double arrows representing the many side)\n    And: D<<->>C<<->>A<<->>B is the final state\n\n    Then we would undergo two transitions.\n\n    add C to A.\n    add A to C\n\n    For Removing\n    If: A<<->>B, C<<->>D is the initial state (double arrows representing the many side)\n    And: A, B, C<<->>D is the final state\n\n    Then we would undergo two transitions.\n\n    remove B from A\n    remove A from B\n\n    case many:?\n    ========\n    In a uni-directional graph with Many:? edges (modeled in EmberData with `inverse:null`) with\n    artificial (implicit) inverses, replacing a value results in 2 discrete value transitions.\n    This is because a Many:? relationship is effectively Many:Many.\n  */\nexport default function replaceRelatedRecords(graph: Graph, op: ReplaceRelatedRecordsOperation, isRemote: boolean) {\n  if (isRemote) {\n    replaceRelatedRecordsRemote(graph, op, isRemote);\n  } else {\n    replaceRelatedRecordsLocal(graph, op, isRemote);\n  }\n}\n\nfunction replaceRelatedRecordsLocal(graph: Graph, op: ReplaceRelatedRecordsOperation, isRemote: boolean) {\n  const identifiers = op.value;\n  const relationship = graph.get(op.record, op.field);\n  assert(`expected hasMany relationship`, isHasMany(relationship));\n  relationship.state.hasReceivedData = true;\n  const { additions, removals } = relationship;\n  const { inverseKey, type } = relationship.definition;\n  const { record } = op;\n  const wasDirty = relationship.isDirty;\n  relationship.isDirty = false;\n\n  const onAdd = (identifier: StableRecordIdentifier) => {\n    // Since we are diffing against the remote state, we check\n    // if our previous local state did not contain this identifier\n    const removalsHas = removals?.has(identifier);\n    if (removalsHas || !additions?.has(identifier)) {\n      if (type !== identifier.type) {\n        if (DEBUG) {\n          assertPolymorphicType(relationship.identifier, relationship.definition, identifier, graph.store);\n        }\n        graph.registerPolymorphicType(type, identifier.type);\n      }\n\n      relationship.isDirty = true;\n      addToInverse(graph, identifier, inverseKey, op.record, isRemote);\n\n      if (removalsHas) {\n        removals!.delete(identifier);\n      }\n    }\n  };\n\n  const onRemove = (identifier: StableRecordIdentifier) => {\n    // Since we are diffing against the remote state, we check\n    // if our previous local state had contained this identifier\n    const additionsHas = additions?.has(identifier);\n    if (additionsHas || !removals?.has(identifier)) {\n      relationship.isDirty = true;\n      removeFromInverse(graph, identifier, inverseKey, record, isRemote);\n\n      if (additionsHas) {\n        additions!.delete(identifier);\n      }\n    }\n  };\n\n  const diff = diffCollection(identifiers, relationship, onAdd, onRemove);\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  let becameDirty = relationship.isDirty || diff.changed;\n\n  // any additions no longer in the local state\n  // need to be removed from the inverse\n  if (additions && additions.size > 0) {\n    additions.forEach((identifier) => {\n      if (!diff.add.has(identifier)) {\n        becameDirty = true;\n        onRemove(identifier);\n      }\n    });\n  }\n\n  // any removals no longer in the local state\n  // need to be added back to the inverse\n  if (removals && removals.size > 0) {\n    removals.forEach((identifier) => {\n      if (!diff.del.has(identifier)) {\n        becameDirty = true;\n        onAdd(identifier);\n      }\n    });\n  }\n\n  relationship.additions = diff.add;\n  relationship.removals = diff.del;\n  relationship.localState = diff.finalState;\n  relationship.isDirty = wasDirty;\n\n  if (!wasDirty /*&& becameDirty // TODO to guard like this we need to detect reorder when diffing local */) {\n    notifyChange(graph, op.record, op.field);\n  }\n}\n\nfunction replaceRelatedRecordsRemote(graph: Graph, op: ReplaceRelatedRecordsOperation, isRemote: boolean) {\n  const identifiers = op.value;\n  const relationship = graph.get(op.record, op.field);\n\n  assert(\n    `You can only '${op.op}' on a hasMany relationship. ${op.record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isHasMany(relationship)\n  );\n  if (isRemote) {\n    graph._addToTransaction(relationship);\n  }\n  relationship.state.hasReceivedData = true;\n\n  // cache existing state\n  const { definition } = relationship;\n\n  const { type } = relationship.definition;\n\n  const diff = diffCollection(\n    identifiers,\n    relationship,\n    (identifier) => {\n      if (type !== identifier.type) {\n        if (DEBUG) {\n          assertPolymorphicType(relationship.identifier, relationship.definition, identifier, graph.store);\n        }\n        graph.registerPolymorphicType(type, identifier.type);\n      }\n      // commit additions\n      // TODO build this into the diff?\n      // because we are not dirty if this was a committed local addition\n      if (relationship.additions?.has(identifier)) {\n        relationship.additions.delete(identifier);\n      } else {\n        relationship.isDirty = true;\n      }\n      addToInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n    },\n    (identifier) => {\n      // commit removals\n      // TODO build this into the diff?\n      // because we are not dirty if this was a committed local addition\n      if (relationship.removals?.has(identifier)) {\n        relationship.removals.delete(identifier);\n      } else {\n        relationship.isDirty = true;\n      }\n      removeFromInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n    }\n  );\n\n  // replace existing state\n  relationship.remoteMembers = diff.finalSet;\n  relationship.remoteState = diff.finalState;\n\n  // changed also indicates a change in order\n  if (diff.changed) {\n    relationship.isDirty = true;\n  }\n\n  // TODO unsure if we need this but it\n  // may allow us to more efficiently patch\n  // the associated ManyArray\n  relationship._diff = diff;\n\n  if (DEPRECATE_RELATIONSHIP_REMOTE_UPDATE_CLEARING_LOCAL_STATE) {\n    // only do this for legacy hasMany, not collection\n    // and provide a way to incrementally migrate\n    if (relationship.definition.kind === 'hasMany' && relationship.definition.resetOnRemoteUpdate !== false) {\n      const deprecationInfo: {\n        removals: StableRecordIdentifier[];\n        additions: StableRecordIdentifier[];\n        triggered: boolean;\n      } = {\n        removals: [],\n        additions: [],\n        triggered: false,\n      };\n      if (relationship.removals) {\n        relationship.isDirty = true;\n        relationship.removals.forEach((identifier) => {\n          deprecationInfo.triggered = true;\n          deprecationInfo.removals.push(identifier);\n          // reverse the removal\n          // if we are still in removals at this point then\n          // we were not \"committed\" which means we are present\n          // in the remoteMembers. So we \"add back\" on the inverse.\n          addToInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n        });\n        relationship.removals = null;\n      }\n      if (relationship.additions) {\n        relationship.additions.forEach((identifier) => {\n          // reverse the addition\n          // if we are still in additions at this point then\n          // we were not \"committed\" which means we are not present\n          // in the remoteMembers. So we \"remove\" from the inverse.\n          // however we only do this if we are not a \"new\" record.\n          if (!isNew(identifier)) {\n            deprecationInfo.triggered = true;\n            deprecationInfo.additions.push(identifier);\n            relationship.isDirty = true;\n            relationship.additions!.delete(identifier);\n            removeFromInverse(graph, identifier, definition.inverseKey, op.record, isRemote);\n          }\n        });\n        if (relationship.additions.size === 0) {\n          relationship.additions = null;\n        }\n      }\n\n      if (deprecationInfo.triggered) {\n        deprecate(\n          `EmberData is changing the default semantics of updates to the remote state of relationships.\\n\\nThe following local state was cleared from the <${\n            relationship.identifier.type\n          }>.${\n            relationship.definition.key\n          } hasMany relationship but will not be once this deprecation is resolved by opting into the new behavior:\\n\\n\\tAdded: [${deprecationInfo.additions\n            .map((i) => i.lid)\n            .join(', ')}]\\n\\tRemoved: [${deprecationInfo.removals.map((i) => i.lid).join(', ')}]`,\n          false,\n          {\n            id: 'ember-data:deprecate-relationship-remote-update-clearing-local-state',\n            for: 'ember-data',\n            since: { enabled: '5.3', available: '5.3' },\n            until: '6.0',\n            url: 'https://deprecations.emberjs.com/v5.x#ember-data-deprecate-relationship-remote-update-clearing-local-state',\n          }\n        );\n      }\n    }\n  }\n\n  if (relationship.isDirty) {\n    flushCanonical(graph, relationship);\n  }\n}\n\nexport function addToInverse(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  key: string,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  const relationship = graph.get(identifier, key);\n  const { type } = relationship.definition;\n\n  if (type !== value.type) {\n    if (DEBUG) {\n      assertPolymorphicType(relationship.identifier, relationship.definition, value, graph.store);\n    }\n    graph.registerPolymorphicType(type, value.type);\n  }\n\n  if (isBelongsTo(relationship)) {\n    relationship.state.hasReceivedData = true;\n    relationship.state.isEmpty = false;\n\n    if (isRemote) {\n      graph._addToTransaction(relationship);\n      if (relationship.remoteState !== null) {\n        removeFromInverse(graph, relationship.remoteState, relationship.definition.inverseKey, identifier, isRemote);\n      }\n      relationship.remoteState = value;\n    }\n\n    if (relationship.localState !== value) {\n      if (!isRemote && relationship.localState) {\n        removeFromInverse(graph, relationship.localState, relationship.definition.inverseKey, identifier, isRemote);\n      }\n      relationship.localState = value;\n      notifyChange(graph, identifier, key);\n    }\n  } else if (isHasMany(relationship)) {\n    if (isRemote) {\n      // TODO this needs to alert stuffs\n      // And patch state better\n      // This is almost definitely wrong\n      // WARNING WARNING WARNING\n\n      if (!relationship.remoteMembers.has(value)) {\n        graph._addToTransaction(relationship);\n        relationship.remoteState.push(value);\n        relationship.remoteMembers.add(value);\n        if (relationship.additions?.has(value)) {\n          relationship.additions.delete(value);\n        } else {\n          relationship.isDirty = true;\n          relationship.state.hasReceivedData = true;\n          flushCanonical(graph, relationship);\n        }\n      }\n    } else {\n      if (_addLocal(graph, identifier, relationship, value, null)) {\n        notifyChange(graph, identifier, key);\n      }\n    }\n  } else {\n    if (isRemote) {\n      if (!relationship.remoteMembers.has(value)) {\n        relationship.remoteMembers.add(value);\n        relationship.localMembers.add(value);\n      }\n    } else {\n      if (!relationship.localMembers.has(value)) {\n        relationship.localMembers.add(value);\n      }\n    }\n  }\n}\n\nexport function notifyInverseOfPotentialMaterialization(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  key: string,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  const relationship = graph.get(identifier, key);\n  if (isHasMany(relationship) && isRemote && relationship.remoteMembers.has(value)) {\n    notifyChange(graph, identifier, key);\n  }\n}\n\nexport function removeFromInverse(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  key: string,\n  value: StableRecordIdentifier,\n  isRemote: boolean\n) {\n  const relationship = graph.get(identifier, key);\n\n  if (isBelongsTo(relationship)) {\n    relationship.state.isEmpty = true;\n    if (isRemote) {\n      graph._addToTransaction(relationship);\n      relationship.remoteState = null;\n    }\n    if (relationship.localState === value) {\n      relationship.localState = null;\n\n      notifyChange(graph, identifier, key);\n    }\n  } else if (isHasMany(relationship)) {\n    if (isRemote) {\n      graph._addToTransaction(relationship);\n      if (_removeRemote(relationship, value)) {\n        notifyChange(graph, identifier, key);\n      }\n    } else {\n      if (_removeLocal(relationship, value)) {\n        notifyChange(graph, identifier, key);\n      }\n    }\n  } else {\n    if (isRemote) {\n      relationship.remoteMembers.delete(value);\n      relationship.localMembers.delete(value);\n    } else {\n      if (value && relationship.localMembers.has(value)) {\n        relationship.localMembers.delete(value);\n      }\n    }\n  }\n}\n\nfunction flushCanonical(graph: Graph, rel: CollectionEdge) {\n  graph._scheduleLocalSync(rel);\n}\n","import { assert, deprecate } from '@ember/debug';\n\nimport { DEPRECATE_RELATIONSHIP_REMOTE_UPDATE_CLEARING_LOCAL_STATE } from '@ember-data/deprecations';\nimport { DEBUG } from '@ember-data/env';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { ReplaceRelatedRecordOperation } from '@warp-drive/core-types/graph';\n\nimport { isBelongsTo, isNew, notifyChange } from '../-utils';\nimport { assertPolymorphicType } from '../debug/assert-polymorphic-type';\nimport type { Graph } from '../graph';\nimport { addToInverse, notifyInverseOfPotentialMaterialization, removeFromInverse } from './replace-related-records';\n\nexport default function replaceRelatedRecord(graph: Graph, op: ReplaceRelatedRecordOperation, isRemote = false) {\n  const relationship = graph.get(op.record, op.field);\n  assert(\n    `You can only '${op.op}' on a belongsTo relationship. ${op.record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isBelongsTo(relationship)\n  );\n  if (isRemote) {\n    graph._addToTransaction(relationship);\n  }\n  const { definition, state } = relationship;\n  const prop = isRemote ? 'remoteState' : 'localState';\n  const existingState: StableRecordIdentifier | null = relationship[prop];\n\n  /*\n    case 1:1\n    ========\n    In a bi-directional graph with 1:1 edges, replacing a value\n    results in up-to 4 discrete value transitions.\n\n    If: A <-> B, C <-> D is the initial state,\n    and: A <-> C, B, D is the final state\n\n    then we would undergo the following 4 transitions.\n\n    remove A from B\n    add C to A\n    remove C from D\n    add A to C\n\n    case 1:many\n    ===========\n    In a bi-directional graph with 1:Many edges, replacing a value\n    results in up-to 3 discrete value transitions.\n\n    If: A<->>B<<->D, C<<->D is the initial state (double arrows representing the many side)\n    And: A<->>C<<->D, B<<->D is the final state\n\n    Then we would undergo three transitions.\n\n    remove A from B\n    add C to A.\n    add A to C\n\n    case 1:?\n    ========\n    In a uni-directional graph with 1:? edges (modeled in EmberData with `inverse:null`) with\n    artificial (implicit) inverses, replacing a value results in up-to 3 discrete value transitions.\n    This is because a 1:? relationship is effectively 1:many.\n\n    If: A->B, C->B is the initial state\n    And: A->C, C->B is the final state\n\n    Then we would undergo three transitions.\n\n    Remove A from B\n    Add C to A\n    Add A to C\n  */\n\n  // nothing for us to do\n  if (op.value === existingState) {\n    // if we were empty before but now know we are empty this needs to be true\n    state.hasReceivedData = true;\n    // if this is a remote update we still sync\n    if (isRemote) {\n      const { localState } = relationship;\n      // don't sync if localState is a new record and our remoteState is null\n      if (localState && isNew(localState) && !existingState) {\n        return;\n      }\n      if (existingState && localState === existingState) {\n        notifyInverseOfPotentialMaterialization(graph, existingState, definition.inverseKey, op.record, isRemote);\n      } else if (DEPRECATE_RELATIONSHIP_REMOTE_UPDATE_CLEARING_LOCAL_STATE) {\n        // if localState does not match existingState then we know\n        // we have a local mutation that has not been persisted yet\n        if (localState !== op.value && relationship.definition.resetOnRemoteUpdate !== false) {\n          relationship.localState = existingState;\n\n          deprecate(\n            `EmberData is changing the default semantics of updates to the remote state of relationships.\\n\\nThe following local state was cleared from the <${\n              relationship.identifier.type\n            }>.${\n              relationship.definition.key\n            } belongsTo relationship but will not be once this deprecation is resolved:\\n\\n\\t${\n              localState ? 'Added: ' + localState.lid + '\\n\\t' : ''\n            }${existingState ? 'Removed: ' + existingState.lid : ''}`,\n            false,\n            {\n              id: 'ember-data:deprecate-relationship-remote-update-clearing-local-state',\n              for: 'ember-data',\n              since: { enabled: '5.3', available: '5.3' },\n              until: '6.0',\n              url: 'https://deprecations.emberjs.com/v5.x#ember-data-deprecate-relationship-remote-update-clearing-local-state',\n            }\n          );\n\n          notifyChange(graph, relationship.identifier, relationship.definition.key);\n        }\n      }\n    }\n    return;\n  }\n\n  // remove this value from the inverse if required\n  if (existingState) {\n    removeFromInverse(graph, existingState, definition.inverseKey, op.record, isRemote);\n  }\n\n  // update value to the new value\n  relationship[prop] = op.value;\n  state.hasReceivedData = true;\n  state.isEmpty = op.value === null;\n  state.isStale = false;\n  state.hasFailedLoadAttempt = false;\n\n  if (op.value) {\n    if (definition.type !== op.value.type) {\n      // assert(\n      //   `The '<${definition.inverseType}>.${op.field}' relationship expects only '${definition.type}' records since it is not polymorphic. Received a Record of type '${op.value.type}'`,\n      //   definition.isPolymorphic\n      // );\n\n      // TODO this should now handle the deprecation warning if isPolymorphic is not set\n      // but the record does turn out to be polymorphic\n      // this should still assert if the user is relying on legacy inheritance/mixins to\n      // provide polymorphic behavior and has not yet added the polymorphic flags\n      if (DEBUG) {\n        assertPolymorphicType(relationship.identifier, definition, op.value, graph.store);\n      }\n\n      graph.registerPolymorphicType(definition.type, op.value.type);\n    }\n    addToInverse(graph, op.value, definition.inverseKey, op.record, isRemote);\n  }\n\n  if (isRemote) {\n    const { localState, remoteState } = relationship;\n    if (localState && isNew(localState) && !remoteState) {\n      return;\n    }\n    // when localState does not match the new remoteState and\n    // localState === existingState then we had no local mutation\n    // and we can safely sync the new remoteState to local\n    if (localState !== remoteState && localState === existingState) {\n      relationship.localState = remoteState;\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n      // But when localState does not match the new remoteState and\n      // and localState !== existingState then we know we have a local mutation\n      // that has not been persisted yet.\n    } else if (DEPRECATE_RELATIONSHIP_REMOTE_UPDATE_CLEARING_LOCAL_STATE) {\n      if (\n        localState !== remoteState &&\n        localState !== existingState &&\n        relationship.definition.resetOnRemoteUpdate !== false\n      ) {\n        relationship.localState = existingState;\n\n        deprecate(\n          `EmberData is changing the default semantics of updates to the remote state of relationships.\\n\\nThe following local state was cleared from the <${\n            relationship.identifier.type\n          }>.${\n            relationship.definition.key\n          } belongsTo relationship but will not be once this deprecation is resolved:\\n\\n\\t${\n            localState ? 'Added: ' + localState.lid + '\\n\\t' : ''\n          }${existingState ? 'Removed: ' + existingState.lid : ''}`,\n          false,\n          {\n            id: 'ember-data:deprecate-relationship-remote-update-clearing-local-state',\n            for: 'ember-data',\n            since: { enabled: '5.3', available: '5.3' },\n            until: '6.0',\n            url: 'https://deprecations.emberjs.com/v5.x#ember-data-deprecate-relationship-remote-update-clearing-local-state',\n          }\n        );\n\n        notifyChange(graph, relationship.identifier, relationship.definition.key);\n      }\n    }\n  } else {\n    notifyChange(graph, relationship.identifier, relationship.definition.key);\n  }\n}\n","import { assert, deprecate } from '@ember/debug';\n\nimport { DEPRECATE_NON_UNIQUE_PAYLOADS } from '@ember-data/deprecations';\nimport { DEBUG } from '@ember-data/env';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\n\nimport { isBelongsTo } from './-utils';\nimport { assertPolymorphicType } from './debug/assert-polymorphic-type';\nimport type { CollectionEdge } from './edges/collection';\nimport type { ResourceEdge } from './edges/resource';\nimport type { Graph } from './graph';\nimport replaceRelatedRecord from './operations/replace-related-record';\nimport replaceRelatedRecords from './operations/replace-related-records';\n\nfunction _deprecatedCompare<T>(\n  newState: T[],\n  newMembers: Set<T>,\n  prevState: T[],\n  prevSet: Set<T>,\n  onAdd: (v: T) => void,\n  onDel: (v: T) => void\n): { duplicates: Map<T, number[]>; diff: Diff<T> } {\n  const newLength = newState.length;\n  const prevLength = prevState.length;\n  const iterationLength = Math.max(newLength, prevLength);\n  let changed: boolean = newMembers.size !== prevSet.size;\n  const added = new Set<T>();\n  const removed = new Set<T>();\n  const duplicates = new Map<T, number[]>();\n  const finalSet = new Set<T>();\n  const finalState: T[] = [];\n\n  for (let i = 0, j = 0; i < iterationLength; i++) {\n    let adv = false;\n    let member: T | undefined;\n\n    // accumulate anything added\n    if (i < newLength) {\n      member = newState[i];\n\n      if (!finalSet.has(member)) {\n        finalState[j] = member;\n        finalSet.add(member);\n        adv = true;\n\n        if (!prevSet.has(member)) {\n          changed = true;\n          added.add(member);\n          onAdd(member);\n        }\n      } else {\n        let list = duplicates.get(member);\n\n        if (list === undefined) {\n          list = [];\n          duplicates.set(member, list);\n        }\n\n        list.push(i);\n      }\n    }\n\n    // accumulate anything removed\n    if (i < prevLength) {\n      const prevMember = prevState[i];\n\n      // detect reordering, adjusting index for duplicates\n      // j is always less than i and so if i < prevLength, j < prevLength\n      if (member !== prevState[j]) {\n        changed = true;\n      }\n\n      if (!newMembers.has(prevMember)) {\n        changed = true;\n        removed.add(prevMember);\n        onDel(prevMember);\n      }\n    } else if (adv && j < prevLength && member !== prevState[j]) {\n      changed = true;\n    }\n\n    if (adv) {\n      j++;\n    }\n  }\n\n  const diff = {\n    add: added,\n    del: removed,\n    finalState,\n    finalSet,\n    changed,\n  };\n\n  return {\n    diff,\n    duplicates,\n  };\n}\n\nfunction _compare<T>(\n  finalState: T[],\n  finalSet: Set<T>,\n  prevState: T[],\n  prevSet: Set<T>,\n  onAdd: (v: T) => void,\n  onDel: (v: T) => void\n): Diff<T> {\n  const finalLength = finalState.length;\n  const prevLength = prevState.length;\n  const iterationLength = Math.max(finalLength, prevLength);\n  const equalLength = finalLength === prevLength;\n  let changed: boolean = finalSet.size !== prevSet.size;\n  const added = new Set<T>();\n  const removed = new Set<T>();\n\n  for (let i = 0; i < iterationLength; i++) {\n    let member: T | undefined;\n\n    // accumulate anything added\n    if (i < finalLength) {\n      member = finalState[i];\n      if (!prevSet.has(member)) {\n        changed = true;\n        added.add(member);\n        onAdd(member);\n      }\n    }\n\n    // accumulate anything removed\n    if (i < prevLength) {\n      const prevMember = prevState[i];\n\n      // detect reordering\n      if (equalLength && member !== prevMember) {\n        changed = true;\n      }\n\n      if (!finalSet.has(prevMember)) {\n        changed = true;\n        removed.add(prevMember);\n        onDel(prevMember);\n      }\n    }\n  }\n\n  return {\n    add: added,\n    del: removed,\n    finalState,\n    finalSet,\n    changed,\n  };\n}\n\ntype Diff<T> = {\n  add: Set<T>;\n  del: Set<T>;\n  finalState: T[];\n  finalSet: Set<T>;\n  changed: boolean;\n};\n\nexport function diffCollection(\n  finalState: StableRecordIdentifier[],\n  relationship: CollectionEdge,\n  onAdd: (v: StableRecordIdentifier) => void,\n  onDel: (v: StableRecordIdentifier) => void\n): Diff<StableRecordIdentifier> {\n  const finalSet = new Set(finalState);\n  const { remoteState, remoteMembers } = relationship;\n\n  if (DEPRECATE_NON_UNIQUE_PAYLOADS) {\n    if (finalState.length !== finalSet.size) {\n      const { diff, duplicates } = _deprecatedCompare(finalState, finalSet, remoteState, remoteMembers, onAdd, onDel);\n\n      if (DEBUG) {\n        deprecate(\n          `Expected all entries in the relationship ${relationship.definition.type}:${relationship.definition.key} to be unique, see log for a list of duplicate entry indeces`,\n          false,\n          {\n            id: 'ember-data:deprecate-non-unique-relationship-entries',\n            for: 'ember-data',\n            until: '6.0',\n            since: { available: '5.3', enabled: '5.3' },\n          }\n        );\n        // eslint-disable-next-line no-console\n        console.log(duplicates);\n      }\n\n      return diff;\n    }\n  } else {\n    assert(\n      `Expected all entries in the relationship to be unique, found duplicates`,\n      finalState.length === finalSet.size\n    );\n  }\n\n  return _compare(finalState, finalSet, remoteState, remoteMembers, onAdd, onDel);\n}\n\nexport function computeLocalState(storage: CollectionEdge): StableRecordIdentifier[] {\n  if (!storage.isDirty) {\n    assert(`Expected localState to be present`, Array.isArray(storage.localState));\n    return storage.localState;\n  }\n\n  const state = storage.remoteState.slice();\n\n  storage.removals?.forEach((v) => {\n    const index = state.indexOf(v);\n    state.splice(index, 1);\n  });\n\n  storage.additions?.forEach((v) => {\n    state.push(v);\n  });\n  storage.localState = state;\n  storage.isDirty = false;\n\n  return state;\n}\n\nexport function _addLocal(\n  graph: Graph,\n  record: StableRecordIdentifier,\n  relationship: CollectionEdge,\n  value: StableRecordIdentifier,\n  index: number | null\n): boolean {\n  const { remoteMembers, removals } = relationship;\n  let additions = relationship.additions;\n  const hasPresence = remoteMembers.has(value) || additions?.has(value);\n\n  if (hasPresence && !removals?.has(value)) {\n    assert(\n      `Attempted to add the resource '${value.lid}' to the collection <${relationship.identifier.type}>.${relationship.definition.key} it was already in`,\n      hasPresence && !removals?.has(value)\n    );\n    return false;\n  }\n\n  if (removals?.has(value)) {\n    removals.delete(value);\n  } else {\n    if (!additions) {\n      additions = relationship.additions = new Set();\n    }\n\n    relationship.state.hasReceivedData = true;\n    additions.add(value);\n\n    const { type } = relationship.definition;\n    if (type !== value.type) {\n      if (DEBUG) {\n        assertPolymorphicType(record, relationship.definition, value, graph.store);\n      }\n      graph.registerPolymorphicType(value.type, type);\n    }\n  }\n\n  // if we have existing localState\n  // and we have an index\n  // apply the change, as this is more efficient\n  // than recomputing localState and\n  // it allows us to preserve local ordering\n  // to a small extend. Local ordering should not\n  // be relied upon as any remote change will blow it away\n  if (relationship.localState) {\n    if (index !== null) {\n      relationship.localState.splice(index, 0, value);\n    } else {\n      relationship.localState.push(value);\n    }\n  }\n  assert(\n    `Expected relationship to be dirty when adding a local mutation`,\n    relationship.localState || relationship.isDirty\n  );\n\n  return true;\n}\n\nexport function _removeLocal(relationship: CollectionEdge, value: StableRecordIdentifier): boolean {\n  assert(`expected an identifier to remove from the collection relationship`, value);\n  const { remoteMembers, additions } = relationship;\n  let removals = relationship.removals;\n  const hasPresence = remoteMembers.has(value) || additions?.has(value);\n\n  if (!hasPresence || removals?.has(value)) {\n    assert(\n      `Attempted to remove the resource '${value.lid}' from the collection <${relationship.identifier.type}>.${relationship.definition.key} but it was not present`,\n      !hasPresence || removals?.has(value)\n    );\n    return false;\n  }\n\n  if (additions?.has(value)) {\n    additions.delete(value);\n  } else {\n    if (!removals) {\n      removals = relationship.removals = new Set();\n    }\n\n    removals.add(value);\n  }\n\n  // if we have existing localState\n  // apply the change, as this is more efficient\n  // than recomputing localState and\n  // it allows us to preserve local ordering\n  // to a small extend. Local ordering should not\n  // be relied upon as any remote change will blow it away\n  if (relationship.localState) {\n    const index = relationship.localState.indexOf(value);\n    assert(`Cannot remove a resource that is not present`, index !== -1);\n    relationship.localState.splice(index, 1);\n  }\n  assert(\n    `Expected relationship to be dirty when performing a local mutation`,\n    relationship.localState || relationship.isDirty\n  );\n\n  return true;\n}\n\nexport function _removeRemote(relationship: CollectionEdge, value: StableRecordIdentifier): boolean {\n  assert(`expected an identifier to remove from the collection relationship`, value);\n  const { remoteMembers, additions, removals, remoteState } = relationship;\n\n  assert(`Cannot remove a resource that is not present`, remoteMembers.has(value));\n  if (!remoteMembers.has(value)) {\n    return false;\n  }\n\n  // remove from remote state\n  remoteMembers.delete(value);\n  let index = remoteState.indexOf(value);\n  assert(`Cannot remove a resource that is not present`, index !== -1);\n  remoteState.splice(index, 1);\n\n  // remove from removals if present\n  if (removals?.has(value)) {\n    removals.delete(value);\n\n    // nothing more to do this was our state already\n    return false;\n  }\n\n  assert(\n    `Remote state indicated removal of a resource that was present only as a local mutation`,\n    !additions?.has(value)\n  );\n\n  // if we have existing localState\n  // and we have an index\n  // apply the change, as this is more efficient\n  // than recomputing localState and\n  // it allows us to preserve local ordering\n  // to a small extend. Local ordering should not\n  // be relied upon as any remote change will blow it away\n  if (relationship.localState) {\n    index = relationship.localState.indexOf(value);\n    assert(`Cannot remove a resource that is not present`, index !== -1);\n    relationship.localState.splice(index, 1);\n  }\n  assert(\n    `Expected relationship to be dirty when performing a local mutation`,\n    relationship.localState || relationship.isDirty\n  );\n\n  return true;\n}\n\nexport function rollbackRelationship(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  field: string,\n  relationship: CollectionEdge | ResourceEdge\n): void {\n  if (isBelongsTo(relationship)) {\n    replaceRelatedRecord(\n      graph,\n      {\n        op: 'replaceRelatedRecord',\n        record: identifier,\n        field,\n        value: relationship.remoteState,\n      },\n      false\n    );\n  } else {\n    replaceRelatedRecords(\n      graph,\n      {\n        op: 'replaceRelatedRecords',\n        record: identifier,\n        field,\n        value: relationship.remoteState.slice(),\n      },\n      false\n    );\n  }\n}\n","import { assert } from '@ember/debug';\n\nimport { DEBUG } from '@ember-data/env';\nimport type Store from '@ember-data/store';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { RelationshipSchema } from '@warp-drive/core-types/schema';\n\nimport { expandingGet, expandingSet, getStore } from './-utils';\nimport { assertInheritedSchema } from './debug/assert-polymorphic-type';\nimport type { Graph } from './graph';\n\nexport type EdgeCache = Record<string, Record<string, EdgeDefinition | null>>;\n\n/**\n *\n * Given RHS (Right Hand Side)\n *\n * ```ts\n * class User extends Model {\n *   @hasMany('animal', { async: false, inverse: 'owner' }) pets;\n * }\n * ```\n *\n * Given LHS (Left Hand Side)\n *\n * ```ts\n * class Animal extends Model {\n *  @belongsTo('user', { async: false, inverse: 'pets' }) owner;\n * }\n * ```\n *\n * The UpgradedMeta for the RHS would be:\n *\n * ```ts\n * {\n *   kind: 'hasMany',\n *   key: 'pets',\n *   type: 'animal',\n *   isAsync: false,\n *   isImplicit: false,\n *   isCollection: true,\n *   isPolymorphic: false,\n *   inverseKind: 'belongsTo',\n *   inverseKey: 'owner',\n *   inverseType: 'user',\n *   inverseIsAsync: false,\n *   inverseIsImplicit: false,\n *   inverseIsCollection: false,\n *   inverseIsPolymorphic: false,\n * }\n * ```\n *\n * The UpgradeMeta for the LHS would be:\n *\n * ```ts\n * {\n *   kind: 'belongsTo',\n *   key: 'owner',\n *   type: 'user',\n *   isAsync: false,\n *   isImplicit: false,\n *   isCollection: false,\n *   isPolymorphic: false,\n *   inverseKind: 'hasMany',\n *   inverseKey: 'pets',\n *   inverseType: 'animal',\n *   inverseIsAsync: false,\n *   inverseIsImplicit: false,\n *   inverseIsCollection: true,\n *   inverseIsPolymorphic: false,\n * }\n * ```\n *\n *\n * @class UpgradedMeta\n * @internal\n */\nexport interface UpgradedMeta {\n  kind: 'hasMany' | 'belongsTo' | 'implicit';\n  /**\n   * The field name on `this` record\n   *\n   * @internal\n   */\n  key: string;\n  /**\n   * The `type` of the related record\n   *\n   * @internal\n   */\n  type: string;\n  isAsync: boolean;\n  isImplicit: boolean;\n  isCollection: boolean;\n  isPolymorphic: boolean;\n  resetOnRemoteUpdate: boolean;\n\n  inverseKind: 'hasMany' | 'belongsTo' | 'implicit';\n  /**\n   * The field name on the opposing record\n   * @internal\n   */\n  inverseKey: string;\n  /**\n   * The `type` of `this` record\n   * @internal\n   */\n  inverseType: string;\n  inverseIsAsync: boolean;\n  inverseIsImplicit: boolean;\n  inverseIsCollection: boolean;\n  inverseIsPolymorphic: boolean;\n}\n\nexport interface EdgeDefinition {\n  lhs_key: string;\n  lhs_modelNames: string[];\n  lhs_baseModelName: string;\n  lhs_relationshipName: string;\n  lhs_definition: UpgradedMeta;\n  lhs_isPolymorphic: boolean;\n\n  rhs_key: string;\n  rhs_modelNames: string[];\n  rhs_baseModelName: string;\n  rhs_relationshipName: string;\n  rhs_definition: UpgradedMeta | null;\n  rhs_isPolymorphic: boolean;\n\n  hasInverse: boolean;\n\n  /**\n   * Whether this relationship points back at the same type.\n   *\n   * If the relationship is polymorphic, this will be true if\n   * it points back at the same abstract type.\n   *\n   * @internal\n   */\n  isSelfReferential: boolean;\n\n  /**\n   * If this is a reflexive relationship, this is true\n   * if the relationship also points back at the same\n   * field.\n   *\n   * @internal\n   */\n  isReflexive: boolean;\n}\n\nconst BOOL_LATER = null as unknown as boolean;\nconst STR_LATER = '';\nconst IMPLICIT_KEY_RAND = Date.now();\n\nfunction implicitKeyFor(type: string, key: string): string {\n  return `implicit-${type}:${key}${IMPLICIT_KEY_RAND}`;\n}\n\nfunction syncMeta(definition: UpgradedMeta, inverseDefinition: UpgradedMeta) {\n  definition.inverseKind = inverseDefinition.kind;\n  definition.inverseKey = inverseDefinition.key;\n  definition.inverseType = inverseDefinition.type;\n  definition.inverseIsAsync = inverseDefinition.isAsync;\n  definition.inverseIsCollection = inverseDefinition.isCollection;\n  definition.inverseIsPolymorphic = inverseDefinition.isPolymorphic;\n  definition.inverseIsImplicit = inverseDefinition.isImplicit;\n  const resetOnRemoteUpdate =\n    definition.resetOnRemoteUpdate === false || inverseDefinition.resetOnRemoteUpdate === false ? false : true;\n  definition.resetOnRemoteUpdate = resetOnRemoteUpdate;\n  inverseDefinition.resetOnRemoteUpdate = resetOnRemoteUpdate;\n}\n\nfunction upgradeMeta(meta: RelationshipSchema): UpgradedMeta {\n  const niceMeta: UpgradedMeta = {} as UpgradedMeta;\n  const options = meta.options;\n  niceMeta.kind = meta.kind;\n  niceMeta.key = meta.name;\n  niceMeta.type = meta.type;\n  assert(`Expected relationship definition to specify async`, typeof options?.async === 'boolean');\n  niceMeta.isAsync = options.async;\n  niceMeta.isImplicit = false;\n  niceMeta.isCollection = meta.kind === 'hasMany';\n  niceMeta.isPolymorphic = options && !!options.polymorphic;\n\n  niceMeta.inverseKey = (options && options.inverse) || STR_LATER;\n  niceMeta.inverseType = STR_LATER;\n  niceMeta.inverseIsAsync = BOOL_LATER;\n  niceMeta.inverseIsImplicit = (options && options.inverse === null) || BOOL_LATER;\n  niceMeta.inverseIsCollection = BOOL_LATER;\n\n  niceMeta.resetOnRemoteUpdate = options && options.resetOnRemoteUpdate === false ? false : true;\n\n  return niceMeta;\n}\n\nfunction assertConfiguration(info: EdgeDefinition, type: string, key: string) {\n  if (DEBUG) {\n    const isSelfReferential = info.isSelfReferential;\n\n    if (isSelfReferential) {\n      return true;\n    }\n\n    const _isRHS =\n      key === info.rhs_relationshipName &&\n      (type === info.rhs_baseModelName || // base or non-polymorphic\n        // if the other side is polymorphic then we need to scan our modelNames\n        (info.lhs_isPolymorphic && info.rhs_modelNames.includes(type))); // polymorphic\n    const _isLHS =\n      key === info.lhs_relationshipName &&\n      (type === info.lhs_baseModelName || // base or non-polymorphic\n        // if the other side is polymorphic then we need to scan our modelNames\n        (info.rhs_isPolymorphic && info.lhs_modelNames.includes(type))); // polymorphic;\n\n    if (!_isRHS && !_isLHS) {\n      /*\n        this occurs when we are likely polymorphic but not configured to be polymorphic\n        most often due to extending a class that has a relationship definition on it.\n\n        e.g.\n\n        ```ts\n        class Pet extends Model {\n          @belongsTo('human', { async: false, inverse: 'pet' }) owner;\n        }\n        class Human extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner' }) pet;\n        }\n        class Farmer extends Human {}\n        ```\n\n        In the above case, the following would trigger this error:\n\n        ```ts\n        let pet = store.createRecord('pet');\n        let farmer = store.createRecord('farmer');\n        farmer.pet = pet; // error\n        ```\n\n        The correct way to fix this is to specify the polymorphic option on Pet\n        and to specify the abstract type 'human' on the Human base class.\n\n        ```ts\n        class Pet extends Model {\n          @belongsTo('human', { async: false, inverse: 'pet', polymorphic: true }) owner;\n        }\n        class Human extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner', as: 'human' }) pet;\n        }\n        class Farmer extends Human {}\n        ```\n\n        Alternatively both Human and Farmer could declare the relationship, because relationship\n        definitions are \"structural\".\n\n        ```ts\n        class Pet extends Model {\n          @belongsTo('human', { async: false, inverse: 'pet', polymorphic: true }) owner;\n        }\n        class Human extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner', as: 'human' }) pet;\n        }\n        class Farmer extends Model {\n          @belongsTo('pet', { async: false, inverse: 'owner', as: 'human' }) pet;\n        }\n        ```\n\n       */\n      if (key === info.lhs_relationshipName && info.lhs_modelNames.includes(type)) {\n        // parentIdentifier, parentDefinition, addedIdentifier, store\n        assertInheritedSchema(info.lhs_definition, type);\n      } else if (key === info.rhs_relationshipName && info.rhs_modelNames.includes(type)) {\n        assertInheritedSchema(info.lhs_definition, type);\n      }\n      // OPEN AN ISSUE :: we would like to improve our errors but need to understand what corner case got us here\n      throw new Error(\n        `PLEASE OPEN AN ISSUE :: Found a relationship that is neither the LHS nor RHS of the same edge. This is not supported. Please report this to the EmberData team.`\n      );\n    }\n\n    if (_isRHS && _isLHS) {\n      // not sure how we get here but it's probably the result of some form of inheritance\n      // without having specified polymorphism correctly leading to it not being self-referential\n      // OPEN AN ISSUE :: we would like to improve our errors but need to understand what corner case got us here\n      throw new Error(\n        `PLEASE OPEN AN ISSUE :: Found a relationship that is both the LHS and RHS of the same edge but is not self-referential. This is not supported. Please report this to the EmberData team.`\n      );\n    }\n  }\n}\n\nexport function isLHS(info: EdgeDefinition, type: string, key: string): boolean {\n  const isSelfReferential = info.isSelfReferential;\n  const isRelationship = key === info.lhs_relationshipName;\n\n  if (DEBUG) {\n    assertConfiguration(info, type, key);\n  }\n\n  if (isRelationship === true) {\n    return (\n      isSelfReferential === true || // itself\n      type === info.lhs_baseModelName || // base or non-polymorphic\n      // if the other side is polymorphic then we need to scan our modelNames\n      (info.rhs_isPolymorphic && info.lhs_modelNames.includes(type)) // polymorphic\n    );\n  }\n\n  return false;\n}\n\nexport function isRHS(info: EdgeDefinition, type: string, key: string): boolean {\n  const isSelfReferential = info.isSelfReferential;\n  const isRelationship = key === info.rhs_relationshipName;\n\n  if (DEBUG) {\n    assertConfiguration(info, type, key);\n  }\n\n  if (isRelationship === true) {\n    return (\n      isSelfReferential === true || // itself\n      type === info.rhs_baseModelName || // base or non-polymorphic\n      // if the other side is polymorphic then we need to scan our modelNames\n      (info.lhs_isPolymorphic && info.rhs_modelNames.includes(type)) // polymorphic\n    );\n  }\n\n  return false;\n}\n\nexport function upgradeDefinition(\n  graph: Graph,\n  identifier: StableRecordIdentifier,\n  propertyName: string,\n  isImplicit = false\n): EdgeDefinition | null {\n  const cache = graph._definitionCache;\n  const storeWrapper = graph.store;\n  const polymorphicLookup = graph._potentialPolymorphicTypes;\n\n  const { type } = identifier;\n  let cached = /*#__NOINLINE__*/ expandingGet<EdgeDefinition | null>(cache, type, propertyName);\n\n  // CASE: We have a cached resolution (null if no relationship exists)\n  if (cached !== undefined) {\n    return cached;\n  }\n\n  assert(\n    `Expected to find relationship definition in the cache for the implicit relationship ${propertyName}`,\n    !isImplicit\n  );\n\n  const relationships = storeWrapper.getSchemaDefinitionService().relationshipsDefinitionFor(identifier);\n  assert(`Expected to have a relationship definition for ${type} but none was found.`, relationships);\n  const meta = relationships[propertyName];\n\n  if (!meta) {\n    // TODO potentially we should just be permissive here since this is an implicit relationship\n    // and not require the lookup table to be populated\n    if (polymorphicLookup[type]) {\n      const altTypes = Object.keys(polymorphicLookup[type]);\n      for (let i = 0; i < altTypes.length; i++) {\n        const _cached = expandingGet<EdgeDefinition | null>(cache, altTypes[i], propertyName);\n        if (_cached) {\n          /*#__NOINLINE__*/ expandingSet<EdgeDefinition | null>(cache, type, propertyName, _cached);\n          _cached.rhs_modelNames.push(type);\n          return _cached;\n        }\n      }\n    }\n\n    // CASE: We don't have a relationship at all\n    // we should only hit this in prod\n    assert(`Expected a relationship schema for '${type}.${propertyName}', but no relationship schema was found.`, meta);\n\n    cache[type]![propertyName] = null;\n    return null;\n  }\n  const definition = /*#__NOINLINE__*/ upgradeMeta(meta);\n\n  let inverseDefinition: UpgradedMeta | null;\n  let inverseKey: string | null;\n  const inverseType = definition.type;\n\n  // CASE: Inverse is explicitly null\n  if (definition.inverseKey === null) {\n    // TODO probably dont need this assertion if polymorphic\n    assert(`Expected the inverse model to exist`, getStore(storeWrapper).modelFor(inverseType));\n    inverseDefinition = null;\n  } else {\n    inverseKey = /*#__NOINLINE__*/ inverseForRelationship(getStore(storeWrapper), identifier, propertyName);\n\n    // CASE: If we are polymorphic, and we declared an inverse that is non-null\n    // we must assume that the lack of inverseKey means that there is no\n    // concrete type as the baseType, so we must construct and artificial\n    // placeholder\n    if (!inverseKey && definition.isPolymorphic && definition.inverseKey) {\n      inverseDefinition = {\n        kind: 'belongsTo', // this must be updated when we find the first belongsTo or hasMany definition that matches\n        key: definition.inverseKey,\n        type: type,\n        isAsync: false, // this must be updated when we find the first belongsTo or hasMany definition that matches\n        isImplicit: false,\n        isCollection: false, // this must be updated when we find the first belongsTo or hasMany definition that matches\n        isPolymorphic: false,\n      } as UpgradedMeta; // the rest of the fields are populated by syncMeta\n\n      // CASE: Inverse resolves to null\n    } else if (!inverseKey) {\n      inverseDefinition = null;\n    } else {\n      // CASE: We have an explicit inverse or were able to resolve one\n      const inverseDefinitions = storeWrapper\n        .getSchemaDefinitionService()\n        .relationshipsDefinitionFor({ type: inverseType });\n      assert(`Expected to have a relationship definition for ${inverseType} but none was found.`, inverseDefinitions);\n      const metaFromInverse = inverseDefinitions[inverseKey];\n      assert(\n        `Expected a relationship schema for '${inverseType}.${inverseKey}' to match the inverse of '${type}.${propertyName}', but no relationship schema was found.`,\n        metaFromInverse\n      );\n\n      inverseDefinition = upgradeMeta(metaFromInverse);\n    }\n  }\n\n  // CASE: We have no inverse\n  if (!inverseDefinition) {\n    // polish off meta\n    inverseKey = /*#__NOINLINE__*/ implicitKeyFor(type, propertyName);\n    inverseDefinition = {\n      kind: 'implicit',\n      key: inverseKey,\n      type: type,\n      isAsync: false,\n      isImplicit: true,\n      isCollection: true, // with implicits any number of records could point at us\n      isPolymorphic: false,\n    } as UpgradedMeta; // the rest of the fields are populated by syncMeta\n\n    syncMeta(definition, inverseDefinition);\n    syncMeta(inverseDefinition, definition);\n\n    const info = {\n      lhs_key: `${type}:${propertyName}`,\n      lhs_modelNames: [type],\n      lhs_baseModelName: type,\n      lhs_relationshipName: propertyName,\n      lhs_definition: definition,\n      lhs_isPolymorphic: definition.isPolymorphic,\n\n      rhs_key: inverseDefinition.key,\n      rhs_modelNames: [inverseType],\n      rhs_baseModelName: inverseType,\n      rhs_relationshipName: inverseDefinition.key,\n      rhs_definition: inverseDefinition,\n      rhs_isPolymorphic: false,\n\n      hasInverse: false,\n      isSelfReferential: type === inverseType, // this could be wrong if we are self-referential but also polymorphic\n      isReflexive: false, // we can't be reflexive if we don't define an inverse\n    };\n\n    expandingSet<EdgeDefinition | null>(cache, inverseType, inverseKey, info);\n    expandingSet<EdgeDefinition | null>(cache, type, propertyName, info);\n    return info;\n  }\n\n  // CASE: We do have an inverse\n  const baseType = inverseDefinition.type;\n\n  // TODO we want to assert this but this breaks all of our shoddily written tests\n  /*\n    if (DEBUG) {\n      let inverseDoubleCheck = inverseFor(inverseRelationshipName, store);\n\n      assert(`The ${inverseBaseModelName}:${inverseRelationshipName} relationship declares 'inverse: null', but it was resolved as the inverse for ${baseModelName}:${relationshipName}.`, inverseDoubleCheck);\n    }\n  */\n  // CASE: We may have already discovered the inverse for the baseModelName\n  // CASE: We have already discovered the inverse\n  assert(\n    `We should have determined an inverseKey by now, open an issue if this is hit`,\n    typeof inverseKey! === 'string' && inverseKey.length > 0\n  );\n  cached = expandingGet(cache, baseType, propertyName) || expandingGet(cache, inverseType, inverseKey);\n\n  if (cached) {\n    // TODO this assert can be removed if the above assert is enabled\n    assert(\n      `The ${inverseType}:${inverseKey} relationship declares 'inverse: null', but it was resolved as the inverse for ${type}:${propertyName}.`,\n      cached.hasInverse !== false\n    );\n\n    const _isLHS = cached.lhs_baseModelName === baseType;\n    const modelNames = _isLHS ? cached.lhs_modelNames : cached.rhs_modelNames;\n    // make this lookup easier in the future by caching the key\n    modelNames.push(type);\n    expandingSet<EdgeDefinition | null>(cache, type, propertyName, cached);\n\n    return cached;\n  }\n\n  // this is our first time so polish off the metas\n  syncMeta(definition, inverseDefinition);\n  syncMeta(inverseDefinition, definition);\n\n  const lhs_modelNames = [type];\n  if (type !== baseType) {\n    lhs_modelNames.push(baseType);\n  }\n  const isSelfReferential = baseType === inverseType;\n  const info = {\n    lhs_key: `${baseType}:${propertyName}`,\n    lhs_modelNames,\n    lhs_baseModelName: baseType,\n    lhs_relationshipName: propertyName,\n    lhs_definition: definition,\n    lhs_isPolymorphic: definition.isPolymorphic,\n\n    rhs_key: `${inverseType}:${inverseKey}`,\n    rhs_modelNames: [inverseType],\n    rhs_baseModelName: inverseType,\n    rhs_relationshipName: inverseKey,\n    rhs_definition: inverseDefinition,\n    rhs_isPolymorphic: inverseDefinition.isPolymorphic,\n    hasInverse: true,\n    isSelfReferential,\n    isReflexive: isSelfReferential && propertyName === inverseKey,\n  };\n\n  // Create entries for the baseModelName as well as modelName to speed up\n  //  inverse lookups\n  expandingSet<EdgeDefinition | null>(cache, baseType, propertyName, info);\n  expandingSet<EdgeDefinition | null>(cache, type, propertyName, info);\n\n  // Greedily populate the inverse\n  expandingSet<EdgeDefinition | null>(cache, inverseType, inverseKey, info);\n\n  return info;\n}\n\nfunction inverseForRelationship(store: Store, identifier: StableRecordIdentifier | { type: string }, key: string) {\n  const definition = store.getSchemaDefinitionService().relationshipsDefinitionFor(identifier)[key];\n  if (!definition) {\n    return null;\n  }\n\n  assert(\n    `Expected the relationship defintion to specify the inverse type or null.`,\n    definition.options?.inverse === null ||\n      (typeof definition.options?.inverse === 'string' && definition.options.inverse.length > 0)\n  );\n  return definition.options.inverse;\n}\n","export interface RelationshipState {\n  /*\n      This flag indicates whether we should consider the content\n       of this relationship \"known\".\n\n      If we have no relationship knowledge, and the relationship\n       is `async`, we will attempt to fetch the relationship on\n       access if it is also stale.\n\n     Snapshot uses this to tell the difference between unknown\n      (`undefined`) or empty (`null`). The reason for this is that\n      we wouldn't want to serialize  unknown relationships as `null`\n      as that might overwrite remote state.\n\n      All relationships for a newly created (`store.createRecord()`) are\n       considered known (`hasReceivedData === true`).\n\n      true when\n        => we receive a push with either new data or explicit empty (`[]` or `null`)\n        => the relationship is a belongsTo and we have received data from\n             the other side.\n\n      false when\n        => we have received no signal about what data belongs in this relationship\n        => the relationship is a hasMany and we have only received data from\n            the other side.\n     */\n  hasReceivedData: boolean;\n  /*\n      Flag that indicates whether an empty relationship is explicitly empty\n        (signaled by push giving us an empty array or null relationship)\n        e.g. an API response has told us that this relationship is empty.\n\n      Thus far, it does not appear that we actually need this flag; however,\n        @runspired has found it invaluable when debugging relationship tests\n        to determine whether (and why if so) we are in an incorrect state.\n\n      true when\n        => we receive a push with explicit empty (`[]` or `null`)\n        => we have received no signal about what data belongs in this relationship\n        => on initial create (as no signal is known yet)\n\n      false at all other times\n     */\n\n  isEmpty: boolean;\n  /*\n       This flag indicates whether we should\n        re-fetch the relationship the next time\n        it is accessed.\n\n        The difference between this flag and `shouldForceReload`\n        is in how we treat the presence of partially missing data:\n          - for a forced reload, we will reload the link or EVERY record\n          - for a stale reload, we will reload the link (if present) else only MISSING records\n\n        Ideally these flags could be merged, but because we don't give the\n        request layer the option of deciding how to resolve the data being queried\n        we are forced to differentiate for now.\n\n        It is also possible for a relationship to remain stale after a forced reload; however,\n        in this case `state.hasFailedLoadAttempt` ought to be `true`.\n\n      false when\n        => cache.isNew(identifier) on initial setup\n        => a previously triggered request has resolved\n        => we get relationship data via push\n\n      true when\n        => !cache.isNew(identifier) on initial setup\n        => an inverse has been unloaded\n        => we get a new link for the relationship\n\n      TODO @runspired unskip the acceptance tests and fix these flags\n     */\n  isStale: boolean;\n\n  hasFailedLoadAttempt: boolean;\n  /*\n     This flag forces fetch. `true` for a single request once `reload()`\n       has been called `false` at all other times.\n    */\n  shouldForceReload: boolean;\n  /*\n     This flag indicates whether we should\n      **partially** re-fetch the relationship the\n      next time it is accessed.\n\n    false when\n      => initial setup\n      => a previously triggered request has resolved\n\n    true when\n      => an inverse has been unloaded\n    */\n  hasDematerializedInverse: boolean;\n\n  // TODO do we want this anymore? Seems somewhat useful\n  //   especially if we rename to `hasUpdatedLink`\n  //   which would tell us slightly more about why the\n  //   relationship is stale\n  // updatedLink: boolean;\n}\n\nexport function createState(): RelationshipState {\n  return {\n    hasReceivedData: false,\n    isEmpty: true,\n    isStale: false,\n    hasFailedLoadAttempt: false,\n    shouldForceReload: false,\n    hasDematerializedInverse: false,\n  };\n}\n","import type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { CollectionRelationship } from '@warp-drive/core-types/cache/relationship';\nimport type { Links, Meta, PaginationLinks } from '@warp-drive/core-types/spec/raw';\n\nimport { computeLocalState } from '../-diff';\nimport type { UpgradedMeta } from '../-edge-definition';\nimport type { RelationshipState } from '../-state';\nimport { createState } from '../-state';\n\nexport interface CollectionEdge {\n  definition: UpgradedMeta;\n  identifier: StableRecordIdentifier;\n  state: RelationshipState;\n\n  remoteMembers: Set<StableRecordIdentifier>;\n  remoteState: StableRecordIdentifier[];\n\n  additions: Set<StableRecordIdentifier> | null;\n  removals: Set<StableRecordIdentifier> | null;\n\n  meta: Meta | null;\n  links: Links | PaginationLinks | null;\n\n  localState: StableRecordIdentifier[] | null;\n  isDirty: boolean;\n  transactionRef: number;\n\n  _diff?: {\n    add: Set<StableRecordIdentifier>;\n    del: Set<StableRecordIdentifier>;\n  };\n}\n\nexport function createCollectionEdge(definition: UpgradedMeta, identifier: StableRecordIdentifier): CollectionEdge {\n  return {\n    definition,\n    identifier,\n    state: createState(),\n    remoteMembers: new Set(),\n    remoteState: [],\n    additions: null,\n    removals: null,\n\n    meta: null,\n    links: null,\n\n    localState: null,\n    isDirty: true,\n    transactionRef: 0,\n    _diff: undefined,\n  };\n}\n\nexport function legacyGetCollectionRelationshipData(source: CollectionEdge): CollectionRelationship {\n  const payload: CollectionRelationship = {};\n\n  if (source.state.hasReceivedData) {\n    payload.data = computeLocalState(source);\n  }\n\n  if (source.links) {\n    payload.links = source.links;\n  }\n\n  if (source.meta) {\n    payload.meta = source.meta;\n  }\n\n  return payload;\n}\n","import type { StableRecordIdentifier } from '@warp-drive/core-types';\n\nimport type { UpgradedMeta } from '../-edge-definition';\n\nexport type ImplicitMeta = UpgradedMeta & { kind: 'implicit'; isImplicit: true };\n\nexport interface ImplicitEdge {\n  definition: ImplicitMeta;\n  identifier: StableRecordIdentifier;\n  localMembers: Set<StableRecordIdentifier>;\n  remoteMembers: Set<StableRecordIdentifier>;\n}\n\nexport function createImplicitEdge(definition: ImplicitMeta, identifier: StableRecordIdentifier): ImplicitEdge {\n  return {\n    definition,\n    identifier,\n    localMembers: new Set(),\n    remoteMembers: new Set(),\n  };\n}\n","import type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { ResourceRelationship } from '@warp-drive/core-types/cache/relationship';\nimport type { Links, Meta, PaginationLinks } from '@warp-drive/core-types/spec/raw';\n\nimport type { UpgradedMeta } from '../-edge-definition';\nimport type { RelationshipState } from '../-state';\nimport { createState } from '../-state';\n\n/*\n * @module @ember-data/graph\n *\n * Stores the data for one side of a \"single\" resource relationship.\n *\n * @class ResourceEdge\n * @internal\n */\nexport interface ResourceEdge {\n  definition: UpgradedMeta;\n  identifier: StableRecordIdentifier;\n  state: RelationshipState;\n  localState: StableRecordIdentifier | null;\n  remoteState: StableRecordIdentifier | null;\n  meta: Meta | null;\n  links: Links | PaginationLinks | null;\n  transactionRef: number;\n}\n\nexport function createResourceEdge(definition: UpgradedMeta, identifier: StableRecordIdentifier): ResourceEdge {\n  return {\n    definition,\n    identifier,\n    state: createState(),\n    transactionRef: 0,\n    localState: null,\n    remoteState: null,\n    meta: null,\n    links: null,\n  };\n}\n\nexport function legacyGetResourceRelationshipData(source: ResourceEdge): ResourceRelationship {\n  let data: StableRecordIdentifier | null | undefined;\n  const payload: ResourceRelationship = {};\n  if (source.localState) {\n    data = source.localState;\n  }\n  if (source.localState === null && source.state.hasReceivedData) {\n    data = null;\n  }\n  if (source.links) {\n    payload.links = source.links;\n  }\n  if (data !== undefined) {\n    payload.data = data;\n  }\n  if (source.meta) {\n    payload.meta = source.meta;\n  }\n\n  return payload;\n}\n","import { assert } from '@ember/debug';\n\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { AddToRelatedRecordsOperation } from '@warp-drive/core-types/graph';\n\nimport { _addLocal } from '../-diff';\nimport { isHasMany, notifyChange } from '../-utils';\nimport type { CollectionEdge } from '../edges/collection';\nimport type { Graph } from '../graph';\nimport { addToInverse } from './replace-related-records';\n\nexport default function addToRelatedRecords(graph: Graph, op: AddToRelatedRecordsOperation, isRemote: false) {\n  assert(\n    `Graph does not yet support updating the remote state of a relationship via the ${op.op} operation`,\n    !isRemote\n  );\n  const { record, value, index } = op;\n  const relationship = graph.get(record, op.field);\n  assert(\n    `You can only '${op.op}' on a hasMany relationship. ${record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isHasMany(relationship)\n  );\n  if (Array.isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      addRelatedRecord(graph, relationship, record, value[i], index !== undefined ? index + i : index, isRemote);\n    }\n  } else {\n    addRelatedRecord(graph, relationship, record, value, index, isRemote);\n  }\n\n  notifyChange(graph, relationship.identifier, relationship.definition.key);\n}\n\nfunction addRelatedRecord(\n  graph: Graph,\n  relationship: CollectionEdge,\n  record: StableRecordIdentifier,\n  value: StableRecordIdentifier,\n  index: number | undefined,\n  isRemote: false\n) {\n  assert(`expected an identifier to add to the collection relationship`, value);\n\n  if (_addLocal(graph, record, relationship, value, index ?? null)) {\n    addToInverse(graph, value, relationship.definition.inverseKey, record, isRemote);\n  }\n}\n","import type { MergeOperation } from '@ember-data/store/-types/q/cache';\n\nimport { forAllRelatedIdentifiers, isBelongsTo, isHasMany, notifyChange } from '../-utils';\nimport type { CollectionEdge } from '../edges/collection';\nimport type { ImplicitEdge } from '../edges/implicit';\nimport type { ResourceEdge } from '../edges/resource';\nimport type { Graph, GraphEdge } from '../graph';\n\nexport function mergeIdentifier(graph: Graph, op: MergeOperation, relationships: Record<string, GraphEdge>) {\n  Object.keys(relationships).forEach((key) => {\n    const rel = relationships[key];\n    if (!rel) {\n      return;\n    }\n    mergeIdentifierForRelationship(graph, op, rel);\n  });\n}\n\nfunction mergeIdentifierForRelationship(graph: Graph, op: MergeOperation, rel: GraphEdge): void {\n  rel.identifier = op.value;\n  forAllRelatedIdentifiers(rel, (identifier) => {\n    const inverse = graph.get(identifier, rel.definition.inverseKey);\n    mergeInRelationship(graph, inverse, op);\n  });\n}\n\nfunction mergeInRelationship(graph: Graph, rel: GraphEdge, op: MergeOperation): void {\n  if (isBelongsTo(rel)) {\n    mergeBelongsTo(graph, rel, op);\n  } else if (isHasMany(rel)) {\n    mergeHasMany(graph, rel, op);\n  } else {\n    mergeImplicit(graph, rel, op);\n  }\n}\n\nfunction mergeBelongsTo(graph: Graph, rel: ResourceEdge, op: MergeOperation): void {\n  if (rel.remoteState === op.record) {\n    rel.remoteState = op.value;\n  }\n  if (rel.localState === op.record) {\n    rel.localState = op.record;\n    notifyChange(graph, rel.identifier, rel.definition.key);\n  }\n}\n\nfunction mergeHasMany(graph: Graph, rel: CollectionEdge, op: MergeOperation): void {\n  if (rel.remoteMembers.has(op.record)) {\n    rel.remoteMembers.delete(op.record);\n    rel.remoteMembers.add(op.value);\n    const index = rel.remoteState.indexOf(op.record);\n    rel.remoteState.splice(index, 1, op.value);\n    rel.isDirty = true;\n  }\n  if (rel.additions?.has(op.record)) {\n    rel.additions.delete(op.record);\n    rel.additions.add(op.value);\n    rel.isDirty = true;\n  }\n  if (rel.removals?.has(op.record)) {\n    rel.removals.delete(op.record);\n    rel.removals.add(op.value);\n    rel.isDirty = true;\n  }\n  if (rel.isDirty) {\n    notifyChange(graph, rel.identifier, rel.definition.key);\n  }\n}\n\nfunction mergeImplicit(graph: Graph, rel: ImplicitEdge, op: MergeOperation): void {\n  if (rel.remoteMembers.has(op.record)) {\n    rel.remoteMembers.delete(op.record);\n    rel.remoteMembers.add(op.value);\n  }\n  if (rel.localMembers.has(op.record)) {\n    rel.localMembers.delete(op.record);\n    rel.localMembers.add(op.value);\n  }\n}\n","import { assert } from '@ember/debug';\n\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { RemoveFromRelatedRecordsOperation } from '@warp-drive/core-types/graph';\n\nimport { _removeLocal } from '../-diff';\nimport { isHasMany, notifyChange } from '../-utils';\nimport type { CollectionEdge } from '../edges/collection';\nimport type { Graph } from '../graph';\nimport { removeFromInverse } from './replace-related-records';\n\nexport default function removeFromRelatedRecords(graph: Graph, op: RemoveFromRelatedRecordsOperation, isRemote: false) {\n  assert(\n    `Graph does not yet support updating the remote state of a relationship via the ${op.op} operation`,\n    !isRemote\n  );\n  const { record, value } = op;\n  const relationship = graph.get(record, op.field);\n  assert(\n    `You can only '${op.op}' on a hasMany relationship. ${record.type}.${op.field} is a ${relationship.definition.kind}`,\n    isHasMany(relationship)\n  );\n  // TODO we should potentially thread the index information through here\n  // when available as it may make it faster to remove from the local state\n  // when trying to patch more efficiently without blowing away the entire\n  // local state array\n  if (Array.isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      removeRelatedRecord(graph, relationship, record, value[i], isRemote);\n    }\n  } else {\n    removeRelatedRecord(graph, relationship, record, value, isRemote);\n  }\n  notifyChange(graph, relationship.identifier, relationship.definition.key);\n}\n\nfunction removeRelatedRecord(\n  graph: Graph,\n  relationship: CollectionEdge,\n  record: StableRecordIdentifier,\n  value: StableRecordIdentifier,\n  isRemote: false\n) {\n  assert(`expected an identifier to remove from the collection relationship`, value);\n  if (_removeLocal(relationship, value)) {\n    removeFromInverse(graph, value, relationship.definition.inverseKey, record, isRemote);\n  }\n}\n","import type { Link, LinkObject } from '@warp-drive/core-types/spec/raw';\n\n/*\n  This method normalizes a link to an \"links object\". If the passed link is\n  already an object it's returned without any modifications.\n\n  See http://jsonapi.org/format/#document-links for more information.\n*/\nexport default function _normalizeLink(link: Link): LinkObject | null {\n  switch (typeof link) {\n    case 'object':\n      return link;\n    case 'string':\n      return { href: link };\n  }\n}\n","import { assert, warn } from '@ember/debug';\n\nimport type { IdentifierCache } from '@ember-data/store/-private/caches/identifier-cache';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { UpdateRelationshipOperation } from '@warp-drive/core-types/graph';\nimport type { ExistingResourceIdentifierObject, NewResourceIdentifierObject } from '@warp-drive/core-types/spec/raw';\n\nimport { isBelongsTo, isHasMany, notifyChange } from '../-utils';\nimport type { Graph } from '../graph';\nimport _normalizeLink from '../normalize-link';\n\n/*\n    Updates the \"canonical\" or \"remote\" state of a relationship, replacing any existing\n    state and blowing away any local changes (excepting new records).\n*/\nexport default function updateRelationshipOperation(graph: Graph, op: UpdateRelationshipOperation) {\n  const relationship = graph.get(op.record, op.field);\n  assert(`Cannot update an implicit relationship`, isHasMany(relationship) || isBelongsTo(relationship));\n  const { definition, state, identifier } = relationship;\n  const { isCollection } = definition;\n\n  const payload = op.value;\n\n  let hasRelationshipDataProperty = false;\n  let hasUpdatedLink = false;\n\n  if (payload.meta) {\n    relationship.meta = payload.meta;\n  }\n\n  if (payload.data !== undefined) {\n    hasRelationshipDataProperty = true;\n    if (isCollection) {\n      // TODO deprecate this case. We\n      // have tests saying we support it.\n      if (payload.data === null) {\n        payload.data = [];\n      }\n      assert(`Expected an array`, Array.isArray(payload.data));\n      const cache = graph.store.identifierCache;\n      graph.update(\n        {\n          op: 'replaceRelatedRecords',\n          record: identifier,\n          field: op.field,\n          value: upgradeIdentifiers(payload.data, cache),\n        },\n        true\n      );\n    } else {\n      graph.update(\n        {\n          op: 'replaceRelatedRecord',\n          record: identifier,\n          field: op.field,\n          value: payload.data\n            ? graph.store.identifierCache.upgradeIdentifier(payload.data as ExistingResourceIdentifierObject)\n            : null,\n        },\n        true\n      );\n    }\n  } else if (definition.isAsync === false && !state.hasReceivedData) {\n    hasRelationshipDataProperty = true;\n\n    if (isCollection) {\n      graph.update(\n        {\n          op: 'replaceRelatedRecords',\n          record: identifier,\n          field: op.field,\n          value: [],\n        },\n        true\n      );\n    } else {\n      graph.update(\n        {\n          op: 'replaceRelatedRecord',\n          record: identifier,\n          field: op.field,\n          value: null,\n        },\n        true\n      );\n    }\n  }\n\n  if (payload.links) {\n    const originalLinks = relationship.links;\n    relationship.links = payload.links;\n    if (payload.links.related) {\n      const relatedLink = _normalizeLink(payload.links.related);\n      const currentLink = originalLinks && originalLinks.related ? _normalizeLink(originalLinks.related) : null;\n      const currentLinkHref = currentLink ? currentLink.href : null;\n\n      if (relatedLink && relatedLink.href && relatedLink.href !== currentLinkHref) {\n        warn(\n          `You pushed a record of type '${identifier.type}' with a relationship '${definition.key}' configured as 'async: false'. You've included a link but no primary data, this may be an error in your payload. EmberData will treat this relationship as known-to-be-empty.`,\n          definition.isAsync || state.hasReceivedData,\n          {\n            id: 'ds.store.push-link-for-sync-relationship',\n          }\n        );\n        assert(\n          `You have pushed a record of type '${identifier.type}' with '${definition.key}' as a link, but the value of that link is not a string.`,\n          typeof relatedLink.href === 'string' || relatedLink.href === null\n        );\n        hasUpdatedLink = true;\n      }\n    }\n  }\n\n  /*\n       Data being pushed into the relationship might contain only data or links,\n       or a combination of both.\n\n       IF contains only data\n       IF contains both links and data\n        state.isEmpty -> true if is empty array (has-many) or is null (belongs-to)\n        state.hasReceivedData -> true\n        hasDematerializedInverse -> false\n        state.isStale -> false\n        allInverseRecordsAreLoaded -> run-check-to-determine\n\n       IF contains only links\n        state.isStale -> true\n       */\n  relationship.state.hasFailedLoadAttempt = false;\n  if (hasRelationshipDataProperty) {\n    const relationshipIsEmpty = payload.data === null || (Array.isArray(payload.data) && payload.data.length === 0);\n\n    // we don't need to notify here as the update op we pushed in above will notify once\n    // membership is in the correct state.\n    relationship.state.hasReceivedData = true;\n    relationship.state.isStale = false;\n    relationship.state.hasDematerializedInverse = false;\n    relationship.state.isEmpty = relationshipIsEmpty;\n  } else if (hasUpdatedLink) {\n    // only notify stale if we have not previously received membership data.\n    // within this same transaction\n    // this prevents refetching when only one side of the relationship in the\n    // payload contains the info while the other side contains just a link\n    // this only works when the side with just a link is a belongsTo, as we\n    // don't know if a hasMany has full information or not.\n    // see #7049 for context.\n    if (\n      isCollection ||\n      !relationship.state.hasReceivedData ||\n      isStaleTransaction(relationship.transactionRef, graph._transaction)\n    ) {\n      relationship.state.isStale = true;\n\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    } else {\n      relationship.state.isStale = false;\n    }\n  }\n}\n\nfunction isStaleTransaction(relationshipTransactionId: number, graphTransactionId: number | null) {\n  return (\n    relationshipTransactionId === 0 || // relationship has never notified\n    graphTransactionId === null || // we are not in a transaction\n    relationshipTransactionId < graphTransactionId // we are not part of the current transaction\n  );\n}\n\nexport function upgradeIdentifiers(\n  arr: (ExistingResourceIdentifierObject | NewResourceIdentifierObject | StableRecordIdentifier)[],\n  cache: IdentifierCache\n): StableRecordIdentifier[] {\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = cache.upgradeIdentifier(arr[i]);\n  }\n  return arr as StableRecordIdentifier[];\n}\n","import { assert } from '@ember/debug';\n\nimport { LOG_GRAPH } from '@ember-data/debugging';\nimport { DEBUG } from '@ember-data/env';\nimport type { MergeOperation } from '@ember-data/store/-types/q/cache';\nimport type { CacheCapabilitiesManager } from '@ember-data/store/-types/q/cache-store-wrapper';\nimport type { StableRecordIdentifier } from '@warp-drive/core-types';\nimport type { RelationshipDiff } from '@warp-drive/core-types/cache';\nimport type { CollectionRelationship, ResourceRelationship } from '@warp-drive/core-types/cache/relationship';\nimport type {\n  DeleteRecordOperation,\n  LocalRelationshipOperation,\n  RemoteRelationshipOperation,\n  UnknownOperation,\n} from '@warp-drive/core-types/graph';\n\nimport { rollbackRelationship } from './-diff';\nimport type { EdgeCache, UpgradedMeta } from './-edge-definition';\nimport { isLHS, upgradeDefinition } from './-edge-definition';\nimport {\n  assertValidRelationshipPayload,\n  forAllRelatedIdentifiers,\n  getStore,\n  isBelongsTo,\n  isHasMany,\n  isImplicit,\n  isNew,\n  notifyChange,\n  removeIdentifierCompletelyFromRelationship,\n} from './-utils';\nimport { type CollectionEdge, createCollectionEdge, legacyGetCollectionRelationshipData } from './edges/collection';\nimport type { ImplicitEdge, ImplicitMeta } from './edges/implicit';\nimport { createImplicitEdge } from './edges/implicit';\nimport { createResourceEdge, legacyGetResourceRelationshipData, type ResourceEdge } from './edges/resource';\nimport addToRelatedRecords from './operations/add-to-related-records';\nimport { mergeIdentifier } from './operations/merge-identifier';\nimport removeFromRelatedRecords from './operations/remove-from-related-records';\nimport replaceRelatedRecord from './operations/replace-related-record';\nimport replaceRelatedRecords from './operations/replace-related-records';\nimport updateRelationshipOperation from './operations/update-relationship';\n\nexport type GraphEdge = ImplicitEdge | CollectionEdge | ResourceEdge;\n\nexport const Graphs = new Map<CacheCapabilitiesManager, Graph>();\n\nlet transactionRef = 0;\ntype PendingOps = {\n  belongsTo?: Map<string, Map<string, RemoteRelationshipOperation[]>>;\n  hasMany?: Map<string, Map<string, RemoteRelationshipOperation[]>>;\n  deletions: DeleteRecordOperation[];\n};\n\n/*\n * Graph acts as the cache for relationship data. It allows for\n * us to ask about and update relationships for a given Identifier\n * without requiring other objects for that Identifier to be\n * instantiated (such as `RecordData` or a `Record`)\n *\n * This also allows for us to make more substantive changes to relationships\n * with increasingly minor alterations to other portions of the internals\n * over time.\n *\n * The graph is made up of nodes and edges. Each unique identifier gets\n * its own node, which is a dictionary with a list of that node's edges\n * (or connections) to other nodes. In `Model` terms, a node represents a\n * record instance, with each key (an edge) in the dictionary correlating\n * to either a `hasMany` or `belongsTo` field on that record instance.\n *\n * The value for each key, or `edge` is the identifier(s) the node relates\n * to in the graph from that key.\n */\nexport class Graph {\n  declare _definitionCache: EdgeCache;\n  declare _metaCache: Record<string, Record<string, UpgradedMeta>>;\n  declare _potentialPolymorphicTypes: Record<string, Record<string, boolean>>;\n  declare identifiers: Map<StableRecordIdentifier, Record<string, GraphEdge>>;\n  declare store: CacheCapabilitiesManager;\n  declare isDestroyed: boolean;\n  declare _willSyncRemote: boolean;\n  declare _willSyncLocal: boolean;\n  declare silenceNotifications: boolean;\n  declare _pushedUpdates: PendingOps;\n  declare _updatedRelationships: Set<CollectionEdge>;\n  declare _transaction: number | null;\n  declare _removing: StableRecordIdentifier | null;\n\n  constructor(store: CacheCapabilitiesManager) {\n    this._definitionCache = Object.create(null) as EdgeCache;\n    this._metaCache = Object.create(null) as Record<string, Record<string, UpgradedMeta>>;\n    this._potentialPolymorphicTypes = Object.create(null) as Record<string, Record<string, boolean>>;\n    this.identifiers = new Map();\n    this.store = store;\n    this.isDestroyed = false;\n    this._willSyncRemote = false;\n    this._willSyncLocal = false;\n    this._pushedUpdates = {\n      belongsTo: undefined,\n      hasMany: undefined,\n      deletions: [],\n    };\n    this._updatedRelationships = new Set();\n    this._transaction = null;\n    this._removing = null;\n    this.silenceNotifications = false;\n  }\n\n  has(identifier: StableRecordIdentifier, propertyName: string): boolean {\n    const relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      return false;\n    }\n    return relationships[propertyName] !== undefined;\n  }\n\n  getDefinition(identifier: StableRecordIdentifier, propertyName: string): UpgradedMeta {\n    let defs = this._metaCache[identifier.type];\n    let meta: UpgradedMeta | null | undefined = defs?.[propertyName];\n    if (!meta) {\n      const info = /*#__NOINLINE__*/ upgradeDefinition(this, identifier, propertyName);\n      assert(`Could not determine relationship information for ${identifier.type}.${propertyName}`, info !== null);\n\n      // if (info.rhs_definition?.kind === 'implicit') {\n      // we should possibly also do this\n      // but it would result in being extremely permissive for other relationships by accident\n      // this.registerPolymorphicType(info.rhs_baseModelName, identifier.type);\n      // }\n\n      meta = /*#__NOINLINE__*/ isLHS(info, identifier.type, propertyName) ? info.lhs_definition : info.rhs_definition!;\n      defs = this._metaCache[identifier.type] = defs || {};\n      defs[propertyName] = meta;\n    }\n    return meta;\n  }\n\n  get(identifier: StableRecordIdentifier, propertyName: string): GraphEdge {\n    assert(`expected propertyName`, propertyName);\n    let relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      relationships = Object.create(null) as Record<string, GraphEdge>;\n      this.identifiers.set(identifier, relationships);\n    }\n\n    let relationship = relationships[propertyName];\n    if (!relationship) {\n      const meta = this.getDefinition(identifier, propertyName);\n\n      if (meta.kind === 'belongsTo') {\n        relationship = relationships[propertyName] = createResourceEdge(meta, identifier);\n      } else if (meta.kind === 'hasMany') {\n        relationship = relationships[propertyName] = createCollectionEdge(meta, identifier);\n      } else {\n        assert(`Expected kind to be implicit`, meta.kind === 'implicit' && meta.isImplicit === true);\n        relationship = relationships[propertyName] = createImplicitEdge(meta as ImplicitMeta, identifier);\n      }\n    }\n\n    return relationship;\n  }\n\n  getData(identifier: StableRecordIdentifier, propertyName: string): ResourceRelationship | CollectionRelationship {\n    const relationship = this.get(identifier, propertyName);\n\n    assert(`Cannot getData() on an implicit relationship`, !isImplicit(relationship));\n\n    if (isBelongsTo(relationship)) {\n      return legacyGetResourceRelationshipData(relationship);\n    }\n\n    return legacyGetCollectionRelationshipData(relationship);\n  }\n\n  /*\n   * Allows for the graph to dynamically discover polymorphic connections\n   * without needing to walk prototype chains.\n   *\n   * Used by edges when an added `type` does not match the expected `type`\n   * for that edge.\n   *\n   * Currently we assert before calling this. For a public API we will want\n   * to call out to the schema manager to ask if we should consider these\n   * types as equivalent for a given relationship.\n   */\n  registerPolymorphicType(type1: string, type2: string): void {\n    const typeCache = this._potentialPolymorphicTypes;\n    let t1 = typeCache[type1];\n    if (!t1) {\n      t1 = typeCache[type1] = Object.create(null) as Record<string, boolean>;\n    }\n    t1[type2] = true;\n\n    let t2 = typeCache[type2];\n    if (!t2) {\n      t2 = typeCache[type2] = Object.create(null) as Record<string, boolean>;\n    }\n    t2[type1] = true;\n  }\n\n  /*\n   TODO move this comment somewhere else\n   implicit relationships are relationships which have not been declared but the inverse side exists on\n   another record somewhere\n\n   For example if there was:\n\n   ```app/models/comment.js\n   import Model, { attr } from '@ember-data/model';\n\n   export default class Comment extends Model {\n     @attr text;\n   }\n   ```\n\n   and there is also:\n\n   ```app/models/post.js\n   import Model, { attr, hasMany } from '@ember-data/model';\n\n   export default class Post extends Model {\n     @attr title;\n     @hasMany('comment', { async: true, inverse: null }) comments;\n   }\n   ```\n\n   Then we would have a implicit 'post' relationship for the comment record in order\n   to be do things like remove the comment from the post if the comment were to be deleted.\n  */\n\n  isReleasable(identifier: StableRecordIdentifier): boolean {\n    const relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      if (LOG_GRAPH) {\n        // eslint-disable-next-line no-console\n        console.log(`graph: RELEASABLE ${String(identifier)}`);\n      }\n      return true;\n    }\n    const keys = Object.keys(relationships);\n    for (let i = 0; i < keys.length; i++) {\n      const relationship: GraphEdge = relationships[keys[i]];\n      // account for previously unloaded relationships\n      // typically from a prior deletion of a record that pointed to this one implicitly\n      if (relationship === undefined) {\n        continue;\n      }\n      assert(`Expected a relationship`, relationship);\n      if (relationship.definition.inverseIsAsync && !isNew(identifier)) {\n        if (LOG_GRAPH) {\n          // eslint-disable-next-line no-console\n          console.log(`graph: <<NOT>> RELEASABLE ${String(identifier)}`);\n        }\n        return false;\n      }\n    }\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: RELEASABLE ${String(identifier)}`);\n    }\n    return true;\n  }\n\n  unload(identifier: StableRecordIdentifier, silenceNotifications?: boolean) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: unload ${String(identifier)}`);\n    }\n    const relationships = this.identifiers.get(identifier);\n\n    if (relationships) {\n      // cleans up the graph but retains some nodes\n      // to allow for rematerialization\n      Object.keys(relationships).forEach((key) => {\n        const rel = relationships[key]!;\n        if (!rel) {\n          return;\n        }\n        /*#__NOINLINE__*/ destroyRelationship(this, rel, silenceNotifications);\n        if (/*#__NOINLINE__*/ isImplicit(rel)) {\n          // @ts-expect-error\n          relationships[key] = undefined;\n        }\n      });\n    }\n  }\n\n  _isDirty(identifier: StableRecordIdentifier, field: string): boolean {\n    const relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      return false;\n    }\n    const relationship = relationships[field];\n    if (!relationship) {\n      return false;\n    }\n    if (isBelongsTo(relationship)) {\n      return relationship.localState !== relationship.remoteState;\n    } else if (isHasMany(relationship)) {\n      const hasAdditions = relationship.additions !== null && relationship.additions.size > 0;\n      const hasRemovals = relationship.removals !== null && relationship.removals.size > 0;\n      return hasAdditions || hasRemovals || isReordered(relationship);\n    }\n    return false;\n  }\n\n  getChanged(identifier: StableRecordIdentifier): Map<string, RelationshipDiff> {\n    const relationships = this.identifiers.get(identifier);\n    const changed = new Map<string, RelationshipDiff>();\n\n    if (!relationships) {\n      return changed;\n    }\n\n    const keys = Object.keys(relationships);\n    for (let i = 0; i < keys.length; i++) {\n      const field = keys[i];\n      const relationship = relationships[field];\n      if (!relationship) {\n        continue;\n      }\n      if (isBelongsTo(relationship)) {\n        if (relationship.localState !== relationship.remoteState) {\n          changed.set(field, {\n            kind: 'resource',\n            remoteState: relationship.remoteState,\n            localState: relationship.localState,\n          });\n        }\n      } else if (isHasMany(relationship)) {\n        const hasAdditions = relationship.additions !== null && relationship.additions.size > 0;\n        const hasRemovals = relationship.removals !== null && relationship.removals.size > 0;\n        const reordered = isReordered(relationship);\n\n        if (hasAdditions || hasRemovals || reordered) {\n          changed.set(field, {\n            kind: 'collection',\n            additions: new Set(relationship.additions) || new Set(),\n            removals: new Set(relationship.removals) || new Set(),\n            remoteState: relationship.remoteState,\n            localState: legacyGetCollectionRelationshipData(relationship).data || [],\n            reordered,\n          });\n        }\n      }\n    }\n\n    return changed;\n  }\n\n  hasChanged(identifier: StableRecordIdentifier): boolean {\n    const relationships = this.identifiers.get(identifier);\n    if (!relationships) {\n      return false;\n    }\n    const keys = Object.keys(relationships);\n    for (let i = 0; i < keys.length; i++) {\n      if (this._isDirty(identifier, keys[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  rollback(identifier: StableRecordIdentifier): string[] {\n    const relationships = this.identifiers.get(identifier);\n    const changed: string[] = [];\n    if (!relationships) {\n      return changed;\n    }\n    const keys = Object.keys(relationships);\n    for (let i = 0; i < keys.length; i++) {\n      const field = keys[i];\n      const relationship = relationships[field];\n      if (!relationship) {\n        continue;\n      }\n\n      if (this._isDirty(identifier, field)) {\n        rollbackRelationship(this, identifier, field, relationship as CollectionEdge | ResourceEdge);\n        changed.push(field);\n      }\n    }\n\n    return changed;\n  }\n\n  remove(identifier: StableRecordIdentifier) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: remove ${String(identifier)}`);\n    }\n    assert(`Cannot remove ${String(identifier)} while still removing ${String(this._removing)}`, !this._removing);\n    this._removing = identifier;\n    this.unload(identifier);\n    this.identifiers.delete(identifier);\n    this._removing = null;\n  }\n\n  /*\n   * Remote state changes\n   */\n  push(op: RemoteRelationshipOperation) {\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: push ${String(op.record)}`, op);\n    }\n    if (op.op === 'deleteRecord') {\n      this._pushedUpdates.deletions.push(op);\n    } else {\n      const definition = this.getDefinition(op.record, op.field);\n      assert(`Cannot push a remote update for an implicit relationship`, definition.kind !== 'implicit');\n      addPending(this._pushedUpdates, definition, op);\n    }\n    if (!this._willSyncRemote) {\n      this._willSyncRemote = true;\n      getStore(this.store)._schedule('coalesce', () => this._flushRemoteQueue());\n    }\n  }\n\n  /*\n   * Local state changes\n   */\n  update(op: RemoteRelationshipOperation | MergeOperation, isRemote: true): void;\n  update(op: LocalRelationshipOperation, isRemote?: false): void;\n  update(\n    op: MergeOperation | LocalRelationshipOperation | RemoteRelationshipOperation | UnknownOperation,\n    isRemote = false\n  ): void {\n    assert(\n      `Cannot update an implicit relationship`,\n      op.op === 'deleteRecord' || op.op === 'mergeIdentifiers' || !isImplicit(this.get(op.record, op.field))\n    );\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`graph: update (${isRemote ? 'remote' : 'local'}) ${String(op.record)}`, op);\n    }\n\n    switch (op.op) {\n      case 'mergeIdentifiers': {\n        const relationships = this.identifiers.get(op.record);\n        if (relationships) {\n          /*#__NOINLINE__*/ mergeIdentifier(this, op, relationships);\n        }\n        break;\n      }\n      case 'updateRelationship':\n        assert(`Can only perform the operation updateRelationship on remote state`, isRemote);\n        if (DEBUG) {\n          // in debug, assert payload validity eagerly\n          // TODO add deprecations/assertion here for duplicates\n          assertValidRelationshipPayload(this, op);\n        }\n        /*#__NOINLINE__*/ updateRelationshipOperation(this, op);\n        break;\n      case 'deleteRecord': {\n        assert(`Can only perform the operation deleteRelationship on remote state`, isRemote);\n        const identifier = op.record;\n        const relationships = this.identifiers.get(identifier);\n\n        if (relationships) {\n          Object.keys(relationships).forEach((key) => {\n            const rel = relationships[key];\n            if (!rel) {\n              return;\n            }\n            // works together with the has check\n            // @ts-expect-error\n            relationships[key] = undefined;\n            /*#__NOINLINE__*/ removeCompletelyFromInverse(this, rel);\n          });\n          this.identifiers.delete(identifier);\n        }\n        break;\n      }\n      case 'replaceRelatedRecord':\n        /*#__NOINLINE__*/ replaceRelatedRecord(this, op, isRemote);\n        break;\n      case 'addToRelatedRecords':\n        // we will lift this restriction once the cache is allowed to make remote updates directly\n        assert(`Can only perform the operation addToRelatedRecords on local state`, !isRemote);\n        /*#__NOINLINE__*/ addToRelatedRecords(this, op, isRemote);\n        break;\n      case 'removeFromRelatedRecords':\n        // we will lift this restriction once the cache is allowed to make remote updates directly\n        assert(`Can only perform the operation removeFromRelatedRecords on local state`, !isRemote);\n        /*#__NOINLINE__*/ removeFromRelatedRecords(this, op, isRemote);\n        break;\n      case 'replaceRelatedRecords':\n        /*#__NOINLINE__*/ replaceRelatedRecords(this, op, isRemote);\n        break;\n      default:\n        assert(`No local relationship update operation exists for '${op.op}'`);\n    }\n  }\n\n  _scheduleLocalSync(relationship: CollectionEdge) {\n    this._updatedRelationships.add(relationship);\n    if (!this._willSyncLocal) {\n      this._willSyncLocal = true;\n      getStore(this.store)._schedule('sync', () => this._flushLocalQueue());\n    }\n  }\n\n  _flushRemoteQueue() {\n    if (!this._willSyncRemote) {\n      return;\n    }\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.groupCollapsed(`Graph: Initialized Transaction`);\n    }\n    this._transaction = ++transactionRef;\n    this._willSyncRemote = false;\n    const updates = this._pushedUpdates;\n    const { deletions, hasMany, belongsTo } = updates;\n    updates.deletions = [];\n    updates.hasMany = undefined;\n    updates.belongsTo = undefined;\n\n    for (let i = 0; i < deletions.length; i++) {\n      this.update(deletions[i], true);\n    }\n\n    if (hasMany) {\n      flushPending(this, hasMany);\n    }\n    if (belongsTo) {\n      flushPending(this, belongsTo);\n    }\n\n    this._transaction = null;\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`Graph: transaction finalized`);\n      // eslint-disable-next-line no-console\n      console.groupEnd();\n    }\n  }\n\n  _addToTransaction(relationship: CollectionEdge | ResourceEdge) {\n    assert(`expected a transaction`, this._transaction !== null);\n    if (LOG_GRAPH) {\n      // eslint-disable-next-line no-console\n      console.log(`Graph: ${String(relationship.identifier)} ${relationship.definition.key} added to transaction`);\n    }\n    relationship.transactionRef = this._transaction;\n  }\n\n  _flushLocalQueue() {\n    if (!this._willSyncLocal) {\n      return;\n    }\n\n    if (this.silenceNotifications) {\n      this.silenceNotifications = false;\n      this._updatedRelationships = new Set();\n      return;\n    }\n\n    this._willSyncLocal = false;\n    const updated = this._updatedRelationships;\n    this._updatedRelationships = new Set();\n    updated.forEach((rel) => notifyChange(this, rel.identifier, rel.definition.key));\n  }\n\n  destroy() {\n    Graphs.delete(this.store);\n\n    if (DEBUG) {\n      Graphs.delete(getStore(this.store) as unknown as CacheCapabilitiesManager);\n      if (Graphs.size) {\n        Graphs.forEach((_, key) => {\n          assert(\n            `Memory Leak Detected, likely the test or app instance previous to this was not torn down properly`,\n            // @ts-expect-error\n            !key.isDestroyed && !key.isDestroying\n          );\n        });\n      }\n    }\n\n    this.identifiers.clear();\n    this.store = null as unknown as CacheCapabilitiesManager;\n    this.isDestroyed = true;\n  }\n}\n\nfunction flushPending(graph: Graph, ops: Map<string, Map<string, RemoteRelationshipOperation[]>>) {\n  ops.forEach((type) => {\n    type.forEach((opList) => {\n      flushPendingList(graph, opList);\n    });\n  });\n}\nfunction flushPendingList(graph: Graph, opList: RemoteRelationshipOperation[]) {\n  for (let i = 0; i < opList.length; i++) {\n    graph.update(opList[i], true);\n  }\n}\n\n// Handle dematerialization for relationship `rel`.  In all cases, notify the\n// relationship of the dematerialization: this is done so the relationship can\n// notify its inverse which needs to update state\n//\n// If the inverse is sync, unloading this record is treated as a client-side\n// delete, so we remove the inverse records from this relationship to\n// disconnect the graph.  Because it's not async, we don't need to keep around\n// the identifier as an id-wrapper for references\nfunction destroyRelationship(graph: Graph, rel: GraphEdge, silenceNotifications?: boolean) {\n  if (isImplicit(rel)) {\n    if (graph.isReleasable(rel.identifier)) {\n      /*#__NOINLINE__*/ removeCompletelyFromInverse(graph, rel);\n    }\n    return;\n  }\n\n  const { identifier } = rel;\n  const { inverseKey } = rel.definition;\n\n  if (!rel.definition.inverseIsImplicit) {\n    /*#__NOINLINE__*/ forAllRelatedIdentifiers(rel, (inverseIdentifer: StableRecordIdentifier) =>\n      /*#__NOINLINE__*/ notifyInverseOfDematerialization(\n        graph,\n        inverseIdentifer,\n        inverseKey,\n        identifier,\n        silenceNotifications\n      )\n    );\n  }\n\n  if (!rel.definition.inverseIsImplicit && !rel.definition.inverseIsAsync) {\n    rel.state.isStale = true;\n    /*#__NOINLINE__*/ clearRelationship(rel);\n\n    // necessary to clear relationships in the ui from dematerialized records\n    // hasMany is managed by Model which calls `retreiveLatest` after\n    // dematerializing the resource-cache instance.\n    // but sync belongsTo requires this since they don't have a proxy to update.\n    // so we have to notify so it will \"update\" to null.\n    // we should discuss whether we still care about this, probably fine to just\n    // leave the ui relationship populated since the record is destroyed and\n    // internally we've fully cleaned up.\n    if (!rel.definition.isAsync && !silenceNotifications) {\n      /*#__NOINLINE__*/ notifyChange(graph, rel.identifier, rel.definition.key);\n    }\n  }\n}\n\nfunction notifyInverseOfDematerialization(\n  graph: Graph,\n  inverseIdentifier: StableRecordIdentifier,\n  inverseKey: string,\n  identifier: StableRecordIdentifier,\n  silenceNotifications?: boolean\n) {\n  if (!graph.has(inverseIdentifier, inverseKey)) {\n    return;\n  }\n\n  const relationship = graph.get(inverseIdentifier, inverseKey);\n  assert(`expected no implicit`, !isImplicit(relationship));\n\n  // For remote members, it is possible that inverseRecordData has already been associated to\n  // to another record. For such cases, do not dematerialize the inverseRecordData\n  if (!isBelongsTo(relationship) || !relationship.localState || identifier === relationship.localState) {\n    /*#__NOINLINE__*/ removeDematerializedInverse(graph, relationship, identifier, silenceNotifications);\n  }\n}\n\nfunction clearRelationship(relationship: CollectionEdge | ResourceEdge) {\n  if (isBelongsTo(relationship)) {\n    relationship.localState = null;\n    relationship.remoteState = null;\n    relationship.state.hasReceivedData = false;\n    relationship.state.isEmpty = true;\n  } else {\n    relationship.remoteMembers.clear();\n    relationship.remoteState = [];\n    relationship.additions = null;\n    relationship.removals = null;\n    relationship.localState = null;\n  }\n}\n\nfunction removeDematerializedInverse(\n  graph: Graph,\n  relationship: CollectionEdge | ResourceEdge,\n  inverseIdentifier: StableRecordIdentifier,\n  silenceNotifications?: boolean\n) {\n  if (isBelongsTo(relationship)) {\n    const localInverse = relationship.localState;\n    if (!relationship.definition.isAsync || (localInverse && isNew(localInverse))) {\n      // unloading inverse of a sync relationship is treated as a client-side\n      // delete, so actually remove the models don't merely invalidate the cp\n      // cache.\n      // if the record being unloaded only exists on the client, we similarly\n      // treat it as a client side delete\n      if (relationship.localState === localInverse && localInverse !== null) {\n        relationship.localState = null;\n      }\n\n      if (relationship.remoteState === localInverse && localInverse !== null) {\n        relationship.remoteState = null;\n        relationship.state.hasReceivedData = true;\n        relationship.state.isEmpty = true;\n        if (relationship.localState && !isNew(relationship.localState)) {\n          relationship.localState = null;\n        }\n      }\n    } else {\n      relationship.state.hasDematerializedInverse = true;\n    }\n\n    if (!silenceNotifications) {\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  } else {\n    if (!relationship.definition.isAsync || (inverseIdentifier && isNew(inverseIdentifier))) {\n      // unloading inverse of a sync relationship is treated as a client-side\n      // delete, so actually remove the models don't merely invalidate the cp\n      // cache.\n      // if the record being unloaded only exists on the client, we similarly\n      // treat it as a client side delete\n      /*#__NOINLINE__*/ removeIdentifierCompletelyFromRelationship(graph, relationship, inverseIdentifier);\n    } else {\n      relationship.state.hasDematerializedInverse = true;\n    }\n\n    if (!silenceNotifications) {\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  }\n}\n\nfunction removeCompletelyFromInverse(graph: Graph, relationship: GraphEdge) {\n  const { identifier } = relationship;\n  const { inverseKey } = relationship.definition;\n\n  forAllRelatedIdentifiers(relationship, (inverseIdentifier: StableRecordIdentifier) => {\n    if (graph.has(inverseIdentifier, inverseKey)) {\n      removeIdentifierCompletelyFromRelationship(graph, graph.get(inverseIdentifier, inverseKey), identifier);\n    }\n  });\n\n  if (isBelongsTo(relationship)) {\n    if (!relationship.definition.isAsync) {\n      clearRelationship(relationship);\n    }\n\n    relationship.localState = null;\n  } else if (isHasMany(relationship)) {\n    if (!relationship.definition.isAsync) {\n      clearRelationship(relationship);\n\n      notifyChange(graph, relationship.identifier, relationship.definition.key);\n    }\n  } else {\n    relationship.remoteMembers.clear();\n    relationship.localMembers.clear();\n  }\n}\n\nfunction addPending(\n  cache: PendingOps,\n  definition: UpgradedMeta,\n  op: RemoteRelationshipOperation & { field: string }\n): void {\n  const lc = (cache[definition.kind as 'hasMany' | 'belongsTo'] =\n    cache[definition.kind as 'hasMany' | 'belongsTo'] || new Map<string, Map<string, RemoteRelationshipOperation[]>>());\n  let lc2 = lc.get(definition.inverseType);\n  if (!lc2) {\n    lc2 = new Map<string, RemoteRelationshipOperation[]>();\n    lc.set(definition.inverseType, lc2);\n  }\n  let arr = lc2.get(op.field);\n  if (!arr) {\n    arr = [];\n    lc2.set(op.field, arr);\n  }\n  arr.push(op);\n}\n\nfunction isReordered(relationship: CollectionEdge): boolean {\n  // if we are dirty we are never re-ordered because accessing\n  // the state would flush away any reordering.\n  if (relationship.isDirty) {\n    return false;\n  }\n\n  const { remoteState, localState, additions, removals } = relationship;\n  assert(`Expected localSate`, localState);\n\n  for (let i = 0, j = 0; i < remoteState.length; i++) {\n    const member = remoteState[i];\n    const localMember = localState[j];\n\n    if (member !== localMember) {\n      if (removals && removals.has(member)) {\n        // dont increment j because we want to skip this\n        continue;\n      }\n      if (additions && additions.has(localMember)) {\n        // increment j to skip this localMember\n        // decrement i to repeat this remoteMember\n        j++;\n        i--;\n        continue;\n      }\n      return true;\n    }\n\n    // if we made it here, increment j\n    j++;\n  }\n\n  return false;\n}\n","import { DEBUG } from '@ember-data/env';\nimport type Store from '@ember-data/store';\nimport type { CacheCapabilitiesManager } from '@ember-data/store/-types/q/cache-store-wrapper';\n\nimport { getStore } from './-utils';\nimport { Graph, Graphs } from './graph';\n\nfunction isStore(maybeStore: unknown): maybeStore is Store {\n  return (maybeStore as Store)._instanceCache !== undefined;\n}\n\nfunction getWrapper(store: CacheCapabilitiesManager | Store): CacheCapabilitiesManager {\n  return isStore(store) ? store._instanceCache._storeWrapper : store;\n}\n\nexport function peekGraph(store: CacheCapabilitiesManager | Store): Graph | undefined {\n  return Graphs.get(getWrapper(store));\n}\nexport type peekGraph = typeof peekGraph;\n\nexport function graphFor(store: CacheCapabilitiesManager | Store): Graph {\n  const wrapper = getWrapper(store);\n  let graph = Graphs.get(wrapper);\n\n  if (!graph) {\n    graph = new Graph(wrapper);\n    Graphs.set(wrapper, graph);\n    getStore(wrapper)._graph = graph;\n\n    if (DEBUG) {\n      if (getStore(wrapper).isDestroying) {\n        throw new Error(`Memory Leak Detected During Teardown`);\n      }\n    }\n  }\n  return graph;\n}\n"],"names":["coerceId","id","macroCondition","getOwnConfig","deprecations","DEPRECATE_NON_STRICT_ID","normalized","undefined","String","deprecate","JSON","stringify","until","for","since","available","enabled","assert","length","getStore","wrapper","_store","expandingGet","cache","key1","key2","mainCache","Object","create","expandingSet","value","assertValidRelationshipPayload","graph","op","relationship","get","record","field","isHasMany","isBelongsTo","payload","definition","identifier","state","type","isAsync","kind","links","warn","data","hasReceivedData","inspect","Array","isArray","assertRelationshipData","store","i","isNew","peekCache","Boolean","isImplicit","forAllRelatedIdentifiers","rel","cb","remoteState","localState","inverseIdentifier","additions","forEach","localMembers","remoteMembers","has","removeIdentifierCompletelyFromRelationship","silenceNotifications","notifyChange","key","delete","wasInRemovals","removals","canonicalIndex","indexOf","splice","currentIndex","_removing","debug","LOG_GRAPH","console","log","meta","getSchemaDefinitionService","doesTypeExist","assertPolymorphicType","assertInheritedSchema","env","DEBUG","validateSchema","errors","Map","inverseKey","name","set","inverseType","inverseKind","inverseIsAsync","options","async","inverseIsPolymorphic","polymorphic","inverse","as","expectedSchema","printSchema","config","metaFrom","isPolymorphic","inverseMetaFrom","inverseDefinition","isCollection","inverseIsCollection","inverseIsImplicit","resetOnRemoteUpdate","definitionWithPolymorphic","assign","meta1","meta2","errors1","errors2","size","Error","parentIdentifier","parentDefinition","addedIdentifier","relationshipsDefinitionFor","replaceRelatedRecords","isRemote","replaceRelatedRecordsRemote","replaceRelatedRecordsLocal","identifiers","wasDirty","isDirty","onAdd","removalsHas","registerPolymorphicType","addToInverse","onRemove","additionsHas","removeFromInverse","diff","diffCollection","changed","add","del","finalState","_addToTransaction","finalSet","_diff","DEPRECATE_RELATIONSHIP_REMOTE_UPDATE_CLEARING_LOCAL_STATE","deprecationInfo","triggered","push","map","lid","join","url","flushCanonical","isEmpty","_addLocal","notifyInverseOfPotentialMaterialization","_removeRemote","_removeLocal","_scheduleLocalSync","replaceRelatedRecord","prop","existingState","isStale","hasFailedLoadAttempt","_deprecatedCompare","newState","newMembers","prevState","prevSet","onDel","newLength","prevLength","iterationLength","Math","max","added","Set","removed","duplicates","j","adv","member","list","prevMember","_compare","finalLength","equalLength","DEPRECATE_NON_UNIQUE_PAYLOADS","computeLocalState","storage","slice","v","index","hasPresence","rollbackRelationship","BOOL_LATER","STR_LATER","IMPLICIT_KEY_RAND","Date","now","implicitKeyFor","syncMeta","upgradeMeta","niceMeta","assertConfiguration","info","isSelfReferential","_isRHS","rhs_relationshipName","rhs_baseModelName","lhs_isPolymorphic","rhs_modelNames","includes","_isLHS","lhs_relationshipName","lhs_baseModelName","rhs_isPolymorphic","lhs_modelNames","lhs_definition","isLHS","isRelationship","upgradeDefinition","propertyName","_definitionCache","storeWrapper","polymorphicLookup","_potentialPolymorphicTypes","cached","relationships","altTypes","keys","_cached","modelFor","inverseForRelationship","inverseDefinitions","metaFromInverse","lhs_key","rhs_key","rhs_definition","hasInverse","isReflexive","baseType","modelNames","createState","shouldForceReload","hasDematerializedInverse","createCollectionEdge","transactionRef","legacyGetCollectionRelationshipData","source","createImplicitEdge","createResourceEdge","legacyGetResourceRelationshipData","addToRelatedRecords","addRelatedRecord","mergeIdentifier","mergeIdentifierForRelationship","mergeInRelationship","mergeBelongsTo","mergeHasMany","mergeImplicit","removeFromRelatedRecords","removeRelatedRecord","_normalizeLink","link","href","updateRelationshipOperation","hasRelationshipDataProperty","hasUpdatedLink","identifierCache","update","upgradeIdentifiers","upgradeIdentifier","originalLinks","related","relatedLink","currentLink","currentLinkHref","relationshipIsEmpty","isStaleTransaction","_transaction","relationshipTransactionId","graphTransactionId","arr","Graphs","Graph","constructor","_metaCache","isDestroyed","_willSyncRemote","_willSyncLocal","_pushedUpdates","belongsTo","hasMany","deletions","_updatedRelationships","getDefinition","defs","getData","type1","type2","typeCache","t1","t2","isReleasable","unload","destroyRelationship","_isDirty","hasAdditions","hasRemovals","isReordered","getChanged","reordered","hasChanged","rollback","remove","addPending","_schedule","_flushRemoteQueue","removeCompletelyFromInverse","_flushLocalQueue","groupCollapsed","updates","flushPending","groupEnd","updated","destroy","_","isDestroying","clear","ops","opList","flushPendingList","inverseIdentifer","notifyInverseOfDematerialization","clearRelationship","removeDematerializedInverse","localInverse","lc","lc2","localMember","isStore","maybeStore","_instanceCache","getWrapper","_storeWrapper","peekGraph","graphFor","_graph"],"mappings":"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"}