<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>PerBundleAddonCache { - ember-cli</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/yui/3.18.0/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div class="yui3-g">
        <div id="sidebar" class="yui3-u">
            <div class="logo">
              <a href="../index.html">
                  <img src="https://ember-cli.com/assets/images/ember-cli-logo-small-dark.png">
              </a>
            </div>
            
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/ember-cli.html">ember-cli</a>
                            </li>
                            <li><a href="../modules/is-lazy-engine.html">is-lazy-engine</a>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/Addon.html">Addon</a></li>
                            <li><a href="../classes/AmdTransformAddon.html">AmdTransformAddon</a></li>
                            <li><a href="../classes/Blueprint.html">Blueprint</a></li>
                            <li><a href="../classes/Builder.html">Builder</a></li>
                            <li><a href="../classes/CLI.html">CLI</a></li>
                            <li><a href="../classes/Command.html">Command</a></li>
                            <li><a href="../classes/DefaultPackager.html">DefaultPackager</a></li>
                            <li><a href="../classes/EmberAddon.html">EmberAddon</a></li>
                            <li><a href="../classes/EmberApp.html">EmberApp</a></li>
                            <li><a href="../classes/HardwareInfo.html">HardwareInfo</a></li>
                            <li><a href="../classes/HistorySupportAddon.html">HistorySupportAddon</a></li>
                            <li><a href="../classes/Instrumentation.html">Instrumentation</a></li>
                            <li><a href="../classes/NodeModulesList.html">NodeModulesList</a></li>
                            <li><a href="../classes/NpmTask.html">NpmTask</a></li>
                            <li><a href="../classes/PackageInfo.html">PackageInfo</a></li>
                            <li><a href="../classes/PackageInfoCache.html">PackageInfoCache</a></li>
                            <li><a href="../classes/PerBundleAddonCache {.html">PerBundleAddonCache {</a></li>
                            <li><a href="../classes/Project.html">Project</a></li>
                            <li><a href="../classes/ServeFilesAddon.html">ServeFilesAddon</a></li>
                            <li><a href="../classes/TestsServerAddon.html">TestsServerAddon</a></li>
                            <li><a href="../classes/WatcherAddon.html">WatcherAddon</a></li>
                            <li><a href="../classes/WindowsSymlinkChecker.html">WindowsSymlinkChecker</a></li>
                    </ul>
                </div>
            </div>
            
            
            <div id="sections" class="sidebox">
              <div class="hd">
                <h2 class="no-toc">PerBundleAddonCache {</h2>
              </div>
              <div class="bd">
            
            
            
            
                  <div><a href="#method-summary">Method Summary</a></div>
            
            
            
            
            
            
            
            
            
            
            
            
            
                  <div><a href="#public-methods">Public Methods</a></div>
                  <ul>
                      <li><a href="#method_allowCachingPerBundle">allowCachingPerBundle</a></li>
                      <li><a href="#method_bundleHostOwnsInstance">bundleHostOwnsInstance</a></li>
                      <li><a href="#method_createAddonCacheEntry">createAddonCacheEntry</a></li>
                      <li><a href="#method_createBundleHostCacheEntry">createBundleHostCacheEntry</a></li>
                      <li><a href="#method_findBundleHost">findBundleHost</a></li>
                      <li><a href="#method_getAddonInstance">getAddonInstance</a></li>
                      <li><a href="#method_getAddonProxy">getAddonProxy</a></li>
                      <li><a href="#method_resolvePerBundleAddonCacheUtil">resolvePerBundleAddonCacheUtil</a></li>
                      <li><a href="#method_validateCacheKey">validateCacheKey</a></li>
                  </ul>
            
            
              </div>
            </div>
            
            
            
            <div class="version-info">
              Version: 3.28.6-lts-3-28-23a0d98b59
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><div class="title">
    <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l46"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:46</code></a></span>
    <h1 class="class-name">PerBundleAddonCache {</h1>
</div>




<div class="class-description"><p>For large applications with many addons (and many instances of each, resulting in
potentially many millions of addon instances during a build), the build can become
very, very slow (tens of minutes) partially due to the sheer number of addon instances.
The PerBundleAddonCache deals with this slowness by doing 3 things:</p>
<p>(1) Making only a single copy of each of certain addons and their dependent addons
(2) Replacing any other instances of those addons with Proxy copies to the single instance
(3) Having the Proxies return an empty array for their dependent addons, rather
than proxying to the contents of the single addon instance. This gives up the
ability of the Proxies to traverse downward into their child addons,
something that many addons do not do anyway, for the huge reduction in duplications
of those child addons. For applications that enable <code>ember-engines</code> dedupe logic,
that logic is stateful, and having the Proxies allow access to the child addons array
just breaks everything, because that logic will try multiple times to remove items
it thinks are duplicated, messing up the single copy of the child addon array.
See the explanation of the dedupe logic in
{@link <a href="https://github.com/ember-engines/ember-engines/blob/master/packages/ember-engines/lib/utils/deeply-non-duplicated-addon.js">https://github.com/ember-engines/ember-engines/blob/master/packages/ember-engines/lib/utils/deeply-non-duplicated-addon.js</a>}</p>
<p>What follows are the more technical details of how the PerBundleAddonCache implements
the above 3 behaviors.</p>
<p>This class supports per-bundle-host (bundle host = project or lazy engine)
caching of addon instances. During addon initialization we cannot add a
cache to each bundle host object AFTER it is instantiated because running the
addon constructor ultimately causes Addon class <code>setupRegistry</code> code to
run which instantiates child addons, which need the cache to already be
in place for the parent bundle host.
We handle this by providing a global cache that exists independent of the
bundle host objects. That is this object.</p>
<p>There are a number of "behaviors" being implemented by this object and
its contents. They are:
(1) Any addon that is a lazy engine has only a single real instance per
project - all other references to the lazy engine are to be proxies. These
lazy engines are compared by name, not by packageInfo.realPath.
(2) Any addon that is not a lazy engine, there is only a single real instance
of the addon per "bundle host" (i.e. lazy engine or project).
(3) An optimization - any addon that is in a lazy engine but that is also
in bundled by its LCA host - the single instance is the one bundled by this
host. All other instances (in any lazy engine) are proxies.</p>
<p>NOTE: the optimization is only enabled if the environment variable that controls
<code>ember-engines</code> transitive deduplication (process.env.EMBER_ENGINES_ADDON_DEDUPE)
is set to a truthy value. For more info, see:
<a href="https://github.com/ember-engines/ember-engines/blob/master/packages/ember-engines/lib/engine-addon.js#L396">https://github.com/ember-engines/ember-engines/blob/master/packages/ember-engines/lib/engine-addon.js#L396</a></p>
</div>








  <h2 id="method-summary">Method Summary</h2>

    <table class="summary">
      <thead>
      <tr>
        <th colspan="2">Public Methods</th>
      </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_allowCachingPerBundle">allowCachingPerBundle</a>(addonEntryPointModule): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" class="crosslink external" target="_blank">Boolean</a>
            </div>
            <div class="short-description">
              <p>The default implementation here is to indicate if the original addon entry point has the <code>allowCachingPerBundle</code> flag set either on itself or on its prototype.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_bundleHostOwnsInstance">bundleHostOwnsInstance</a>((Object}, addonPkgInfo): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" class="crosslink external" target="_blank">Boolean</a>
            </div>
            <div class="short-description">
              <p>An optimization we support from lazy engines is the following:</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_createAddonCacheEntry">createAddonCacheEntry</a>(addonInstance, addonRealPath): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a>
            </div>
            <div class="short-description">
              <p>Create a cache entry object for a given (non-bundle-host) addon to put into an addon cache.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_createBundleHostCacheEntry">createBundleHostCacheEntry</a>(bundleHostPkgInfo): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a>
            </div>
            <div class="short-description">
              <p>Creates a cache entry for the bundleHostCache. Because we want to use the same sort of proxy for both bundle hosts and for 'regular' addon instances (though their cache entries have slightly different structures) we'll use the Symbol from getAddonProxy.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_findBundleHost">findBundleHost</a>(addonParent, addonPkgInfo): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a>
            </div>
            <div class="short-description">
              <p>Given a parent object of a potential addon (another addon or the project), go up the 'parent' chain to find the potential addon's bundle host object (i.e. lazy engine or project.) Because Projects are always bundle hosts, this should always pass, but we'll throw if somehow it doesn't work.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_getAddonInstance">getAddonInstance</a>(parent, addonPkgInfo): <a href="../classes/Addon.html" class="crosslink">Addon</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" class="crosslink external" target="_blank">Proxy</a>
            </div>
            <div class="short-description">
              <p>Called from PackageInfo.getAddonInstance(), return an instance of the requested addon or a Proxy, based on the type of addon and its bundle host.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_getAddonProxy">getAddonProxy</a>(targetCacheEntry, parent): 
            </div>
            <div class="short-description">
              <p>Returns a proxy to a target with specific handling for the <code>parent</code> property, as well has to handle the <code>app</code> property; that is, the proxy should maintain correct local state in closure scope for the <code>app</code> property if it happens to be set by <code>ember-cli</code>. Other than <code>parent</code> &amp; <code>app</code>, this function also proxies <em>almost</em> everything to <code>target[TARGET_INSTANCE] with a few exceptions: we trap &amp; return</code>[]<code>for</code>addons<code>, and we don't return the original</code>included<code>(it's already called on the "real" addon by</code>ember-cli`).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_resolvePerBundleAddonCacheUtil">resolvePerBundleAddonCacheUtil</a>(project): AllowCachingPerBundle: Function
            </div>
            <div class="short-description">
              <p>Resolves the perBundleAddonCacheUtil; this prefers the custom provided version by the consuming application, and defaults to an internal implementation here.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            public
            
            
          </td>
          <td>
            <div class="method-name ">
              <a href="#method_validateCacheKey">validateCacheKey</a>(realAddonInstance, treeType, newCacheKey)
            </div>
            <div class="short-description">
              <p>Validates that a new cache key for a given tree type matches the previous cache key for the same tree type. To opt-in to bundle addon caching for a given addon it's assumed that it returns stable cache keys; specifically this is because the interplay between bundle addon caching and <code>ember-engines</code> when transitive deduplication is enabled assumes stable cache keys, so we validate for this case here.</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>















  <div id="methods public">
    <h2 id="public-methods">Public Methods</h2>
<div class="method item">
    <div id="method_allowCachingPerBundle" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l116"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:116</code></a></span>
        <h3 class="">
            public
            
            
            allowCachingPerBundle(addonEntryPointModule): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" class="crosslink external" target="_blank">Boolean</a>
        </h3>
    </div>



    <div class="method-description"><p>The default implementation here is to indicate if the original addon entry point has
the <code>allowCachingPerBundle</code> flag set either on itself or on its prototype.</p>
<p>If a consuming application specifies a relative path to a custom utility via the
<code>ember-addon.perBundleAddonCacheUtil</code> configuration, we prefer the custom implementation
provided by the consumer.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>addonEntryPointModule</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="crosslink external" target="_blank">Function</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td> </td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" class="crosslink external" target="_blank">Boolean</a></span>
          <span class="return-description"><p>true if the given constructor function or class supports caching per bundle, false otherwise</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_bundleHostOwnsInstance" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l197"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:197</code></a></span>
        <h3 class="">
            public
            
            
            bundleHostOwnsInstance((Object}, addonPkgInfo): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" class="crosslink external" target="_blank">Boolean</a>
        </h3>
    </div>



    <div class="method-description"><p>An optimization we support from lazy engines is the following:</p>
<p>If an addon instance is supposed to be bundled with a particular lazy engine, and
same addon is also to be bundled by a common LCA host, prefer the one bundled by the
host (since it's ultimately going to be deduped later by <code>ember-engines</code>).</p>
<p>NOTE: this only applies if this.engineAddonTransitiveDedupeEnabled is truthy. If it is not,
the bundle host always "owns" the addon instance.</p>
<p>If deduping is enabled and the LCA host also depends on the same addon,
the lazy-engine instances of the addon will all be proxies to the one in
the LCA host. This function indicates whether the bundle host passed in
(either the project or a lazy engine) is really the bundle host to "own" the
new addon.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>(Object}</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>bundleHost the project or lazy engine that is trying to "own"
the new addon instance specified by addonPkgInfo</p>
</td>
            </tr>

            <tr>
              <td>addonPkgInfo</td>
              <td><a href="../classes/PackageInfo.html" class="crosslink">PackageInfo</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the PackageInfo of the potential new addon instance</p>
</td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" class="crosslink external" target="_blank">Boolean</a></span>
          <span class="return-description"><p>true if the bundle host is to "own" the instance, false otherwise.</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_createAddonCacheEntry" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l145"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:145</code></a></span>
        <h3 class="">
            public
            
            
            createAddonCacheEntry(addonInstance, addonRealPath): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a>
        </h3>
    </div>



    <div class="method-description"><p>Create a cache entry object for a given (non-bundle-host) addon to put into
an addon cache.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>addonInstance</td>
              <td><a href="../classes/Addon.html" class="crosslink">Addon</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the addon instance to cache</p>
</td>
            </tr>

            <tr>
              <td>addonRealPath</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" class="crosslink external" target="_blank">String</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the addon's pkgInfo.realPath</p>
</td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
          <span class="return-description"><p>an object in the form of an addon-cache entry</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_createBundleHostCacheEntry" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l132"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:132</code></a></span>
        <h3 class="">
            public
            
            
            createBundleHostCacheEntry(bundleHostPkgInfo): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a>
        </h3>
    </div>



    <div class="method-description"><p>Creates a cache entry for the bundleHostCache. Because we want to use the same sort of proxy
for both bundle hosts and for 'regular' addon instances (though their cache entries have
slightly different structures) we'll use the Symbol from getAddonProxy.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>bundleHostPkgInfo</td>
              <td><a href="../classes/PackageInfo.html" class="crosslink">PackageInfo</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>bundle host's pkgInfo.realPath</p>
</td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
          <span class="return-description"><p>an object in the form of a bundle-host cache entry</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_findBundleHost" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l158"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:158</code></a></span>
        <h3 class="">
            public
            
            
            findBundleHost(addonParent, addonPkgInfo): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a>
        </h3>
    </div>



    <div class="method-description"><p>Given a parent object of a potential addon (another addon or the project),
go up the 'parent' chain to find the potential addon's bundle host object
(i.e. lazy engine or project.) Because Projects are always bundle hosts,
this should always pass, but we'll throw if somehow it doesn't work.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>addonParent</td>
              <td><a href="../classes/Project.html" class="crosslink">Project</a> | <a href="../classes/Addon.html" class="crosslink">Addon</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the direct parent object of a (potential or real) addon.</p>
</td>
            </tr>

            <tr>
              <td>addonPkgInfo</td>
              <td><a href="../classes/PackageInfo.html" class="crosslink">PackageInfo</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the PackageInfo for an addon being instantiated. This is only
used for information if an error is going to be thrown.</p>
</td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
          <span class="return-description"><p>the object in the 'parent' chain that is a bundle host.</p>
</span>
        </div>
      </div>

      <div class="throws">
        <h4>Throws:</h4>
        <div>
          <span class="throws-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="crosslink external" target="_blank">Error</a></span>
          <span class="throws-description"><p>if there is not bundle host</p>
</span>
        </div>
      </div>

</div>
<div class="method item">
    <div id="method_getAddonInstance" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l248"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:248</code></a></span>
        <h3 class="">
            public
            
            
            getAddonInstance(parent, addonPkgInfo): <a href="../classes/Addon.html" class="crosslink">Addon</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" class="crosslink external" target="_blank">Proxy</a>
        </h3>
    </div>



    <div class="method-description"><p>Called from PackageInfo.getAddonInstance(), return an instance of the requested
addon or a Proxy, based on the type of addon and its bundle host.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>parent</td>
              <td><a href="../classes/Addon.html" class="crosslink">Addon</a> | <a href="../classes/Project.html" class="crosslink">Project</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the parent Addon or Project this addon instance is
a child of.</p>
</td>
            </tr>

            <tr>
              <td>addonPkgInfo</td>
              <td></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the PackageInfo for the addon being created.</p>
</td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type"><a href="../classes/Addon.html" class="crosslink">Addon</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" class="crosslink external" target="_blank">Proxy</a></span>
          <span class="return-description"><p>An addon instance (for the first copy of the addon) or a Proxy.
An addon that is a lazy engine will only ever have a single copy in the cache.
An addon that is not will have 1 copy per bundle host (Project or lazy engine),
except if it is an addon that's also owned by a given LCA host and transitive
dedupe is enabled (<code>engineAddonTransitiveDedupeEnabled</code>), in which case it will
only have a single copy in the project's addon cache.</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_getAddonProxy" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_addon-proxy.js.html#l42"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;addon-proxy.js:42</code></a></span>
        <h3 class="">
            public
            
            
            getAddonProxy(targetCacheEntry, parent): 
        </h3>
    </div>



    <div class="method-description"><p>Returns a proxy to a target with specific handling for the
<code>parent</code> property, as well has to handle the <code>app</code> property;
that is, the proxy should maintain correct local state in
closure scope for the <code>app</code> property if it happens to be set
by <code>ember-cli</code>. Other than <code>parent</code> &amp; <code>app</code>, this function also
proxies <em>almost</em> everything to <code>target[TARGET_INSTANCE] with a few exceptions: we trap &amp; return</code>[]<code>for</code>addons<code>, and we don't return the original</code>included<code>(it's already called on the "real" addon by</code>ember-cli`).</p>
<p>Note: the target is NOT the per-bundle cacheable instance of the addon. Rather,
it is a cache entry POJO from PerBundleAddonCache.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>targetCacheEntry</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the PerBundleAddonCache cache entry we are to proxy. It
has one interesting property, the real addon instance the proxy is forwarding
calls to (that property is not globally exposed).</p>
</td>
            </tr>

            <tr>
              <td>parent</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>the parent object of the proxy being created (the same as
the 'parent' property of a normal addon instance)</p>
</td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          
          <span class="return-description"><p>Proxy</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_resolvePerBundleAddonCacheUtil" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_index.js.html#l17"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;index.js:17</code></a></span>
        <h3 class="">
            public
            
            
            resolvePerBundleAddonCacheUtil(project): AllowCachingPerBundle: Function
        </h3>
    </div>



    <div class="method-description"><p>Resolves the perBundleAddonCacheUtil; this prefers the custom provided version by
the consuming application, and defaults to an internal implementation here.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>project</td>
              <td><a href="../classes/Project.html" class="crosslink">Project</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td> </td>
            </tr>

          </tbody>
        </table>
      </div>

      <div class="return">
        <h4>Return:</h4>
        <div>
          <span class="return-type">AllowCachingPerBundle: Function</span>
          <span class="return-description"><p>}</p>
</span>
        </div>
      </div>


</div>
<div class="method item">
    <div id="method_validateCacheKey" class="title">
        <span class="source-link"><a href="../files/lib_models_per-bundle-addon-cache_addon-proxy.js.html#l7"><code>lib&#x2F;models&#x2F;per-bundle-addon-cache&#x2F;addon-proxy.js:7</code></a></span>
        <h3 class="">
            public
            
            
            validateCacheKey(realAddonInstance, treeType, newCacheKey)
        </h3>
    </div>



    <div class="method-description"><p>Validates that a new cache key for a given tree type matches the previous
cache key for the same tree type. To opt-in to bundle addon caching for
a given addon it's assumed that it returns stable cache keys; specifically
this is because the interplay between bundle addon caching and <code>ember-engines</code>
when transitive deduplication is enabled assumes stable cache keys, so we validate
for this case here.</p>
</div>

      <div class="params">
        <h4>Parameters:</h4>
        <table>
          <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
            <tr>
              <td>realAddonInstance</td>
              <td><a href="../classes/Addon.html" class="crosslink">Addon</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td><p>The real addon instance</p>
</td>
            </tr>

            <tr>
              <td>treeType</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" class="crosslink external" target="_blank">String</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td> </td>
            </tr>

            <tr>
              <td>newCacheKey</td>
              <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" class="crosslink external" target="_blank">String</a></td>
              <td>
                <ul>
                  
                  
                  
                </ul>
              </td>
              <td> </td>
            </tr>

          </tbody>
        </table>
      </div>


      <div class="throws">
        <h4>Throws:</h4>
        <div>
          <span class="throws-type"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="crosslink external" target="_blank">Error</a></span>
          <span class="throws-description"><p>If the new cache key doesn't match the previous cache key</p>
</span>
        </div>
      </div>

</div>
  </div>




</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
</body>
</html>
