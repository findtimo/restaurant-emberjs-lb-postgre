{"version":3,"file":"cookie.js","sources":["../../src/session-stores/cookie.js"],"sourcesContent":["import RSVP from 'rsvp';\nimport { computed } from '@ember/object';\nimport { inject as service } from '@ember/service';\nimport { later, cancel, scheduleOnce, next } from '@ember/runloop';\nimport { isPresent, typeOf, isEmpty, isNone } from '@ember/utils';\nimport { A } from '@ember/array';\nimport { getOwner } from '@ember/application';\nimport { warn } from '@ember/debug';\nimport BaseStore from './base';\nimport objectsAreEqual from '../utils/objects-are-equal';\nimport { isTesting } from '@embroider/macros';\n\nconst persistingProperty = function (beforeSet = function () {}) {\n  return computed({\n    get(key) {\n      return this.get(`_${key}`);\n    },\n    set(key, value) {\n      beforeSet.apply(this, [key, value]);\n      this.set(`_${key}`, value);\n      scheduleOnce('actions', this, this.rewriteCookie);\n      return value;\n    },\n  });\n};\n\n/**\n  Session store that persists data in a cookie.\n\n  By default the cookie session store uses a session cookie that expires and is\n  deleted when the browser is closed. The cookie expiration period can be\n  configured by setting the\n  {{#crossLink \"CookieStore/cookieExpirationTime:property\"}}{{/crossLink}}\n  property. This can be used to implement \"remember me\" functionality that will\n  either store the session persistently or in a session cookie depending on\n  whether the user opted in or not:\n\n  ```js\n  // app/controllers/login.js\n  import Controller from '@ember/controller';\n  import { inject as service } from '@ember/service';\n\n  export default class LoginController extends Controller {\n    @service session;\n    _rememberMe = false;\n\n    get rememberMe() {\n      return this._rememberMe;\n    }\n\n    set rememberMe(value) {\n      let expirationTime = value ? (14 * 24 * 60 * 60) : null;\n      this.set('session.store.cookieExpirationTime', expirationTime);\n      this._rememberMe = value;\n    }\n  }\n  ```\n\n  __Applications that use FastBoot must use this session store by defining the\n  application session store like this:__\n\n  ```js\n  // app/session-stores/application.js\n  import CookieStore from 'ember-simple-auth/session-stores/cookie';\n\n  export default class ApplicationSessionStore extends CookieStore {}\n  ```\n\n  @class CookieStore\n  @module ember-simple-auth/session-stores/cookie\n  @extends BaseStore\n  @public\n*/\nexport default BaseStore.extend({\n  _syncDataTimeout: null,\n  _renewExpirationTimeout: null,\n\n  /**\n    The domain to use for the cookie, e.g., \"example.com\", \".example.com\"\n    (which includes all subdomains) or \"subdomain.example.com\". If not\n    explicitly set, the cookie domain defaults to the domain the session was\n    authenticated on.\n\n    @property cookieDomain\n    @type String\n    @default null\n    @public\n  */\n  _cookieDomain: null,\n  cookieDomain: persistingProperty(),\n\n  /**\n    Allows servers to assert that a cookie ought not to be sent along with cross-site requests,\n    which provides some protection against cross-site request forgery attacks (CSRF).\n    Available options:\n    - \"Strict\"\n    - \"Lax\"\n    @property sameSite\n    @type String\n    @default null\n    @public\n  */\n  _sameSite: null,\n  sameSite: persistingProperty(),\n\n  /**\n    The name of the cookie.\n\n    @property cookieName\n    @type String\n    @default ember_simple_auth-session\n    @public\n  */\n  _cookieName: 'ember_simple_auth-session',\n  cookieName: persistingProperty(function () {\n    this._oldCookieName = this._cookieName;\n  }),\n\n  /**\n    The path to use for the cookie, e.g., \"/\", \"/something\".\n\n    @property cookiePath\n    @type String\n    @default '/'\n    @public\n  */\n  _cookiePath: '/',\n  cookiePath: persistingProperty(),\n\n  /**\n    The expiration time for the cookie in seconds. A value of `null` will make\n    the cookie a session cookie that expires and gets deleted when the browser\n    is closed.\n\n    The recommended minimum value is 90 seconds. If your value is less than\n    that, the cookie may expire before its expiration time is extended\n    (expiration time is extended every 60 seconds).\n\n    @property cookieExpirationTime\n    @default null\n    @type Integer\n    @public\n  */\n  _cookieExpirationTime: null,\n  cookieExpirationTime: persistingProperty(function (key, value) {\n    // When nulling expiry time on purpose, we need to clear the cached value.\n    // Otherwise, `_calculateExpirationTime` will reuse it.\n    if (isNone(value)) {\n      this.get('_cookies').clear(`${this.get('cookieName')}-expiration_time`);\n    } else if (value < 90) {\n      warn(\n        'The recommended minimum value for `cookieExpirationTime` is 90 seconds. If your value is less than that, the cookie may expire before its expiration time is extended (expiration time is extended every 60 seconds).',\n        false,\n        { id: 'ember-simple-auth.cookieExpirationTime' }\n      );\n    }\n  }),\n\n  _cookies: service('cookies'),\n\n  _secureCookies() {\n    if (this.get('_fastboot.isFastBoot')) {\n      return this.get('_fastboot.request.protocol') === 'https:';\n    }\n\n    return window.location.protocol === 'https:';\n  },\n\n  _isPageVisible() {\n    if (this.get('_fastboot.isFastBoot')) {\n      return false;\n    } else {\n      const visibilityState =\n        typeof document !== 'undefined'\n          ? document.visibilityState || 'visible'\n          : false;\n      return visibilityState === 'visible';\n    }\n  },\n\n  init() {\n    this._super(...arguments);\n    let owner = getOwner(this);\n    if (owner && !this.hasOwnProperty('_fastboot')) {\n      this._fastboot = owner.lookup('service:fastboot');\n    }\n\n    let cachedExpirationTime = this._read(\n      `${this.get('cookieName')}-expiration_time`\n    );\n    if (cachedExpirationTime) {\n      this.set('cookieExpirationTime', parseInt(cachedExpirationTime, 10));\n    }\n\n    if (!this.get('_fastboot.isFastBoot')) {\n      next(() => {\n        this._syncData().then(() => {\n          this._renewExpiration();\n        });\n      });\n    } else {\n      this._renew();\n    }\n  },\n\n  /**\n    Persists the `data` in the cookie.\n\n    @method persist\n    @param {Object} data The data to persist\n    @return {RSVP.Promise} A promise that resolves when the data has successfully been persisted and rejects otherwise.\n    @public\n  */\n  persist(data) {\n    this._lastData = data;\n    data = JSON.stringify(data || {});\n    let expiration = this._calculateExpirationTime();\n    this._write(data, expiration);\n    return RSVP.resolve();\n  },\n\n  /**\n    Returns all data currently stored in the cookie as a plain object.\n\n    @method restore\n    @return {RSVP.Promise} A promise that resolves with the data currently persisted in the store when the data has been restored successfully and rejects otherwise.\n    @public\n  */\n  restore() {\n    let data = this._read(this.get('cookieName'));\n    if (isEmpty(data)) {\n      return RSVP.resolve({});\n    } else {\n      return RSVP.resolve(JSON.parse(data));\n    }\n  },\n\n  /**\n    Clears the store by deleting the cookie.\n\n    @method clear\n    @return {RSVP.Promise} A promise that resolves when the store has been cleared successfully and rejects otherwise.\n    @public\n  */\n  clear() {\n    this._write('', 0);\n    this._lastData = {};\n    return RSVP.resolve();\n  },\n\n  _read(name) {\n    return this.get('_cookies').read(name) || '';\n  },\n\n  _calculateExpirationTime() {\n    let cachedExpirationTime = this._read(\n      `${this.get('cookieName')}-expiration_time`\n    );\n    cachedExpirationTime = cachedExpirationTime\n      ? new Date().getTime() + cachedExpirationTime * 1000\n      : null;\n    return this.get('cookieExpirationTime')\n      ? new Date().getTime() + this.get('cookieExpirationTime') * 1000\n      : cachedExpirationTime;\n  },\n\n  _write(value, expiration) {\n    let cookieOptions = {\n      domain: this.get('cookieDomain'),\n      expires: isEmpty(expiration) ? null : new Date(expiration),\n      path: this.get('cookiePath'),\n      secure: this._secureCookies(),\n      sameSite: this.get('sameSite'),\n    };\n    if (this._oldCookieName) {\n      A([\n        this._oldCookieName,\n        `${this._oldCookieName}-expiration_time`,\n      ]).forEach((oldCookie) => {\n        this.get('_cookies').clear(oldCookie);\n      });\n      delete this._oldCookieName;\n    }\n    this.get('_cookies').write(this.get('cookieName'), value, cookieOptions);\n    if (!isEmpty(expiration)) {\n      let expirationCookieName = `${this.get('cookieName')}-expiration_time`;\n      let cachedExpirationTime =\n        this.get('_cookies').read(expirationCookieName);\n      this.get('_cookies').write(\n        expirationCookieName,\n        this.get('cookieExpirationTime') || cachedExpirationTime,\n        cookieOptions\n      );\n    }\n  },\n\n  _syncData() {\n    return this.restore().then((data) => {\n      if (!objectsAreEqual(data, this._lastData)) {\n        this._lastData = data;\n        this.trigger('sessionDataUpdated', data);\n      }\n      if (!isTesting()) {\n        cancel(this._syncDataTimeout);\n        this._syncDataTimeout = later(this, this._syncData, 500);\n      }\n    });\n  },\n\n  _renew() {\n    return this.restore().then((data) => {\n      if (\n        !isEmpty(data) &&\n        !(data.constructor === Object && Object.keys(data).length === 0)\n      ) {\n        data = typeOf(data) === 'string' ? data : JSON.stringify(data || {});\n        let expiration = this._calculateExpirationTime();\n        this._write(data, expiration);\n      }\n    });\n  },\n\n  _renewExpiration() {\n    if (!isTesting()) {\n      cancel(this._renewExpirationTimeout);\n      this._renewExpirationTimeout = later(this, this._renewExpiration, 60000);\n    }\n    if (this._isPageVisible()) {\n      return this._renew();\n    } else {\n      return RSVP.resolve();\n    }\n  },\n\n  rewriteCookie() {\n    // if `cookieName` has not been renamed, `oldCookieName` will be nil\n    const cookieName = this._oldCookieName || this._cookieName;\n    const data = this._read(cookieName);\n    if (isPresent(data)) {\n      const expiration = this._calculateExpirationTime();\n      this._write(data, expiration);\n    }\n  },\n});\n"],"names":["persistingProperty","beforeSet","computed","get","key","set","value","apply","scheduleOnce","rewriteCookie","BaseStore","extend","_syncDataTimeout","_renewExpirationTimeout","_cookieDomain","cookieDomain","_sameSite","sameSite","_cookieName","cookieName","_oldCookieName","_cookiePath","cookiePath","_cookieExpirationTime","cookieExpirationTime","isNone","clear","warn","id","_cookies","service","_secureCookies","window","location","protocol","_isPageVisible","visibilityState","document","init","_super","arguments","owner","getOwner","hasOwnProperty","_fastboot","lookup","cachedExpirationTime","_read","parseInt","next","_syncData","then","_renewExpiration","_renew","persist","data","_lastData","JSON","stringify","expiration","_calculateExpirationTime","_write","RSVP","resolve","restore","isEmpty","parse","name","read","Date","getTime","cookieOptions","domain","expires","path","secure","A","forEach","oldCookie","write","expirationCookieName","objectsAreEqual","trigger","isTesting","cancel","later","constructor","Object","keys","length","typeOf","isPresent"],"mappings":"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"}