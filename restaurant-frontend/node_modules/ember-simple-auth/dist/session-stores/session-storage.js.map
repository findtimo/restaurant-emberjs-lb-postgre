{"version":3,"file":"session-storage.js","sources":["../../src/session-stores/session-storage.js"],"sourcesContent":["import RSVP from 'rsvp';\n\nimport { bind } from '@ember/runloop';\nimport { getOwner } from '@ember/application';\nimport BaseStore from './base';\nimport objectsAreEqual from '../utils/objects-are-equal';\nimport isFastBoot from '../utils/is-fastboot';\n\n/**\n  Session store that persists data in the browser's `sessionStorage`.\n\n  __`sessionStorage` is not available in Safari when running in private mode.__\n\n  __This session store does not work with FastBoot. In order to use Ember\n  Simple Auth with FastBoot, configure the\n  {{#crossLink \"CookieStore\"}}{{/crossLink}} as the application's session\n  store.__\n\n  @class SessionStorageStore\n  @module ember-simple-auth/session-stores/session-storage\n  @extends BaseStore\n  @public\n*/\nexport default BaseStore.extend({\n  /**\n    The `sessionStorage` key the store persists data in.\n\n    @property key\n    @type String\n    @default 'ember_simple_auth-session'\n    @public\n  */\n  key: 'ember_simple_auth-session',\n\n  init() {\n    this._super(...arguments);\n\n    this._isFastBoot = this.hasOwnProperty('_isFastBoot') ? this._isFastBoot : isFastBoot(getOwner(this));\n    if (!this.get('_isFastBoot')) {\n      window.addEventListener('storage', bind(this, this._handleStorageEvent));\n    }\n  },\n\n  willDestroy() {\n    if (!this.get('_isFastBoot')) {\n      window.removeEventListener('storage', bind(this, this._handleStorageEvent));\n    }\n  },\n\n  /**\n    Persists the `data` in the `sessionStorage`.\n\n    @method persist\n    @param {Object} data The data to persist\n    @return {Ember.RSVP.Promise} A promise that resolves when the data has successfully been persisted and rejects otherwise.\n    @public\n  */\n  persist(data) {\n    this._lastData = data;\n    data = JSON.stringify(data || {});\n    sessionStorage.setItem(this.key, data);\n\n    return RSVP.resolve();\n  },\n\n  /**\n    Returns all data currently stored in the `sessionStorage` as a plain object.\n\n    @method restore\n    @return {Ember.RSVP.Promise} A promise that resolves with the data currently persisted in the store when the data has been restored successfully and rejects otherwise.\n    @public\n  */\n  restore() {\n    let data = sessionStorage.getItem(this.key);\n\n    return RSVP.resolve(JSON.parse(data) || {});\n  },\n\n  /**\n    Clears the store by deleting the\n    {{#crossLink \"sessionStorageStore/key:property\"}}{{/crossLink}} from\n    `sessionStorage`.\n\n    @method clear\n    @return {Ember.RSVP.Promise} A promise that resolves when the store has been cleared successfully and rejects otherwise.\n    @public\n  */\n  clear() {\n    sessionStorage.removeItem(this.key);\n    this._lastData = {};\n\n    return RSVP.resolve();\n  },\n\n  _handleStorageEvent(e) {\n    if (e.key === this.get('key')) {\n      this.restore().then((data) => {\n        if (!objectsAreEqual(data, this._lastData)) {\n          this._lastData = data;\n          this.trigger('sessionDataUpdated', data);\n        }\n      });\n    }\n  }\n});\n"],"names":["BaseStore","extend","key","init","_super","arguments","_isFastBoot","hasOwnProperty","isFastBoot","getOwner","get","window","addEventListener","bind","_handleStorageEvent","willDestroy","removeEventListener","persist","data","_lastData","JSON","stringify","sessionStorage","setItem","RSVP","resolve","restore","getItem","parse","clear","removeItem","e","then","objectsAreEqual","trigger"],"mappings":";;;;;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAeA,SAAS,CAACC,MAAM,CAAC;AAC9B;AACF;AACA;AACA;AACA;AACA;AACA;AAEEC,EAAAA,GAAG,EAAE,2BAA2B;AAEhCC,EAAAA,IAAIA,GAAG;AACL,IAAA,IAAI,CAACC,MAAM,CAAC,GAAGC,SAAS,CAAC,CAAA;IAEzB,IAAI,CAACC,WAAW,GAAG,IAAI,CAACC,cAAc,CAAC,aAAa,CAAC,GAAG,IAAI,CAACD,WAAW,GAAGE,UAAU,CAACC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAA;AACrG,IAAA,IAAI,CAAC,IAAI,CAACC,GAAG,CAAC,aAAa,CAAC,EAAE;AAC5BC,MAAAA,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEC,IAAI,CAAC,IAAI,EAAE,IAAI,CAACC,mBAAmB,CAAC,CAAC,CAAA;AAC1E,KAAA;GACD;AAEDC,EAAAA,WAAWA,GAAG;AACZ,IAAA,IAAI,CAAC,IAAI,CAACL,GAAG,CAAC,aAAa,CAAC,EAAE;AAC5BC,MAAAA,MAAM,CAACK,mBAAmB,CAAC,SAAS,EAAEH,IAAI,CAAC,IAAI,EAAE,IAAI,CAACC,mBAAmB,CAAC,CAAC,CAAA;AAC7E,KAAA;GACD;AAED;AACF;AACA;AACA;AACA;AACA;AACA;EAEEG,OAAOA,CAACC,IAAI,EAAE;IACZ,IAAI,CAACC,SAAS,GAAGD,IAAI,CAAA;IACrBA,IAAI,GAAGE,IAAI,CAACC,SAAS,CAACH,IAAI,IAAI,EAAE,CAAC,CAAA;IACjCI,cAAc,CAACC,OAAO,CAAC,IAAI,CAACrB,GAAG,EAAEgB,IAAI,CAAC,CAAA;AAEtC,IAAA,OAAOM,IAAI,CAACC,OAAO,EAAE,CAAA;GACtB;AAED;AACF;AACA;AACA;AACA;AACA;AAEEC,EAAAA,OAAOA,GAAG;IACR,IAAIR,IAAI,GAAGI,cAAc,CAACK,OAAO,CAAC,IAAI,CAACzB,GAAG,CAAC,CAAA;AAE3C,IAAA,OAAOsB,IAAI,CAACC,OAAO,CAACL,IAAI,CAACQ,KAAK,CAACV,IAAI,CAAC,IAAI,EAAE,CAAC,CAAA;GAC5C;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AAEEW,EAAAA,KAAKA,GAAG;AACNP,IAAAA,cAAc,CAACQ,UAAU,CAAC,IAAI,CAAC5B,GAAG,CAAC,CAAA;AACnC,IAAA,IAAI,CAACiB,SAAS,GAAG,EAAE,CAAA;AAEnB,IAAA,OAAOK,IAAI,CAACC,OAAO,EAAE,CAAA;GACtB;EAEDX,mBAAmBA,CAACiB,CAAC,EAAE;IACrB,IAAIA,CAAC,CAAC7B,GAAG,KAAK,IAAI,CAACQ,GAAG,CAAC,KAAK,CAAC,EAAE;MAC7B,IAAI,CAACgB,OAAO,EAAE,CAACM,IAAI,CAAEd,IAAI,IAAK;QAC5B,IAAI,CAACe,eAAe,CAACf,IAAI,EAAE,IAAI,CAACC,SAAS,CAAC,EAAE;UAC1C,IAAI,CAACA,SAAS,GAAGD,IAAI,CAAA;AACrB,UAAA,IAAI,CAACgB,OAAO,CAAC,oBAAoB,EAAEhB,IAAI,CAAC,CAAA;AAC1C,SAAA;AACF,OAAC,CAAC,CAAA;AACJ,KAAA;AACF,GAAA;AACF,CAAC,CAAC;;;;"}