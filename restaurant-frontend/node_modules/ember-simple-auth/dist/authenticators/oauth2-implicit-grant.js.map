{"version":3,"file":"oauth2-implicit-grant.js","sources":["../../src/authenticators/oauth2-implicit-grant.js"],"sourcesContent":["import RSVP from 'rsvp';\nimport { isEmpty } from '@ember/utils';\nimport BaseAuthenticator from './base';\n/**\n  Parses the location hash (as received from `window.location.hash`) into an\n  object, e.g.:\n\n  ```js\n  parseResponse('/routepath#access_token=secret-token&scope=something'); // => { access_token: 'secret-token', scope: 'something' }\n  ```\n\n  @function parseResponse\n  @param {String} locationHash The location hash (as received from `window.location.hash`)\n  @return {Object} An obect with individual properties and values for the data parsed from the location hash\n*/\nexport function parseResponse(locationHash) {\n  let params = {};\n  const query = locationHash.substring(locationHash.indexOf('?'));\n  const regex = /([^#?&=]+)=([^&]*)/g;\n  let match;\n\n  // decode all parameter pairs\n  while ((match = regex.exec(query)) !== null) {\n    params[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);\n  }\n\n  return params;\n}\n\n/**\n Authenticator that conforms to OAuth 2\n ([RFC 6749](http://tools.ietf.org/html/rfc6749)), specifically the _\"Implicit\n Grant Type\"_.\n\n Use {{#crossLink \"SessionService/authenticate:method\"}}{{/crossLink}} in your\n OAuth 2.0 redirect route to parse authentication parameters from location\n hash string into an object.\n\n @class OAuth2ImplicitGrantAuthenticator\n @module ember-simple-auth/authenticators/oauth2-implicit-grant\n @extends BaseAuthenticator\n @public\n */\nexport default BaseAuthenticator.extend({\n  /**\n   Restores the session from a session data object; __will return a resolving\n   promise when there is a non-empty `access_token` in the session data__ and\n   a rejecting promise otherwise.\n\n   @method restore\n   @param {Object} data The data to restore the session from\n   @return {Ember.RSVP.Promise} A promise that when it resolves results in the session becoming or remaining authenticated\n   @public\n   */\n  restore(data) {\n    return new RSVP.Promise((resolve, reject) => {\n      if (!this._validateData(data)) {\n        return reject('Could not restore session - \"access_token\" missing.');\n      }\n\n      return resolve(data);\n    });\n  },\n\n  /**\n   Authenticates the session using the specified location `hash`\n   (see https://tools.ietf.org/html/rfc6749#section-4.2.2).\n\n   __If the access token is valid and thus authentication succeeds, a promise that\n   resolves with the access token is returned__, otherwise a promise that rejects\n   with the error code as returned by the server is returned\n   (see https://tools.ietf.org/html/rfc6749#section-4.2.2.1).\n\n   @method authenticate\n   @param {Object} hash The location hash\n   @return {Ember.RSVP.Promise} A promise that when it resolves results in the session becoming authenticated\n   @public\n   */\n  authenticate(hash) {\n    return new RSVP.Promise((resolve, reject) => {\n      if (hash.error) {\n        reject(hash.error);\n      } else if (!this._validateData(hash)) {\n        reject('Invalid auth params - \"access_token\" missing.');\n      } else {\n        resolve(hash);\n      }\n    });\n  },\n\n  /**\n   This method simply returns a resolving promise.\n\n   @method invalidate\n   @return {Ember.RSVP.Promise} A promise that when it resolves results in the session being invalidated\n   @public\n   */\n  invalidate() {\n    return RSVP.Promise.resolve();\n  },\n\n  _validateData(data) {\n    // see https://tools.ietf.org/html/rfc6749#section-4.2.2\n\n    return !isEmpty(data) && !isEmpty(data.access_token);\n  }\n});\n"],"names":["parseResponse","locationHash","params","query","substring","indexOf","regex","match","exec","decodeURIComponent","BaseAuthenticator","extend","restore","data","RSVP","Promise","resolve","reject","_validateData","authenticate","hash","error","invalidate","isEmpty","access_token"],"mappings":";;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,aAAaA,CAACC,YAAY,EAAE;EAC1C,IAAIC,MAAM,GAAG,EAAE,CAAA;AACf,EAAA,MAAMC,KAAK,GAAGF,YAAY,CAACG,SAAS,CAACH,YAAY,CAACI,OAAO,CAAC,GAAG,CAAC,CAAC,CAAA;EAC/D,MAAMC,KAAK,GAAG,qBAAqB,CAAA;AACnC,EAAA,IAAIC,KAAK,CAAA;;AAET;EACA,OAAO,CAACA,KAAK,GAAGD,KAAK,CAACE,IAAI,CAACL,KAAK,CAAC,MAAM,IAAI,EAAE;AAC3CD,IAAAA,MAAM,CAACO,kBAAkB,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,GAAGE,kBAAkB,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;AACrE,GAAA;AAEA,EAAA,OAAOL,MAAM,CAAA;AACf,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAeQ,iBAAiB,CAACC,MAAM,CAAC;AACtC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAEEC,OAAOA,CAACC,IAAI,EAAE;IACZ,OAAO,IAAIC,IAAI,CAACC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;AAC3C,MAAA,IAAI,CAAC,IAAI,CAACC,aAAa,CAACL,IAAI,CAAC,EAAE;QAC7B,OAAOI,MAAM,CAAC,qDAAqD,CAAC,CAAA;AACtE,OAAA;MAEA,OAAOD,OAAO,CAACH,IAAI,CAAC,CAAA;AACtB,KAAC,CAAC,CAAA;GACH;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAGEM,YAAYA,CAACC,IAAI,EAAE;IACjB,OAAO,IAAIN,IAAI,CAACC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MAC3C,IAAIG,IAAI,CAACC,KAAK,EAAE;AACdJ,QAAAA,MAAM,CAACG,IAAI,CAACC,KAAK,CAAC,CAAA;OACnB,MAAM,IAAI,CAAC,IAAI,CAACH,aAAa,CAACE,IAAI,CAAC,EAAE;QACpCH,MAAM,CAAC,+CAA+C,CAAC,CAAA;AACzD,OAAC,MAAM;QACLD,OAAO,CAACI,IAAI,CAAC,CAAA;AACf,OAAA;AACF,KAAC,CAAC,CAAA;GACH;AAED;AACF;AACA;AACA;AACA;AACA;AAEEE,EAAAA,UAAUA,GAAG;AACX,IAAA,OAAOR,IAAI,CAACC,OAAO,CAACC,OAAO,EAAE,CAAA;GAC9B;EAEDE,aAAaA,CAACL,IAAI,EAAE;AAClB;;AAEA,IAAA,OAAO,CAACU,OAAO,CAACV,IAAI,CAAC,IAAI,CAACU,OAAO,CAACV,IAAI,CAACW,YAAY,CAAC,CAAA;AACtD,GAAA;AACF,CAAC,CAAC;;;;"}