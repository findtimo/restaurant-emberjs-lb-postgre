{"version":3,"file":"set.js","sources":["../../src/-private/set.ts"],"sourcesContent":["import {\n  TrackedStorage,\n  createStorage,\n  getValue,\n  setValue,\n} from 'ember-tracked-storage-polyfill';\n\nexport class TrackedSet<T = unknown> implements Set<T> {\n  private collection = createStorage(null, () => false);\n\n  private storages: Map<T, TrackedStorage<null>> = new Map();\n\n  private vals: Set<T>;\n\n  private storageFor(key: T): TrackedStorage<null> {\n    const storages = this.storages;\n    let storage = storages.get(key);\n\n    if (storage === undefined) {\n      storage = createStorage(null, () => false);\n      storages.set(key, storage);\n    }\n\n    return storage;\n  }\n\n  private dirtyStorageFor(key: T): void {\n    const storage = this.storages.get(key);\n\n    if (storage) {\n      setValue(storage, null);\n    }\n  }\n\n  constructor();\n  constructor(values: readonly T[] | null);\n  constructor(iterable: Iterable<T>);\n  constructor(existing?: readonly T[] | Iterable<T> | null | undefined) {\n    this.vals = new Set(existing);\n  }\n\n  // **** KEY GETTERS ****\n  has(value: T): boolean {\n    getValue(this.storageFor(value));\n\n    return this.vals.has(value);\n  }\n\n  // **** ALL GETTERS ****\n  entries(): IterableIterator<[T, T]> {\n    getValue(this.collection);\n\n    return this.vals.entries();\n  }\n\n  keys(): IterableIterator<T> {\n    getValue(this.collection);\n\n    return this.vals.keys();\n  }\n\n  values(): IterableIterator<T> {\n    getValue(this.collection);\n\n    return this.vals.values();\n  }\n\n  forEach(fn: (value1: T, value2: T, set: Set<T>) => void): void {\n    getValue(this.collection);\n\n    this.vals.forEach(fn);\n  }\n\n  get size(): number {\n    getValue(this.collection);\n\n    return this.vals.size;\n  }\n\n  [Symbol.iterator](): IterableIterator<T> {\n    getValue(this.collection);\n\n    return this.vals[Symbol.iterator]();\n  }\n\n  get [Symbol.toStringTag](): string {\n    return this.vals[Symbol.toStringTag];\n  }\n\n  // **** KEY SETTERS ****\n  add(value: T): this {\n    this.dirtyStorageFor(value);\n    setValue(this.collection, null);\n\n    this.vals.add(value);\n\n    return this;\n  }\n\n  delete(value: T): boolean {\n    this.dirtyStorageFor(value);\n    setValue(this.collection, null);\n\n    return this.vals.delete(value);\n  }\n\n  // **** ALL SETTERS ****\n  clear(): void {\n    this.storages.forEach((s) => setValue(s, null));\n    setValue(this.collection, null);\n\n    this.vals.clear();\n  }\n}\n\n// So instanceof works\nObject.setPrototypeOf(TrackedSet.prototype, Set.prototype);\n\nexport class TrackedWeakSet<T extends object = object> implements WeakSet<T> {\n  private storages: WeakMap<T, TrackedStorage<null>> = new WeakMap();\n\n  private vals: WeakSet<T>;\n\n  private storageFor(key: T): TrackedStorage<null> {\n    const storages = this.storages;\n    let storage = storages.get(key);\n\n    if (storage === undefined) {\n      storage = createStorage(null, () => false);\n      storages.set(key, storage);\n    }\n\n    return storage;\n  }\n\n  private dirtyStorageFor(key: T): void {\n    const storage = this.storages.get(key);\n\n    if (storage) {\n      setValue(storage, null);\n    }\n  }\n\n  constructor(values?: readonly T[] | null) {\n    this.vals = new WeakSet(values);\n  }\n\n  has(value: T): boolean {\n    getValue(this.storageFor(value));\n\n    return this.vals.has(value);\n  }\n\n  add(value: T): this {\n    // Add to vals first to get better error message\n    this.vals.add(value);\n\n    this.dirtyStorageFor(value);\n\n    return this;\n  }\n\n  delete(value: T): boolean {\n    this.dirtyStorageFor(value);\n\n    return this.vals.delete(value);\n  }\n\n  get [Symbol.toStringTag](): string {\n    return this.vals[Symbol.toStringTag];\n  }\n}\n\n// So instanceof works\nObject.setPrototypeOf(TrackedWeakSet.prototype, WeakSet.prototype);\n"],"names":["TrackedSet","collection","createStorage","storages","Map","storageFor","key","storage","get","undefined","set","dirtyStorageFor","setValue","constructor","existing","vals","Set","has","value","getValue","entries","keys","values","forEach","fn","size","Symbol","iterator","toStringTag","add","delete","clear","s","Object","setPrototypeOf","prototype","TrackedWeakSet","WeakMap","WeakSet"],"mappings":"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"}